{
  "updatedAt": "2025-12-18T20:28:14.706Z",
  "createdAt": "2025-12-08T14:30:14.797Z",
  "id": "Tw9iJBKtSFvACs8y",
  "name": "Magnetto Chatbot + Redis - BETA V1.0.0",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "recebe-dados-os",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        1568,
        -1328
      ],
      "id": "19bb8d02-8654-4c1b-8215-f45ab80b503e",
      "name": "Webhook2",
      "webhookId": "28c50b66-8cde-4f8f-87de-babdee0c9f39"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=id:{{ $json.data.key.remoteJid }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1568,
        -608
      ],
      "id": "6605de90-0d7b-496f-820d-df2a20124d74",
      "name": "Redis6",
      "credentials": {
        "redis": {
          "id": "zxoKZ2hHG1VotLrg",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b0bc1622-ccd0-489e-a51e-5eaa1c4bd334",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        864,
        -736
      ],
      "id": "34e88b10-75b1-48bf-9e76-c7ef4db9bfd2",
      "name": "If1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "69886729-8e82-426c-802f-46705c3e2b3a"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "51b92b73-164e-4755-8038-d654ca87a9ea",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "2"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "18831c78-d752-417a-bd9f-c14e5d50c084",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "3"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ea852e4c-22b1-44e0-807c-e07f299d8022",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "4"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f49d14b1-0ca5-4ae9-a212-1aa50e2bada5",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "5"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "300116c1-76e1-4e14-beee-809f9b1fd295",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "6",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "6"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3f00aac6-1438-466b-aa8e-bf4ea82e5ae9",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "7",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "7"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d22d8a63-66cd-4e5e-b857-f50d04a4e0c1",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "8",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "8"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3624ac4f-e7e0-4a0e-a559-cc9b11fd5f74",
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "rightValue": "OS_",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "OS_"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1088,
        -752
      ],
      "id": "25b93314-9223-4e15-8cf3-bfb40c7153b0",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "id",
        "key": "=id:{{ $('@s.whatsapp.net').item.json.remoteJid }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        656,
        -736
      ],
      "id": "8b1d732d-54ec-4cfa-9653-7e1d0417cbe5",
      "name": "Redis1",
      "credentials": {
        "redis": {
          "id": "zxoKZ2hHG1VotLrg",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=id:{{ $json.data.key.remoteJid }}",
        "value": "menu_principal",
        "expire": true,
        "ttl": 600
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        864,
        -896
      ],
      "id": "c1431a86-6cb9-4a0f-bb2c-7ba94874c5f4",
      "name": "Redis",
      "credentials": {
        "redis": {
          "id": "zxoKZ2hHG1VotLrg",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "34998565-4754-4036-9919-919fba42692c",
              "leftValue": "={{ $('Edit Fields3').item.json.conversation }}",
              "rightValue": "Magnetto",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        368,
        -880
      ],
      "id": "8faba0b1-6177-4745-9eec-3671116a851c",
      "name": "If"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "7a6699a8-890e-4b2b-8a03-167175154a31",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -256,
        -880
      ],
      "id": "302220a3-613e-4ea6-9616-6049afaa7ac7",
      "name": "Webhook",
      "webhookId": "5b947b1f-b0f0-41cc-903c-9abdd1dc685c"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "91e7da4f-3369-4523-aa7e-5af7625e0fe6",
              "name": "driveId",
              "value": "={{ $json.driveId }}",
              "type": "string"
            },
            {
              "id": "dce65960-5811-465f-b3b3-76d038f27f2e",
              "name": "fileid",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2288,
        -1136
      ],
      "id": "5cbd62f5-04b9-45af-89f3-4d4ad2877318",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "name": "={{ $('Remove duplicatas').item.json.folderName }}",
        "driveId": {
          "__rl": true,
          "value": "={{ $('Remove duplicatas').item.json.driveId }}",
          "mode": "id"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Remove duplicatas').item.json.fileId }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        6336,
        -1344
      ],
      "id": "132a1836-07be-447c-831e-beb33e9e5a81",
      "name": "Upload file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.documentId }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        6128,
        -1344
      ],
      "id": "9629aa2d-adef-4d87-b2ee-e3809e85526b",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Entrada\nconst data = items[0].json;\n\n// Função utilitária para aplicar \"N/A\"\nconst na = v => {\n  if (v === undefined || v === null) return \"N/A\";\n  if (typeof v === \"string\" && v.trim() === \"\") return \"N/A\";\n  if (Array.isArray(v)) {\n    // array vazio ou só com objetos vazios → \"N/A\"\n    if (v.length === 0) return \"N/A\";\n    if (v.every(item => typeof item === \"object\" && Object.keys(item).length === 0)) return \"N/A\";\n  }\n  if (typeof v === \"object\" && Object.keys(v).length === 0) return \"N/A\";\n  return v;\n};\n\n// Arrays de peças\nconst pecas_cliente = na(data.pecas_cliente);\nconst pecas_ms = na(data.pecas_ms);\n\n// Mão de Obra\nconst mao = data.mao_de_obra?.[0] || {};\n\nlet datas = [];\nlet totalEfetivo = 0;\nlet totalContingencial = 0;\n\n// Suporta até 50 registros\nfor (let i = 1; i <= 50; i++) {\n  const dataKey = `data${i}`;\n  const efKey = `hh_efetivo${i}`;\n  const ctKey = `hh_contingencial${i}`;\n\n  if (mao[dataKey]) {\n    datas.push(mao[dataKey]);\n    totalEfetivo += Number(mao[efKey] || 0);\n    totalContingencial += Number(mao[ctKey] || 0);\n  }\n}\n\ndatas.sort((a,b) => new Date(a) - new Date(b));\n\nconst primeiraData = na(datas[0]);\nconst ultimaData = na(datas[datas.length - 1]);\n\nconst totalEfetivoFinal = datas.length > 0 ? totalEfetivo : \"N/A\";\nconst totalContingencialFinal = datas.length > 0 ? totalContingencial : \"N/A\";\nconst totalGeralFinal = datas.length > 0 ? totalEfetivo + totalContingencial : \"N/A\";\n\n// ---- RETORNAR SOMENTE DADOS DIRETOS ----\nreturn [\n  {\n    json: {\n      pecas_cliente,\n      pecas_medical_spin: pecas_ms,\n    \n      mao_de_obra: {\n        primeiraData,\n        ultimaData,\n        totalEfetivo: totalEfetivoFinal,\n        totalContingencial: totalContingencialFinal,\n        totalGeral: totalGeralFinal\n      }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4080,
        -1344
      ],
      "id": "dd7956d4-dbca-4506-9bf8-c106af8b1993",
      "name": "Soma horas"
    },
    {
      "parameters": {
        "jsCode": "// Função para converter string JSON em array\nfunction parseArray(str) {\n  try {\n    const arr = typeof str === \"string\" ? JSON.parse(str) : str;\n    return Array.isArray(arr) ? arr : [];\n  } catch {\n    return [];\n  }\n}\n\n// Função para enumerar objetos e transformar tudo em 1 objeto dentro de um array\nfunction enumerateObjects(array, fields) {\n  const obj = {};\n\n  array.forEach((entry, index) => {\n    const i = index + 1;\n    fields.forEach(f => {\n      obj[`${f}${i}`] = entry[f] ?? \"\";\n    });\n  });\n\n  return [obj];\n}\n\n// Acumuladores\nlet pecas_cliente_all = [];\nlet pecas_ms_all = [];\nlet mao_de_obra_all = [];\n\n// Junta todos os itens recebidos do nó anterior\nfor (const item of items) {\n  const data = item.json;\n\n  pecas_cliente_all.push(...parseArray(data.pecas_cliente));\n  pecas_ms_all.push(...parseArray(data.pecas_ms));\n  mao_de_obra_all.push(...parseArray(data.mao_de_obra));\n}\n\n// Agora enumera TODOS os campos\nconst final = {\n  pecas_cliente: enumerateObjects(pecas_cliente_all, [\"nome\", \"modelo\", \"sn\", \"detalhes\"]),\n  pecas_ms: enumerateObjects(pecas_ms_all, [\"nome\", \"modelo\", \"sn\", \"detalhes\"]),\n  mao_de_obra: enumerateObjects(mao_de_obra_all, [\"data\", \"hh_efetivo\", \"hh_contingencial\"])\n};\n\n// Retorna tudo em UM ÚNICO ITEM\nreturn [\n  {\n    json: final\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3872,
        -1344
      ],
      "id": "2347b070-77ea-4d26-85b1-a9c7b8ae5aa2",
      "name": "Junta itens"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "19409568-d828-48fc-896d-2eb240efc327",
              "name": "pecas_cliente",
              "value": "={{ $('dados').item.json.pecas_cliente }}",
              "type": "string"
            },
            {
              "id": "bda07dd3-5584-4644-9f3c-c9cfc6fbd109",
              "name": "pecas_ms",
              "value": "={{ $('dados').item.json.pecas_ms }}",
              "type": "string"
            },
            {
              "id": "037c90b6-20f5-4105-b3e9-16c23926a36b",
              "name": "mao_de_obra",
              "value": "={{ $('dados').item.json.mao_de_obra }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3664,
        -1344
      ],
      "id": "ccad6f4c-0024-45af-937d-9942412a49c9",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('Pega o documento').item.json.documentId }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "={{ $('Placeholder').item.json.placeholder }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        5136,
        -1344
      ],
      "id": "05345ff1-f4aa-46ab-9bd5-dc42e264bc6c",
      "name": "Atualiza documento1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7uUks2OM1WgLSPNJ",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $('Copia  o arquivo').item.json.id }}",
        "simple": false
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        4608,
        -1344
      ],
      "id": "38009dd5-d989-471a-bf1e-a0f16c605941",
      "name": "Pega o documento1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7uUks2OM1WgLSPNJ",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9ea726e0-f65f-40c9-8372-f35482aa393f",
              "name": "nome",
              "value": "={{ $('Split Out').item.json.nome }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3104,
        -1344
      ],
      "id": "3b40c283-3eb3-4257-a67a-a8f3adc76bc3",
      "name": "Nome da imagem"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "14010743-1e77-4a33-8d67-19d0a442d36f",
              "name": "Index",
              "value": "={{ $('Pega o documento1').item.json.body.content[25].paragraph.elements[0].startIndex }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4960,
        -1344
      ],
      "id": "684b044a-91b1-499c-8673-826fc5774ffd",
      "name": "Index"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://docs.googleapis.com/v1/documents/{{ $json.documentId }}:batchUpdate",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"requests\": [\n    {\n      \"insertInlineImage\": {\n        \"location\": {\n          \"index\": {{ $json.index }}\n        },\n        \"uri\": \"https://drive.google.com/uc?export=view&id={{ $json.id }}\",\n        \"objectSize\": {\n          \"height\": {\n            \"magnitude\": 200,\n            \"unit\": \"PT\"\n          },\n          \"width\": {\n            \"magnitude\": 200,\n            \"unit\": \"PT\"\n          }\n        }\n      }\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        6336,
        -1200
      ],
      "id": "25cb1eaf-2812-4d69-b8de-4af6e63a307f",
      "name": "Cola imagem no documento",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7uUks2OM1WgLSPNJ",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c6827f38-85e7-4810-b143-a5dab53ee0d9",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            },
            {
              "id": "929c970b-837b-4fa0-ac3e-c62b8b1aa1a0",
              "leftValue": "={{ $json.name }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6128,
        -1184
      ],
      "id": "9db96db8-63f2-429d-a684-286fc5692d74",
      "name": "Id e Name?"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        5712,
        -1200
      ],
      "id": "bc9e038e-b188-4df1-abd4-1856d0dcc0dd",
      "name": "Percorre os itens"
    },
    {
      "parameters": {
        "jsCode": "const data = items.map(i => i.json);\n\n// Extrai info fixa (uma vez só)\nconst placeholder = data.find(d => d.placeholder)?.placeholder || null;\nconst index = data.find(d => d.Index !== undefined)?.Index || null;\nconst documentId = data.find(d => d.documentId)?.documentId || null;\n\n// Extrai driveId e fileid (únicos)\nconst driveId = data.find(d => d.driveId)?.driveId || null;\nconst fileid = data.find(d => d.fileid)?.fileid || null;\n\n// Pega todos os blocos com id + name\nconst arquivos = data.filter(d => d.id && d.name);\n\n// Remove duplicados por id\nconst ids = new Set();\nconst unicos = arquivos.filter(a => {\n  if (ids.has(a.id)) return false;\n  ids.add(a.id);\n  return true;\n});\n\n// Cria novo array de items no formato pedido\nreturn unicos.map(a => ({\n  json: {\n    placeholder,\n    index,\n    documentId,\n    driveId,\n    fileid,\n    id: a.id,\n    name: a.name\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5552,
        -1200
      ],
      "id": "64a28664-6ef4-4a3e-a253-4d260d875fe8",
      "name": "Separa itens"
    },
    {
      "parameters": {
        "numberInputs": 6
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5376,
        -1264
      ],
      "id": "c3a93c6c-0f60-42ed-b415-c23f95061ccb",
      "name": "Unir tudo"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('Pega o documento').item.json.documentId }}",
        "actionsUi": {
          "actionFields": [
            {
              "object": "=text",
              "action": "replaceAll",
              "text": "{razao_social}",
              "replaceText": "={{ $('dados').item.json.razao_social }}",
              "index": 0
            },
            {
              "action": "replaceAll",
              "text": "{cnpj}",
              "replaceText": "={{ $('dados').item.json.cnpj }}"
            },
            {
              "action": "replaceAll",
              "text": "{cidade}",
              "replaceText": "={{ $('dados').item.json.cidade }}"
            },
            {
              "action": "replaceAll",
              "text": "{uf}",
              "replaceText": "={{ $('dados').item.json.uf }}"
            },
            {
              "action": "replaceAll",
              "text": "{nome_do_solicitante}",
              "replaceText": "={{ $('dados').item.json.responsavel }}"
            },
            {
              "action": "replaceAll",
              "text": "{fabricante}",
              "replaceText": "={{ $('dados').item.json.fabricante }}"
            },
            {
              "action": "replaceAll",
              "text": "{modelo}",
              "replaceText": "={{ $('dados').item.json.modelo }}"
            },
            {
              "action": "replaceAll",
              "text": "{serie}",
              "replaceText": "={{ $('dados').item.json.serie }}"
            },
            {
              "action": "replaceAll",
              "text": "{motivacao_servico}",
              "replaceText": "={{ $('dados').item.json.motivacao }}"
            },
            {
              "action": "replaceAll",
              "text": "{eventos_r_relacionados}",
              "replaceText": "={{ $('dados').item.json.eventos }}"
            },
            {
              "action": "replaceAll",
              "text": "{partes_removidas_cliente}",
              "replaceText": "={{ \n  ($('dados').item.json.pecas_cliente || []).length === 0 || $('dados').item.json.pecas_cliente.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados').item.json.pecas_cliente.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
            },
            {
              "action": "replaceAll",
              "text": "{partes_removidas_medicalspin}",
              "replaceText": "={{ \n  ($('dados').item.json.pecas_ms || []).length === 0 || $('dados').item.json.pecas_ms.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados').item.json.pecas_ms.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
            },
            {
              "action": "replaceAll",
              "text": "{tipo_intervencao}",
              "replaceText": "={{ $('dados').item.json.tipo_intervencao }}"
            },
            {
              "action": "replaceAll",
              "text": "{descricao_servicos_realizados}",
              "replaceText": "={{ $('dados').item.json.descricao_servicos }}"
            },
            {
              "action": "replaceAll",
              "text": "{data0}",
              "replaceText": "={{ $now.format('dd/LL/yyyy') }}"
            },
            {
              "action": "replaceAll",
              "text": "{data}",
              "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.primeiraData \n    ? new Date($('Soma horas').item.json.mao_de_obra.primeiraData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' \n}} - {{ $('Soma horas').item.json.mao_de_obra.ultimaData \n    ? new Date($('Soma horas').item.json.mao_de_obra.ultimaData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' }}"
            },
            {
              "action": "replaceAll",
              "text": "{medicalspin}",
              "replaceText": "={{ $('dados').item.json.pendencias_ms }}"
            },
            {
              "action": "replaceAll",
              "text": "{cliente}",
              "replaceText": "={{ $('dados').item.json.pendencias_cliente }}"
            },
            {
              "action": "replaceAll",
              "text": "{antes_intervencao}",
              "replaceText": "={{ $('dados').item.json.estado_inicial }}"
            },
            {
              "action": "replaceAll",
              "text": "{apos_intervensao}",
              "replaceText": "={{ $('dados').item.json.estado_final }}"
            },
            {
              "action": "replaceAll",
              "text": "{cidade_realizacao}",
              "replaceText": "={{ $('dados').item.json.cidade_realizacao }}"
            },
            {
              "action": "replaceAll",
              "text": "{uf_realizacao}",
              "replaceText": "={{ $('dados').item.json.uf_realizacao }}"
            },
            {
              "action": "replaceAll",
              "text": "{tecnico_responsavel}",
              "replaceText": "={{ $('dados').item.json.nome_tecnico }}"
            },
            {
              "action": "replaceAll",
              "text": "{cft}",
              "replaceText": "={{ $('dados').item.json.cft_tecnico }}"
            },
            {
              "action": "replaceAll",
              "text": "{recebedor}",
              "replaceText": "={{ $('dados').item.json.recebedor }}"
            },
            {
              "action": "replaceAll",
              "text": "{efetivo}",
              "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.totalEfetivo.toString() }}"
            },
            {
              "action": "replaceAll",
              "text": "{contingencial}",
              "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.totalContingencial.toString() }}"
            },
            {
              "action": "replaceAll",
              "text": "{total}",
              "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.totalGeral.toString() }}"
            },
            {
              "action": "replaceAll",
              "text": "{fantasia}",
              "replaceText": "={{ $('dados').item.json.nome_fantasia }}"
            },
            {
              "action": "replaceAll",
              "text": "{tipo_equipamento}",
              "replaceText": "={{ $('dados').item.json.tipo_equipamento }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        4448,
        -1344
      ],
      "id": "ddc10945-90e8-4401-a308-32756129f4d0",
      "name": "Atualiza documento",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7uUks2OM1WgLSPNJ",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6fdcebc1-c772-40a8-bfc1-22584c6c2f93",
              "name": "placeholder",
              "value": "{fotos}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4784,
        -1344
      ],
      "id": "226cc3dc-ee95-4eb6-afc7-bf9263d3b8db",
      "name": "Placeholder"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $('Copia  o arquivo').item.json.id }}",
        "simple": false
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        4272,
        -1344
      ],
      "id": "f03a098e-b937-4eab-beed-024809517b50",
      "name": "Pega o documento",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7uUks2OM1WgLSPNJ",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Remove duplicados pelo campo \"id\"\nconst seen = new Set();\n\nconst unique = items.filter(item => {\n  const id = item.json.id;\n  if (seen.has(id)) return false;\n  seen.add(id);\n  return true;\n});\n\n// Retorna apenas os itens únicos\nreturn unique;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3456,
        -1344
      ],
      "id": "ebcb854a-991f-40dc-b453-b945b709f36f",
      "name": "Junta repeticoes"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $('Cria pasta').item.json.name }}",
        "limit": "={{ $items().filter(i => i.json.nome).length }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Cria pasta').item.json.id }}",
            "mode": "id"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3280,
        -1344
      ],
      "id": "af9b0df3-aefe-4931-a8dd-28d62e8e3666",
      "name": "Procura imagens",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "share",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "permissionsUi": {
          "permissionsValues": {
            "role": "writer",
            "type": "anyone"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3456,
        -1136
      ],
      "id": "9c362a60-3abb-49a1-a5ae-417ea1ab8f43",
      "name": "Torna publico",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4e8de6be-f93a-4806-897e-9cd6a0e9886a",
              "name": "midias",
              "value": "={{ $('dados').item.json.midias }}",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2224,
        -1328
      ],
      "id": "0f1092b0-be01-4357-a482-f5713a00b12f",
      "name": "midia"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1zyQzlhzDDsDONuzHqaT8Kql0riKMl2uPk79so4DXtYs",
          "mode": "list",
          "cachedResultName": "OS_modelo",
          "cachedResultUrl": "https://docs.google.com/document/d/1zyQzlhzDDsDONuzHqaT8Kql0riKMl2uPk79so4DXtYs/edit?usp=drivesdk"
        },
        "name": "=OS_{{ $('dados').item.json.razao_social }}_{{ $('dados').item.json.cnpj }}_{{ $now.format('dd-LL-yyyy T') }}",
        "sameFolder": false,
        "driveId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1OQHRuBKVD3WypEIhvQmiq5B8rh7bvsoS",
          "mode": "url"
        },
        "folderId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2064,
        -1328
      ],
      "id": "093bc552-7eab-4605-b9d5-0182a628ae38",
      "name": "Copia  o arquivo",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "=OS_{{ $('dados').item.json.razao_social }}_{{ $('dados').item.json.cnpj }}_{{ $now.format('dd-LL-yyyy T') }}",
        "driveId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1nAeEaoG6QNZq2fuonNJB7GluFIhOffL1",
          "mode": "url"
        },
        "folderId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1nAeEaoG6QNZq2fuonNJB7GluFIhOffL1",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1904,
        -1328
      ],
      "id": "4e526a61-3d0d-40aa-8d81-1dac8b50343e",
      "name": "Cria pasta",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $json.nome }}",
        "limit": "={{ $items().filter(i => i.json.nome).length }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Cria pasta').item.json.id }}",
            "mode": "id"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3280,
        -1200
      ],
      "id": "87ebcc50-c689-4466-ba8a-42befa558729",
      "name": "Imagens",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "midias",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2576,
        -1344
      ],
      "id": "81b26e1a-8b30-4325-b339-3ed018480731",
      "name": "Split Out"
    },
    {
      "parameters": {
        "name": "={{ $('Split Out').item.json.nome }}",
        "driveId": {
          "__rl": true,
          "value": "={{ $('Cria pasta').item.json.driveId }}",
          "mode": "id"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Cria pasta').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2928,
        -1344
      ],
      "id": "c0e0aa27-682b-4537-ae8d-869c9eceba16",
      "name": "Adiciona imagem",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// pega o item do webhook\nconst wh = $('Webhook2').first().json;\n\n// tenta pegar body.json (se existir)\nlet data = wh?.body?.json;\n\n// caso não exista, tenta pegar body inteiro\nif (!data && wh?.body) {\n  data = wh.body;\n}\n\n// caso o webhook tenha mandado direto no json\nif (!data) {\n  data = wh;\n}\n\n// se for string, tenta converter pra JSON\nif (typeof data === 'string') {\n  try {\n    data = JSON.parse(data);\n  } catch (err) {\n    throw new Error('JSON inválido recebido');\n  }\n}\n\n// função recursiva para substituir valores vazios\nfunction normalize(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(item => normalize(item));\n  }\n\n  if (obj !== null && typeof obj === 'object') {\n    const out = {};\n    for (const key in obj) {\n      const value = obj[key];\n\n      if (\n        value === \"\" ||\n        value === null ||\n        value === undefined\n      ) {\n        out[key] = \"N/A\";\n      } else {\n        out[key] = normalize(value);\n      }\n    }\n    return out;\n  }\n\n  return obj;\n}\n\nconst normalized = normalize(data);\n\nreturn [{ json: normalized }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1744,
        -1328
      ],
      "id": "7cd26316-33b4-44bc-ab71-60ca5bcfe4ea",
      "name": "dados"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        2752,
        -1344
      ],
      "id": "94c45f2f-3163-4391-9b2f-855630e10c0a",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "jsCode": "const map = new Map();\n\n// Pega os valores externos\nconst driveId = $('Separa itens').first().json.driveId;\nconst fileId = $('Separa itens').first().json.fileid;\nconst folderName = $('Cria pasta').first().json.name;\n\nfor (const item of items) {\n  const docId = item.json.documentId;\n\n  if (!map.has(docId)) {\n    // adiciona o item + os novos campos\n    map.set(docId, {\n      ...item.json,\n      driveId,\n      fileId,\n      folderName,\n    });\n  }\n}\n\n// retorna 1 item por documentId\nreturn Array.from(map.values()).map(json => ({ json }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5936,
        -1344
      ],
      "id": "df08c294-ba6d-4ff3-9971-dcc4fa70f6e7",
      "name": "Remove duplicatas"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "4d8af4ea-6429-462d-a924-1e2a634d8775",
              "leftValue": "={{ $json.midias[0].base64 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2400,
        -1328
      ],
      "id": "152a89ce-7b61-4e47-8a16-ea27a738dde0",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('Pega o documento2').item.json.documentId }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "{razao_social}",
              "replaceText": "={{ $('dados').item.json.razao_social }}"
            },
            {
              "action": "replaceAll",
              "text": "{cnpj}",
              "replaceText": "={{ $('dados').item.json.cnpj }}"
            },
            {
              "action": "replaceAll",
              "text": "{cidade}",
              "replaceText": "={{ $('dados').item.json.cidade }}"
            },
            {
              "action": "replaceAll",
              "text": "{uf}",
              "replaceText": "={{ $('dados').item.json.uf }}"
            },
            {
              "action": "replaceAll",
              "text": "{nome_do_solicitante}",
              "replaceText": "={{ $('dados').item.json.responsavel }}"
            },
            {
              "action": "replaceAll",
              "text": "{fabricante}",
              "replaceText": "={{ $('dados').item.json.fabricante }}"
            },
            {
              "action": "replaceAll",
              "text": "{modelo}",
              "replaceText": "={{ $('dados').item.json.modelo }}"
            },
            {
              "action": "replaceAll",
              "text": "{serie}",
              "replaceText": "={{ $('dados').item.json.serie }}"
            },
            {
              "action": "replaceAll",
              "text": "{motivacao_servico}",
              "replaceText": "={{ $('dados').item.json.motivacao }}"
            },
            {
              "action": "replaceAll",
              "text": "{eventos_r_relacionados}",
              "replaceText": "={{ $('dados').item.json.eventos }}"
            },
            {
              "action": "replaceAll",
              "text": "{partes_removidas_cliente}",
              "replaceText": "={{ \n  ($('dados1').item.json.pecas_cliente || []).length === 0 || $('dados1').item.json.pecas_cliente.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados1').item.json.pecas_cliente.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
            },
            {
              "action": "replaceAll",
              "text": "{partes_removidas_medicalspin}",
              "replaceText": "={{ \n  ($('dados1').item.json.pecas_ms || []).length === 0 || $('dados1').item.json.pecas_cliente.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados1').item.json.pecas_cliente.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
            },
            {
              "action": "replaceAll",
              "text": "{tipo_intervencao}",
              "replaceText": "={{ $('dados').item.json.tipo_intervencao }}"
            },
            {
              "action": "replaceAll",
              "text": "{descricao_servicos_realizados}",
              "replaceText": "={{ $('dados').item.json.descricao_servicos }}"
            },
            {
              "action": "replaceAll",
              "text": "{data0}",
              "replaceText": "={{ $now.format('dd/LL/yyyy') }}"
            },
            {
              "action": "replaceAll",
              "text": "{data}",
              "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.primeiraData \n    ? new Date($('Soma horas1').item.json.mao_de_obra.primeiraData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' \n}} - {{ $('Soma horas1').item.json.mao_de_obra.ultimaData \n    ? new Date($('Soma horas1').item.json.mao_de_obra.ultimaData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' }}"
            },
            {
              "action": "replaceAll",
              "text": "{medicalspin}",
              "replaceText": "={{ $('dados').item.json.pendencias_ms }}"
            },
            {
              "action": "replaceAll",
              "text": "{cliente}",
              "replaceText": "={{ $('dados').item.json.pendencias_cliente }}"
            },
            {
              "action": "replaceAll",
              "text": "{antes_intervencao}",
              "replaceText": "={{ $('dados').item.json.estado_inicial }}"
            },
            {
              "action": "replaceAll",
              "text": "{apos_intervensao}",
              "replaceText": "={{ $('dados').item.json.estado_final }}"
            },
            {
              "action": "replaceAll",
              "text": "{cidade_realizacao}",
              "replaceText": "={{ $('dados').item.json.cidade_realizacao }}"
            },
            {
              "action": "replaceAll",
              "text": "{uf_realizacao}",
              "replaceText": "={{ $('dados').item.json.uf_realizacao }}"
            },
            {
              "action": "replaceAll",
              "text": "{tecnico_responsavel}",
              "replaceText": "={{ $('dados').item.json.nome_tecnico }}"
            },
            {
              "action": "replaceAll",
              "text": "{cft}",
              "replaceText": "={{ $('dados').item.json.cft_tecnico }}"
            },
            {
              "action": "replaceAll",
              "text": "{recebedor}",
              "replaceText": "={{ $('dados').item.json.recebedor }}"
            },
            {
              "action": "replaceAll",
              "text": "{efetivo}",
              "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.totalEfetivo.toString() }}"
            },
            {
              "action": "replaceAll",
              "text": "{contingencial}",
              "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.totalContingencial.toString() }}"
            },
            {
              "action": "replaceAll",
              "text": "{total}",
              "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.totalGeral.toString() }}"
            },
            {
              "action": "replaceAll",
              "text": "{fotos}",
              "replaceText": "N/A"
            },
            {
              "action": "replaceAll",
              "text": "{fantasia}",
              "replaceText": "={{ $('dados').item.json.nome_fantasia }}"
            },
            {
              "action": "replaceAll",
              "text": "{tipo_equipamento}",
              "replaceText": "={{ $('dados').item.json.tipo_equipamento }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3104,
        -992
      ],
      "id": "259303c8-8ed1-4384-a947-40a10162bbd6",
      "name": "Atualiza documento2",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7uUks2OM1WgLSPNJ",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $('Copia  o arquivo').item.json.id }}",
        "simple": false
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        2928,
        -992
      ],
      "id": "398a572e-d0fb-4653-9e39-295a0672c64f",
      "name": "Pega o documento2",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7uUks2OM1WgLSPNJ",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens do nó \"dados\"\nconst dados = $('dados').all();\n\n// Retorna exatamente o que veio do nó \"dados\"\nreturn dados;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2576,
        -992
      ],
      "id": "3155a6e7-535f-4e80-a1e2-8fb200ae04e2",
      "name": "dados1"
    },
    {
      "parameters": {
        "jsCode": "const data = items[0].json; // Acesso ao dado no primeiro item\n\n// Utilitário para aplicar \"N/A\"\nconst na = v => (v === undefined || v === null || v === \"\" ? \"N/A\" : v);\n\n// Arrays de peças (se vierem vazios, devolve array vazio — correto)\nconst pecas_cliente = data.pecas_cliente || [];\nconst pecas_ms = data.pecas_ms || [];\n\n// Mão de Obra\nconst mao = data.mao_de_obra || [];\n\nlet datas = [];\nlet totalEfetivo = 0;\nlet totalContingencial = 0;\n\n// Suporta até 50 registros\nmao.forEach((registro) => {\n  datas.push(registro.data);\n  totalEfetivo += Number(registro.hh_efetivo || 0);\n  totalContingencial += Number(registro.hh_contingencial || 0);\n});\n\ndatas.sort((a, b) => new Date(a) - new Date(b));\n\n// Primeira e última data\nconst primeiraData = datas.length > 0 ? datas[0] : \"N/A\";\nconst ultimaData = datas.length > 0 ? datas[datas.length - 1] : \"N/A\";\n\n// Se não houverem registros, retorna \"N/A\"\nconst totalEfetivoFinal = totalEfetivo > 0 ? totalEfetivo : \"N/A\";\nconst totalContingencialFinal = totalContingencial > 0 ? totalContingencial : \"N/A\";\nconst totalGeralFinal = totalEfetivo + totalContingencial > 0 ? totalEfetivo + totalContingencial : \"N/A\";\n\n// Formatando as peças\nconst pecas_clienteFormatted = pecas_cliente.map(peca => `${peca.nome}|${peca.modelo}|${peca.sn}|${peca.detalhes}`).join(\"\\n\");\nconst pecas_msFormatted = pecas_ms.map(peca => `${peca.nome}|${peca.modelo}|${peca.sn}|${peca.detalhes}`).join(\"\\n\");\n\n// Retorno do objeto\nreturn [\n  {\n    json: {\n      pecas_cliente: pecas_clienteFormatted || \"N/A\",\n      pecas_ms: pecas_msFormatted || \"N/A\",\n      mao_de_obra: {\n        primeiraData,\n        ultimaData,\n        totalEfetivo: totalEfetivoFinal,\n        totalContingencial: totalContingencialFinal,\n        totalGeral: totalGeralFinal\n      }\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2752,
        -992
      ],
      "id": "0e61ed3c-f82d-43d1-8302-b906500cc9d2",
      "name": "Soma horas1"
    },
    {
      "parameters": {
        "name": "={{ $('Cria pasta').item.json.name }}",
        "driveId": {
          "__rl": true,
          "value": "={{ $('Cria pasta').item.json.driveId }}",
          "mode": "id"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Cria pasta').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3456,
        -992
      ],
      "id": "e2274c1d-abd5-4470-973b-025299c328d9",
      "name": "Upload file1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.documentId }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3280,
        -992
      ],
      "id": "352a74ab-c13a-4bcb-8088-b29c8e5e46b7",
      "name": "Download file1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
          "mode": "list",
          "cachedResultName": "DBRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "dbRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "RemoteId": "={{ $json.data.key.remoteJid }}"
          },
          "matchingColumns": [
            "RemoteId"
          ],
          "schema": [
            {
              "id": "RemoteId",
              "displayName": "RemoteId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1088,
        -896
      ],
      "id": "4d979810-5bcf-4269-9c66-5260bdc87aa1",
      "name": "RemoteId",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
          "mode": "list",
          "cachedResultName": "DBRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "dbRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4064,
        -992
      ],
      "id": "c6955e87-076a-43c9-b7b2-23e0f8776d5e",
      "name": "RemoteId1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
          "mode": "list",
          "cachedResultName": "DBRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "dbRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7088,
        -1344
      ],
      "id": "46abee3d-cc0d-4f57-8594-836c4c93617e",
      "name": "RemoteId2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
          "mode": "list",
          "cachedResultName": "DBRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "dbRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1744,
        -608
      ],
      "id": "a637477a-ce8e-4978-bd3f-677fd8e7a5e0",
      "name": "Delete RemoteId1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('@s.whatsapp.net').item.json.remoteJid }}",
        "messageText": "Olá! 👋 Eu sou o *Magnetto*, seu assistente virtual. Estou aqui para ajudar você com dúvidas, suporte e informações de forma rápida e simples. \n\nComo posso ajudar você hoje? \n\n1️⃣​-Criar OS\n2️⃣-Consultar Drive de OS\n3️⃣-Consultar OS por Cliente\n4️⃣-Cadastrar Cliente\n5️⃣-Consultar Lista de Clientes\n6️⃣-Sair",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        656,
        -896
      ],
      "id": "6a4bea40-67e6-491f-b90b-1140ba7b7344",
      "name": "Menu",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "*Por favor, preencha o formulário abaixo para gerar a ordem de serviço:*\n\nhttps://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/form-autocomplete",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -1328
      ],
      "id": "b7252041-d11a-4e7c-b600-dde467eb092c",
      "name": "Opcao1",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $json.RemoteId }}",
        "messageText": "=OS gerada com sucesso!\nAcesse através do link abaixo:\n\n{{ $('Id e link1').item.json.name }}\n\n{{ $('Id e link1').item.json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        7264,
        -1344
      ],
      "id": "98866ba1-72a1-41a3-8358-3b6e40fc88e8",
      "name": "Envia OS",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $json.RemoteId }}",
        "messageText": "=OS gerada com sucesso!\nAcesse através do link abaixo:\n\n{{ $('Id e link').item.json.name }}\n\n{{ $('Id e link').item.json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        4240,
        -992
      ],
      "id": "635dc49b-e05b-473b-a13b-837adfdc2abd",
      "name": "Envia OS1",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteFile",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Id e Name?').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        6544,
        -1200
      ],
      "id": "3ee3f30a-50cf-42a4-a96a-7c5cd1d15250",
      "name": "Deleta Imagens",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Yg0MqWhsgxFkLHnh",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "*Para consultar todas as OS, acesse o link abaixo:*\n\nhttps://drive.google.com/drive/folders/1nAeEaoG6QNZq2fuonNJB7GluFIhOffL1\n",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -1184
      ],
      "id": "90afdc15-1b6f-48e9-b0c4-edaf327d942a",
      "name": "Opcao2",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cdd26832-a245-46f5-ae40-9c1c73ee68c5",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "9c1c92b4-c090-400c-952b-40aa56ee5824",
              "name": "name",
              "value": "={{ $json.name }}",
              "type": "string"
            },
            {
              "id": "a3722cd0-8dab-4ba5-9a6a-800a6e113562",
              "name": "webViewLink",
              "value": "={{ $json.webViewLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3648,
        -992
      ],
      "id": "b2f9cb26-be10-4610-8422-9dd044c8832f",
      "name": "Id e link"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cdd26832-a245-46f5-ae40-9c1c73ee68c5",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "9c1c92b4-c090-400c-952b-40aa56ee5824",
              "name": "name",
              "value": "={{ $json.name }}",
              "type": "string"
            },
            {
              "id": "a3722cd0-8dab-4ba5-9a6a-800a6e113562",
              "name": "webViewLink",
              "value": "={{ $json.webViewLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6544,
        -1344
      ],
      "id": "383ccba8-6faf-4736-aff4-f0166105b4ac",
      "name": "Id e link1"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "*Para consultar OS por cliente, digite o nome fantasia e/ou cnpj no seguinte formato:*\n\nEx: OS_{nome fantasia}\nEx: OS_{cnpj}\nEx: OS_{nome fantasia}_{cnpj}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -1040
      ],
      "id": "fbc45f04-31ed-457b-81eb-1941f60c4bd6",
      "name": "Opcao3",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
          "mode": "list",
          "cachedResultName": "OS_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 824063472,
          "mode": "list",
          "cachedResultName": "DB_OS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=824063472"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1568,
        -160
      ],
      "id": "63085b1e-0547-4eb2-9915-64caaf066c27",
      "name": "OS consult",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9ea726e0-f65f-40c9-8372-f35482aa393f",
              "name": "message.conversation",
              "value": "={{ $('Webhook').item.json.body.data.message.conversation }}",
              "type": "string"
            },
            {
              "id": "403b707f-3230-4e09-bad7-3e22285eebe2",
              "name": "body.data.key.remoteJid",
              "value": "={{ $('@s.whatsapp.net').item.json.remoteJid }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1376,
        -160
      ],
      "id": "d6c1db92-e521-4339-9db5-4234a53d5ec3",
      "name": "InputOS"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $items(\"InputOS\").map(i => i.json.body.data.key.remoteJid).join(\", \") }}",
        "messageText": "={{ $json['OS NOME'] }}\n\n{{ $json['OS LINK'] }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2336,
        -144
      ],
      "id": "fb586b30-61eb-47d5-9171-e614b3295f23",
      "name": "OS retorno",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $items(\"InputOS\").map(i => i.json.body.data.key.remoteJid).join(\", \") }}",
        "messageText": "Sinto muito😓. Não consegui encontrar a OS solicitada. *Tente outro parâmetro ou busque por todas as OS na opção* 2️⃣.",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2176,
        -288
      ],
      "id": "81192117-4589-437a-86fb-1e45f35869f3",
      "name": "OS sem retorno",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.aviso }}",
                    "rightValue": "={{ $json.encontrado }}",
                    "operator": {
                      "type": "boolean",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "14cb2cae-9efa-4301-a85d-4b9f0a205f47"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nao encontrado"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e84b75c3-aec4-4234-91de-0d9f1f51576c",
                    "leftValue": "={{ $json.row_number }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Encontrado"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1904,
        -160
      ],
      "id": "dde7f321-c98f-4e5a-872c-f980bd6c4d44",
      "name": "Switch1"
    },
    {
      "parameters": {
        "jsCode": "// 1. Pega a conversa do nó InputOS\nconst conversa = $('InputOS').first().json.message.conversation;\n\n// 2. Regex para capturar todas as ocorrências de \"OS_xxx\"\n// Vai capturar qualquer texto depois de OS_ até espaço, ponto e vírgula ou fim\nconst regex = /OS_([\\wçãáéíóúâêîôû.\\- ]+)/gi;\nlet matches = [];\nlet match;\n\nwhile ((match = regex.exec(conversa)) !== null) {\n  matches.push(match[1].trim()); // pega somente o que vem depois de \"OS_\"\n}\n\n// 3. Array de saída\nconst output = [];\n\n// 4. Percorre cada linha do Sheets\nitems.forEach(item => {\n  const linha = item.json;\n\n  // Para cada OS capturado na conversa\n  const osEncontrados = matches.filter(osTexto => {\n    // Se o OS for composto, como \"NOME FANTASIA_CNPJ\", separa por \"_\"\n    const partes = osTexto.split(\"_\").map(p => p.trim().toLowerCase());\n\n    // Verifica se **todos os valores da linha correspondentes às partes** existem\n    return partes.every(p => \n      Object.values(linha).some(valor =>\n        valor && valor.toString().toLowerCase().includes(p)\n      )\n    );\n  });\n\n  if (osEncontrados.length > 0) {\n    // Adiciona toda a linha ao output\n    output.push({ json: linha });\n  }\n});\n\n// 5. Caso não encontre nada\nif (output.length === 0) {\n  output.push({\n    json: { aviso: \"Nenhum OS encontrado na conversa\" }\n  });\n}\n\nreturn output;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1744,
        -160
      ],
      "id": "0c47cbf9-2b9d-4cc8-9532-77b26b6cfd75",
      "name": "Busca Item"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "Para cadastrar um lead preencha o formulário abaixo:\n\nhttps://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -896
      ],
      "id": "26b6085e-62c0-4276-b07d-a154d183e07e",
      "name": "Opcao4",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "*Para consultar todos os clientes, acesse o link abaixo:*\n\nhttps://docs.google.com/spreadsheets/d/1UOKUJUAfGqgLoukUSzf38ceTzDY5b9KCfnB6nifpkF8/edit?gid=1955323770#gid=1955323770",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -752
      ],
      "id": "0ef74276-349c-4d81-b324-75480dfd0961",
      "name": "Opcao5",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "Até logo👋. Para me chamar novamente, basta digitar *Magnetto*",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -608
      ],
      "id": "89e87212-8d72-430d-8a09-174bdd85e2e0",
      "name": "Opcao6",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "cadastra-cliente",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        1568,
        -896
      ],
      "id": "2027fa3f-8f5e-4890-b9e5-bc22a2ea640d",
      "name": "Webhook4",
      "webhookId": "c9903894-999b-4b0a-ba88-396ca0c58503"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a6c8faeb-4778-4734-92d1-feb2fbf91bb5",
              "name": "razao_social",
              "value": "={{ $json.body.razao_social }}",
              "type": "string"
            },
            {
              "id": "43d95c98-b5cf-44b0-8b02-bd41b4e59cd1",
              "name": "fantasia",
              "value": "={{ $json.body.fantasia }}",
              "type": "string"
            },
            {
              "id": "72c28476-251c-49a7-a85e-2cfff36ce10b",
              "name": "cnpj",
              "value": "={{ $json.body.cnpj }}",
              "type": "string"
            },
            {
              "id": "0295e266-295c-4666-a18e-847986475fb1",
              "name": "cidade",
              "value": "={{ $json.body.cidade }}",
              "type": "string"
            },
            {
              "id": "ee2bf291-c0eb-45d7-92bf-3a985cc9fd91",
              "name": "uf",
              "value": "={{ $json.body.uf }}",
              "type": "string"
            },
            {
              "id": "948b3fac-f623-432c-b75b-8ccb1350b353",
              "name": "telefone",
              "value": "={{ $json.body.telefone }}",
              "type": "string"
            },
            {
              "id": "054546a9-a06d-4bf6-9f24-1ab2965185a8",
              "name": "email",
              "value": "={{ $json.body.email }}",
              "type": "string"
            },
            {
              "id": "3d5e47b0-3779-4772-8c7d-d0e31323087d",
              "name": "responsavel",
              "value": "={{ $json.body.responsavel }}",
              "type": "string"
            },
            {
              "id": "e8279561-82e9-4161-8ef8-d2c99a0b5c01",
              "name": "equipamentos",
              "value": "={{ $json.body.equipamentos }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1744,
        -896
      ],
      "id": "301ac7be-47bf-4898-b799-4c6c5fe2f820",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
          "mode": "list",
          "cachedResultName": "OS_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1955323770,
          "mode": "list",
          "cachedResultName": "DB_cliente",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=1955323770"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID CLIENTE": "={{ $('Code in JavaScript').item.json.id }}",
            "RAZAO SOCIAL": "={{ $('Code in JavaScript').item.json.razao_social }}",
            "NOME FANTASIA": "={{ $('Code in JavaScript').item.json.fantasia }}",
            "CNPJ": "={{ $('Code in JavaScript').item.json.cnpj }}",
            "CIDADE": "={{ $('Code in JavaScript').item.json.cidade }}",
            "UF": "={{ $('Code in JavaScript').item.json.uf }}",
            "TELEFONE": "={{ $('Code in JavaScript').item.json.telefone }}",
            "EMAIL": "={{ $('Code in JavaScript').item.json.email }}",
            "RESPONSAVEL": "={{ $('Code in JavaScript').item.json.responsavel }}",
            "DATA CADASTRO CLIENTE": "={{ $now.format('dd/LL/yyyy T') }}"
          },
          "matchingColumns": [
            "ID CLIENTE"
          ],
          "schema": [
            {
              "id": "ID CLIENTE",
              "displayName": "ID CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "RAZAO SOCIAL",
              "displayName": "RAZAO SOCIAL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "NOME FANTASIA",
              "displayName": "NOME FANTASIA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CNPJ",
              "displayName": "CNPJ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CIDADE",
              "displayName": "CIDADE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "UF",
              "displayName": "UF",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TELEFONE",
              "displayName": "TELEFONE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "EMAIL",
              "displayName": "EMAIL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "RESPONSAVEL",
              "displayName": "RESPONSAVEL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "DATA CADASTRO CLIENTE",
              "displayName": "DATA CADASTRO CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2096,
        -896
      ],
      "id": "7e30560c-a9b8-432b-9683-b629186d361a",
      "name": "DB2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
          "mode": "list",
          "cachedResultName": "DBRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "dbRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2096,
        -752
      ],
      "id": "7c2e0cde-44d9-49e8-a042-4f296fa57b5b",
      "name": "RemoteId3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d781a289-6d68-40eb-96c7-ec1447d05d67",
              "name": "remoteJid",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "f4a7fedc-08c2-44af-a786-12dc2d32e1c2",
              "name": "remoteJidAlt",
              "value": "={{ $json.body.data.key.remoteJidAlt }}",
              "type": "string"
            },
            {
              "id": "ec3f6212-f64c-456f-b6e5-a14d7d2f70b9",
              "name": "conversation",
              "value": "={{ $json.body.data.message.conversation }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -48,
        -880
      ],
      "id": "967d3c7c-d934-4a41-b615-fa53991498be",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "jsCode": "// Pega o primeiro item\nconst data = $input.first().json;\n\n// Lista de campos possíveis\nconst campos = [\n  data.remoteJid,\n  data.remoteJidAlt,\n  data.conversation\n];\n\n// Filtra e pega somente o que contém \"@s.whatsapp.net\"\nconst result = campos.find(v => typeof v === 'string' && v.includes('@s.whatsapp.net'));\n\n// Retorna o resultado\nreturn [\n  {\n    json: {\n      remoteJid: result || null\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        160,
        -880
      ],
      "id": "d36ddf59-b982-41e7-9c4b-4200d7930d97",
      "name": "@s.whatsapp.net"
    },
    {
      "parameters": {
        "path": "form-autocomplete",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "0170a4dc-be53-4045-9d33-4d6c09073a88",
      "name": "Carrega HTML",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        1568,
        -1472
      ],
      "webhookId": "form-autocomplete-001"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {}
      },
      "id": "0a164912-75a4-41a8-b7c0-0cca43b17169",
      "name": "Retorna HTML",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1904,
        -1472
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "autocomplete-busca",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*",
          "responseHeaders": {
            "entries": [
              {
                "name": "=Access-Control-Allow-Methods",
                "value": "*"
              },
              {
                "name": "=Access-Control-Allow-Methods",
                "value": "=GET, POST, OPTIONS"
              }
            ]
          }
        }
      },
      "id": "d6b76b6d-534c-40ad-97a5-8857b73ca8c4",
      "name": "Busca no Sheets",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2064,
        -1472
      ],
      "webhookId": "autocomplete-busca-001"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "c00c1727-4757-41d4-9615-c6ecf0e3141a",
      "name": "Retorna sugestões",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        2752,
        -1472
      ]
    },
    {
      "parameters": {
        "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1955323770&tqx=out:json&tq=SELECT%20*",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2224,
        -1472
      ],
      "id": "f96f5d0e-475f-4fa8-9477-fd226d6634c9",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $json.RemoteId }}",
        "messageText": "=Cliente cadastrado com sucesso! Deseja criar uma OS?\n\n7️⃣-Sim\n8️⃣-Não",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2272,
        -752
      ],
      "id": "14cab1a7-d46c-4b28-90ed-3444ed50505e",
      "name": "Confirma Cliente",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "path": "cadastra-cliente",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2944,
        -576
      ],
      "id": "c12a9094-a099-4be3-8b61-f50f56141d23",
      "name": "Webhook5",
      "webhookId": "8afdcc7b-cb27-48e4-919c-38d8824e1cf1"
    },
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n<title>Cadastro de Cliente</title>\n\n<style>\n:root{\n  --bg:#f3f6fb;\n  --surface:#ffffff;\n  --muted:#6b7280;\n  --accent:#0b74ff;\n  --danger:#dc2626;\n  --card-radius:12px;\n  --input-radius:8px;\n  --border:#e6e9ef;\n  --shadow-1:0 6px 20px rgba(16,24,40,0.06);\n  --font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial;\n  --max-width:420px;\n}\n\n*{box-sizing:border-box}\nbody{\n  margin:0;\n  font-family:var(--font-family);\n  background:linear-gradient(180deg,var(--bg),#eef4ff 120px);\n  padding:24px 12px;\n  display:flex;\n  justify-content:center;\n}\n\n.card{\n  width:100%;\n  max-width:var(--max-width);\n  background:#fff;\n  padding:25px;\n  border-radius:var(--card-radius);\n  box-shadow:var(--shadow-1);\n}\n\n.title{font-size:20px;font-weight:700;margin-bottom:4px}\n.subtitle{font-size:14px;color:var(--muted);margin-bottom:20px}\n\nlabel{display:block;font-size:13px;margin-bottom:6px;font-weight:600}\n.group{margin-bottom:16px}\n\n.field{\n  width:100%;\n  padding:11px 12px;\n  border-radius:var(--input-radius);\n  border:1px solid var(--border);\n  font-size:14px;\n}\n\nbutton{\n  padding:12px 16px;\n  border:0;\n  border-radius:var(--card-radius);\n  background:var(--accent);\n  color:#fff;\n  font-weight:700;\n  cursor:pointer;\n}\n\nbutton.btn-ghost{\n  background:transparent;\n  color:var(--accent);\n  border:1px solid rgba(11,116,255,0.2);\n}\n\n.equip-list{margin-top:12px}\n.equip-item{\n  display:flex;\n  justify-content:space-between;\n  align-items:center;\n  padding:8px 10px;\n  border:1px solid #eee;\n  border-radius:8px;\n  margin-bottom:6px;\n  font-size:14px;\n}\n\n.modal{\n  display:none;\n  position:fixed;\n  inset:0;\n  background:rgba(0,0,0,.5);\n  justify-content:center;\n  align-items:center;\n}\n.modal-content{\n  background:#fff;\n  padding:20px;\n  border-radius:12px;\n  width:90%;\n  max-width:400px;\n}\n.close{\n  float:right;\n  cursor:pointer;\n  font-size:20px;\n}\n\n/* input sentinela invisível mas válido */\n.validator{\n  position:absolute;\n  opacity:0;\n  height:0;\n  pointer-events:none;\n}\n</style>\n</head>\n<body>\n\n<form class=\"card\" id=\"equipForm\" novalidate>\n  <div class=\"title\">Cadastro de Cliente</div>\n  <div class=\"subtitle\">Preencha corretamente os dados abaixo.</div>\n\n  <div class=\"group\"><label>Razão Social</label><input class=\"field\" name=\"razao_social\" required></div>\n  <div class=\"group\"><label>Nome Fantasia</label><input class=\"field\" name=\"fantasia\" required></div>\n  <div class=\"group\"><label>CNPJ</label><input class=\"field\" name=\"cnpj\" required></div>\n  <div class=\"group\"><label>Cidade</label><input class=\"field\" name=\"cidade\" required></div>\n\n  <div class=\"group\">\n    <label>UF</label>\n    <select name=\"uf\" class=\"field\" required>\n      <option value=\"\">Selecione</option> <option value=\"AC\">AC</option> <option value=\"AL\">AL</option> <option value=\"AP\">AP</option> <option value=\"AM\">AM</option> <option value=\"BA\">BA</option> <option value=\"CE\">CE</option> <option value=\"DF\">DF</option> <option value=\"ES\">ES</option> <option value=\"GO\">GO</option> <option value=\"MA\">MA</option> <option value=\"MT\">MT</option> <option value=\"MS\">MS</option> <option value=\"MG\">MG</option> <option value=\"PA\">PA</option> <option value=\"PB\">PB</option> <option value=\"PR\">PR</option> <option value=\"PE\">PE</option> <option value=\"PI\">PI</option> <option value=\"RJ\">RJ</option> <option value=\"RN\">RN</option> <option value=\"RS\">RS</option> <option value=\"RO\">RO</option> <option value=\"RR\">RR</option> <option value=\"SC\">SC</option> <option value=\"SE\">SE</option> <option value=\"SP\">SP</option> <option value=\"TO\">TO</option>\n    </select>\n  </div>\n\n  <div class=\"group\"><label>Telefone</label><input class=\"field\" name=\"telefone\" required></div>\n  <div class=\"group\"><label>Email</label><input class=\"field\" name=\"email\" type=\"email\" required></div>\n  <div class=\"group\"><label>Responsável</label><input class=\"field\" name=\"responsavel\" required></div>\n\n  <button type=\"button\" onclick=\"openModal()\">Adicionar Equipamento</button>\n  <div id=\"equipamentosPreview\" class=\"equip-list\"></div>\n\n  <!-- INPUT SENTINELA (VALIDAÇÃO DE EQUIPAMENTOS) -->\n  <input id=\"equipValidator\" class=\"validator\">\n\n  <button type=\"submit\">Cadastrar Cliente</button>\n</form>\n\n<div class=\"modal\" id=\"modal\">\n  <div class=\"modal-content\">\n    <span class=\"close\" onclick=\"closeModal()\">×</span>\n    <h3>Adicionar Equipamento</h3>\n\n    <div class=\"group\"><label>Tipo</label><input id=\"equipTipo\" class=\"field\" value=\"Ressonância Magnética\"></div>\n    <div class=\"group\"><label>Fabricante</label> <select id=\"equipFabricante\" name=\"equipFabricante\" class=\"field compact\" required > <option value=\"\">Selecione</option> <option>Philips</option><option>GE HealthCare</option><option>Siemens Healthineers AG</option><option>Canon Medical Systems</option><option>Hitachi</option> </select></div>\n    <div class=\"group\"><label>Modelo</label> <select id=\"equipModelo\" name=\"equipModelo\" class=\"field compact\" required > <option value=\"\">Selecione</option> <option>Achieva 1.5T</option><option>Intera/Achieva 1.5T</option><option>NT/Intera 1.0T</option><option>NT/Intera 0.5T</option><option>ACS-NT 1.5T</option><option>Achieva 3.0T</option><option>Multiva 1.5T</option><option>Prodiva1.5T</option><option>Ingenia Ambition 1.5T</option><option>Ingenia Elition 1.5T</option> </select></div>\n    <div class=\"group\"><label>Nº Série</label><input id=\"equipSerie\" class=\"field\"></div>\n\n    <button type=\"button\" onclick=\"adicionarEquipamento()\">Adicionar</button>\n  </div>\n</div>\n\n<script>\nlet equipamentos = [];\nconst form = document.getElementById(\"equipForm\");\nconst validator = document.getElementById(\"equipValidator\");\n\nform.addEventListener(\"submit\", async e => {\n  e.preventDefault();\n\n  // valida equipamentos\n  if (equipamentos.length === 0) {\n    validator.setCustomValidity(\"Cadastre pelo menos 1 equipamento.\");\n  } else {\n    validator.setCustomValidity(\"\");\n  }\n\n  if (!form.checkValidity()) {\n    form.reportValidity();\n    return;\n  }\n\n  const data = Object.fromEntries(new FormData(form));\n  data.equipamentos = equipamentos;\n\n  await fetch(\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(data)\n  });\n\n  alert(\"Cliente cadastrado com sucesso!\");\n  form.reset();\n  equipamentos = [];\n  atualizarPreview();\n});\n\nfunction openModal(){ modal.style.display=\"flex\"; }\nfunction closeModal(){ modal.style.display=\"none\"; }\n\nfunction adicionarEquipamento(){\n  const tipo = equipTipo.value.trim();\n  const fabricante = equipFabricante.value.trim();\n  const modelo = equipModelo.value.trim();\n  const serie = equipSerie.value.trim();\n\n  if(!tipo || !fabricante || !modelo || !serie){\n    alert(\"Preencha todos os campos do equipamento.\");\n    return;\n  }\n\n  equipamentos.push({tipo,fabricante,modelo,serie});\n  atualizarPreview();\n  closeModal();\n}\n\nfunction atualizarPreview(){\n  const div = document.getElementById(\"equipamentosPreview\");\n  div.innerHTML = \"\";\n  equipamentos.forEach((e,i)=>{\n    div.innerHTML += `\n      <div class=\"equip-item\">\n        ${e.tipo} | ${e.fabricante} | ${e.modelo} | ${e.serie}\n        <button type=\"button\" class=\"btn-ghost\" onclick=\"removerEquipamento(${i})\">x</button>\n      </div>`;\n  });\n}\n\nfunction removerEquipamento(i){\n  equipamentos.splice(i,1);\n  atualizarPreview();\n}\n</script>\n\n</body>\n</html>\n"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        3120,
        -576
      ],
      "id": "1671b721-534b-413b-9c83-bf81f05b5c6f",
      "name": "HTML"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3280,
        -576
      ],
      "id": "4bb62877-6e6f-4a4d-958a-771e70d8e2ba",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "jsCode": "// Gera um ID aleatório de 6 dígitos (único para toda a execução)\nconst idUnico = Math.floor(100000 + Math.random() * 900000);\n\n// Função para capitalizar a primeira letra da cidade\nfunction formatarCidade(cidade) {\n  if (!cidade || typeof cidade !== 'string') return cidade;\n  const texto = cidade.toLowerCase().trim();\n  return texto.charAt(0).toUpperCase() + texto.slice(1);\n}\n\n// Função para formatar CNPJ\nfunction formatarCNPJ(cnpj) {\n  if (!cnpj) return cnpj;\n\n  const numeros = cnpj.replace(/\\D/g, '');\n  if (numeros.length !== 14) return cnpj;\n\n  return numeros.replace(\n    /^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})$/,\n    '$1.$2.$3/$4-$5'\n  );\n}\n\n// Array de saída\nconst output = [];\n\n// Itera sobre cada cliente\nitems.forEach(item => {\n  const cliente = item.json;\n\n  const equipamentos = (cliente.equipamentos || []).map(equip => ({\n    tipo: equip.tipo,\n    fabricante: equip.fabricante,\n    modelo: equip.modelo,\n    serie: equip.serie\n  }));\n\n  output.push({\n    json: {\n      id: idUnico,\n      razao_social: cliente.razao_social,\n      fantasia: cliente.fantasia,\n      cnpj: formatarCNPJ(cliente.cnpj),\n      cidade: formatarCidade(cliente.cidade),\n      uf: cliente.uf,\n      telefone: cliente.telefone,\n      email: cliente.email,\n      responsavel: cliente.responsavel,\n      equipamentos\n    }\n  });\n});\n\nreturn output;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1904,
        -896
      ],
      "id": "22fa8e9b-7285-4eb7-8913-e86ddbdf4bff",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=id:{{ $json.data.key.remoteJid }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1568,
        -320
      ],
      "id": "a1e5c5db-df5a-4b81-a7eb-7b8a98c51d67",
      "name": "Redis7",
      "credentials": {
        "redis": {
          "id": "zxoKZ2hHG1VotLrg",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
          "mode": "list",
          "cachedResultName": "DBRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "dbRedis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1744,
        -320
      ],
      "id": "2c599dc6-775e-4620-b0c4-0d636f692488",
      "name": "Delete RemoteId3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "Até logo👋. Para me chamar novamente, basta digitar *Magnetto*",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -320
      ],
      "id": "60a70d7e-169e-4d46-b5f6-484ae1dd28ff",
      "name": "Opcao8",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "teste",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "*Por favor, preencha o formulário abaixo para gerar a ordem de serviço:*\n\nhttps://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/form-autocomplete",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1376,
        -464
      ],
      "id": "ed7362a0-32ff-4d83-a42e-43a588a39513",
      "name": "Opcao7",
      "credentials": {
        "evolutionApi": {
          "id": "79qcaif6AQLNsa1x",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// items é o array de entrada do nó Sheets\nconst outputMap = {};\n\n// Percorre cada item\nitems.forEach(item => {\n  const linha = item.json;\n  const id = linha['ID CLIENTE'];\n\n  // Se ainda não adicionamos esse ID, adicionamos\n  if (!outputMap[id]) {\n    outputMap[id] = linha;\n  }\n});\n\n// Converte o mapa para array no formato n8n\nconst output = Object.values(outputMap).map(linha => ({ json: linha }));\n\nreturn output;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2176,
        -144
      ],
      "id": "a5138d1d-3ba8-4c0f-a831-d479318f08e6",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
          "mode": "list",
          "cachedResultName": "OS_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 824063472,
          "mode": "list",
          "cachedResultName": "DB_OS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=824063472"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "OS NOME": "={{ $('Id e link').item.json.name }}",
            "OS LINK": "={{ $('Id e link').item.json.webViewLink }}",
            "DATA CADASTRO OS": "={{ $now.format('dd/LL/yyyy T') }}"
          },
          "matchingColumns": [
            "CNPJ"
          ],
          "schema": [
            {
              "id": "OS NOME",
              "displayName": "OS NOME",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "OS LINK",
              "displayName": "OS LINK",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DATA CADASTRO OS",
              "displayName": "DATA CADASTRO OS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4432,
        -992
      ],
      "id": "71426b1c-1215-4007-ad80-a3cfc07520a4",
      "name": "DB7",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('dados1').item.json.email }}",
        "subject": "OS GERADA MEDICALSPIN",
        "emailType": "text",
        "message": "={{ $('Id e link').item.json.name }}\n{{ $('Id e link').item.json.webViewLink }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        3856,
        -992
      ],
      "id": "ad054b87-4338-4614-8ce1-bcf5cbf550a9",
      "name": "Send a message",
      "webhookId": "f2423354-0a17-4996-b6c3-7512ca3b739f",
      "credentials": {
        "gmailOAuth2": {
          "id": "KvJgpEKJ3c13wnGv",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('dados2').item.json.email }}",
        "subject": "OS GERADA MEDICALSPIN",
        "emailType": "text",
        "message": "={{ $('Id e link1').item.json.name }}\n{{ $('Id e link1').item.json.webViewLink }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        6912,
        -1344
      ],
      "id": "b2822ee2-6949-479f-b380-85311e6473bc",
      "name": "Send a message1",
      "webhookId": "f2423354-0a17-4996-b6c3-7512ca3b739f",
      "credentials": {
        "gmailOAuth2": {
          "id": "KvJgpEKJ3c13wnGv",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens do nó \"dados\"\nconst dados = $('dados').all();\n\n// Retorna exatamente o que veio do nó \"dados\"\nreturn dados;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6736,
        -1344
      ],
      "id": "0b67aa39-5482-4c45-a985-567e2df4edeb",
      "name": "dados2"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
          "mode": "list",
          "cachedResultName": "OS_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1612720329,
          "mode": "list",
          "cachedResultName": "DB_equipamento",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=1612720329"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID CLIENTE": "={{ $('DB2').item.json[\"ID CLIENTE\"] }}",
            "TIPO EQUIPAMENTO": "={{ $('Code in JavaScript2').item.json.tipo }}",
            "FABRICANTE": "={{ $('Code in JavaScript2').item.json.fabricante }}",
            "MODELO": "={{ $('Code in JavaScript2').item.json.modelo }}",
            "SERIE": "={{ $('Code in JavaScript2').item.json.serie }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "ID CLIENTE",
              "displayName": "ID CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO EQUIPAMENTO",
              "displayName": "TIPO EQUIPAMENTO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "FABRICANTE",
              "displayName": "FABRICANTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "MODELO",
              "displayName": "MODELO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "SERIE",
              "displayName": "SERIE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2432,
        -896
      ],
      "id": "e545a129-c85c-43f6-a6e2-e88acb8d6648",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1612720329&tqx=out:json&tq=SELECT%20*",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2400,
        -1472
      ],
      "id": "752bd811-74fa-455c-ad24-38fb16891990",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
          "mode": "list",
          "cachedResultName": "OS_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 824063472,
          "mode": "list",
          "cachedResultName": "DB_OS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=824063472"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "OS NOME": "={{ $('Id e link1').item.json.name }}",
            "OS LINK": "={{ $('Id e link1').item.json.webViewLink }}",
            "DATA CADASTRO OS": "={{ $now.format('dd/LL/yyyy T') }}"
          },
          "matchingColumns": [
            "CNPJ"
          ],
          "schema": [
            {
              "id": "OS NOME",
              "displayName": "OS NOME",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "OS LINK",
              "displayName": "OS LINK",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DATA CADASTRO OS",
              "displayName": "DATA CADASTRO OS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7456,
        -1344
      ],
      "id": "bfcd9b76-1150-4f02-b4ca-a02c5fbd5a83",
      "name": "DB10",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2DSmp4SarxDNx6pV",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "html": "<html lang=\"pt-br\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>Gerador de OS Medical Spin</title>\n\n  <!-- CSS NOVO APLICADO -->\n  <style>\n    :root{\n      --bg:#f3f6fb;\n      --surface:#ffffff;\n      --muted:#6b7280;\n      --accent:#0b74ff;\n      --accent-600:#095fcc;\n      --danger:#dc2626;\n      --card-radius:12px;\n      --input-radius:8px;\n      --border:#e6e9ef;\n      --glass:rgba(11,116,255,0.06);\n      --shadow-1:0 6px 20px rgba(16,24,40,0.06);\n      --shadow-2:0 2px 8px rgba(16,24,40,0.04);\n      --font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial;\n      --max-width:980px;\n    }\n\n    *{box-sizing:border-box}\n    html,body{height:100%}\n    body{\n      margin:0;\n      font-family:var(--font-family);\n      background:linear-gradient(180deg,var(--bg),#eef4ff 120px);\n      color:#0f172a;\n      -webkit-font-smoothing:antialiased;\n      -moz-osx-font-smoothing:grayscale;\n      line-height:1.45;\n      padding:24px 12px;\n    }\n\n    .container{max-width:var(--max-width);margin:0 auto;}\n\n    .field-readonly {\n      background: #f1f3f5 !important;\n      color: #6b7280 !important;\n      border-color: #d1d5db !important;\n      cursor: not-allowed;\n    }\n    \n    .field-readonly:focus {\n      box-shadow: none !important;\n    }\n\n    /* Títulos */\n    h2 { margin-top:0; }\n\n    /* caixas e estrutura */\n    .section-title{font-size:15px;font-weight:700;color:#0f172a;margin-top:22px}\n    .section-sub{font-size:13px;color:var(--muted);margin-bottom:12px}\n\n    label{display:block;font-size:13px;margin-bottom:6px;color:#334155;font-weight:600}\n\n    /* =========================\n   AUTOCOMPLETE – SUGESTÕES\n========================= */\n\n#sugestoes {\n  position: relative;\n  margin-top: 6px;\n  margin-bottom: 16px;\n  border-radius: 10px;\n  border: 1px solid var(--border);\n  background: #ffffff;\n  box-shadow: 0 12px 30px rgba(16,24,40,0.12);\n  max-height: 320px;\n  overflow-y: auto;\n}\n\n/* categoria */\n#sugestoes .categoria {\n  font-size: 12px;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: .04em;\n  color: #64748b;\n  padding: 10px 12px;\n  background: #f8fafc;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n/* cliente */\n.item-cliente {\n  padding: 10px 12px;\n  border-bottom: 1px solid #eef2f7;\n}\n\n.item-cliente:last-child {\n  border-bottom: none;\n}\n\n.item-cliente > strong {\n  font-size: 14px;\n  color: #0f172a;\n}\n\n/* equipamentos */\n.item-equipamento {\n  margin-top: 6px;\n  margin-left: 8px;\n  padding: 8px 10px;\n  border-radius: 8px;\n  background: #f8fafc;\n  border: 1px solid #e5e7eb;\n  font-size: 13px;\n  color: #334155;\n\n  /* UX */\n  cursor: pointer;\n  transition: background .15s ease, border-color .15s ease, transform .05s ease;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n/* hover claro */\n.item-equipamento:hover {\n  background: #eef4ff;\n  border-color: var(--accent);\n  transform: translateX(2px);\n}\n\n/* clique */\n.item-equipamento:active {\n  transform: translateX(0);\n  background: #e0ecff;\n}\n\n/* ícone */\n.item-equipamento::before {\n  content: \"🖱️\";\n  font-size: 14px;\n}\n\n/* scrollbar discreta */\n#sugestoes::-webkit-scrollbar {\n  width: 8px;\n}\n\n#sugestoes::-webkit-scrollbar-thumb {\n  background: #d1d5db;\n  border-radius: 4px;\n}\n\n#sugestoes::-webkit-scrollbar-thumb:hover {\n  background: #9ca3af;\n}\n\n    .item-sugestao {\n      padding: 10px 12px;\n      cursor: pointer;\n      border-bottom: 1px solid #eef2f7;\n      font-size: 14px;\n    }\n    .item-sugestao:hover { background-color: #f3f6fb; }\n\n    .categoria {\n      font-weight: 700;\n      background: #f7f9ff;\n      padding: 8px 10px;\n      border-bottom: 1px solid #e1e6ef;\n      font-size: 13px;\n      color: var(--muted);\n    }\n\n    /* inputs */\n    input[type=text], input[type=tel], input[type=date], select, textarea {\n      width: 100%;\n      padding: 11px 12px;\n      border-radius: var(--input-radius);\n      border: 1px solid var(--border);\n      background: linear-gradient(180deg,#ffffff,#fbfdff);\n      font-size: 14px;\n      color: #0f172a;\n      transition: box-shadow .16s ease,border-color .16s ease,transform .04s ease;\n      outline: none;\n    }\n    textarea{min-height:96px;resize:vertical}\n\n    input:focus, select:focus, textarea:focus {\n      border-color: var(--accent);\n      box-shadow: 0 8px 30px rgba(11,116,255,0.08), 0 0 0 4px var(--glass);\n    }\n\n    /* grid */\n    .grid{display:grid;gap:12px}\n    .cols-2{grid-template-columns:1fr 1fr}\n    .cols-3{grid-template-columns:repeat(3,1fr)}\n    @media (max-width:780px){.cols-3{grid-template-columns:1fr}}\n    @media (max-width:600px){.cols-2{grid-template-columns:1fr}}\n\n    /* repeat lists */\n    .repeat-list{\n      border-radius:10px;padding:10px;border:1px dashed var(--border);background:#fbfdff\n    }\n\n    .repeat-item{\n      padding:12px;\n      border-radius:10px;\n      background:linear-gradient(180deg,#fff,#fbfdff);\n      border:1px solid #eef2f7;\n      box-shadow:var(--shadow-2);\n      margin-bottom:10px;\n      display:grid;gap:8px\n    }\n\n    .required{color:var(--danger);font-weight:800;margin-left:6px}\n\n    /* ações */\n    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:20px}\n\n    button{\n      border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;\n      background:var(--accent);color:#fff;\n      box-shadow:0 6px 18px rgba(11,116,255,0.12);\n      transition:transform .12s ease, box-shadow .12s ease, background .12s;\n    }\n    button:hover{transform:translateY(-2px)}\n    button:active{transform:translateY(0)}\n\n    .btn-ghost{\n      background:transparent;color:var(--accent);\n      border:1px solid rgba(11,116,255,0.18);\n      box-shadow:none\n    }\n    .btn-ghost:hover{background:rgba(11,116,255,0.04)}\n\n    /* small tweaks for suggestion box appended to body */\n    #suggestionBox { position: absolute; background: #fff; border: 1px solid #ccc; border-radius:6px; box-shadow: var(--shadow-2); z-index: 10000; }\n  </style>\n</head>\n\n<body>\n\n<form id=\"osForm\"><!-- necessário para FormData funcionar -->\n  <div class=\"container\">\n    <h2>Gerador de OS V1.0.0</h2>\n    <p>Digite para buscar em todos os campos da base e receber sugestões detalhadas.</p>\n    <p>Não encontrou a sugestão do cliente?  \n    <a href=\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente\" target=\"_blank\" rel=\"noopener noreferrer\">\n        Cadastre o cliente clicando aqui\n    </a>\n    </p>\n\n    <label>Buscar cliente</label>\n    <input type=\"text\" id=\"busca\" placeholder=\"Digite algo...\" autocomplete=\"off\" />\n\n    <div id=\"sugestoes\"></div>\n\n    <div>\n      <div class=\"section-title\">1 — Dados da Empresa</div>\n      <div class=\"section-sub\">Informações básicas do cliente</div>\n    </div>\n\n    <!-- CAMPOS AUTOMÁTICOS (READONLY) -->\n    <label class=\"label\">Razão Social</label>\n    <input type=\"text\" id=\"razao_social\" name=\"razao_social\" readonly class=\"field-readonly\" class=\"field-readonly class=\"field-readonly\"\"/>\n\n    <label class=\"label\">Nome Fantasia</label>\n    <input type=\"text\" id=\"nome_fantasia\" name=\"nome_fantasia\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">CNPJ</label>\n    <input type=\"text\" id=\"cnpj\" name=\"cnpj\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Cidade</label>\n    <input type=\"text\" id=\"cidade\" name=\"cidade\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">UF</label>\n    <input type=\"text\" id=\"uf\" name=\"uf\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Telefone</label>\n    <input type=\"text\" id=\"telefone\" name=\"telefone\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Email</label>\n    <input type=\"text\" id=\"email\" name=\"email\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Responsável</label>\n    <input type=\"text\" id=\"responsavel\" name=\"responsavel\" readonly class=\"field-readonly\" />\n\n    <div>\n      <div class=\"section-title\">2 — Dados do Equipamento</div>\n      <div class=\"section-sub\">Identificação do equipamento</div>\n    </div>\n\n    <label class=\"label\">Tipo de Equipamento</label>\n    <input type=\"text\" id=\"tipo_equipamento\" name=\"tipo_equipamento\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Fabricante</label>\n    <input type=\"text\" id=\"fabricante\" name=\"fabricante\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Modelo</label>\n    <input type=\"text\" id=\"modelo\" name=\"modelo\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Número de Série</label>\n    <input type=\"text\" id=\"serie\" name=\"serie\" readonly class=\"field-readonly\" />\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">3 — Motivo e Eventos</div>\n    </div>\n\n    <label>\n      Motivação do Serviço <span class=\"required\">*</span>\n    </label>\n    <textarea id=\"motivacao\" name=\"motivacao\" class=\"field\" required></textarea>\n\n    <div style=\"margin-top:10px\">\n      <label>Eventos Relevantes</label>\n      <textarea id=\"eventos\" name=\"eventos\" class=\"field\"></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">4 — Tipo de Intervenção</div>\n    </div>\n\n    <label>Tipo</label>\n    <select id=\"tipo_intervencao\" name=\"tipo_intervencao\" class=\"field\" required>\n      <option>Manutenção Corretiva</option>\n      <option>Manutenção Preventiva</option>\n      <option>Visita Técnica</option>\n      <option>Outro</option>\n    </select>\n\n    <div style=\"margin-top:10px\">\n      <label>Descrição dos Serviços Realizados</label>\n      <textarea id=\"descricao_servicos\" name=\"descricao_servicos\" class=\"field\" required></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div>\n        <div class=\"section-title\">5 — Peças</div>\n        <div class=\"section-sub\">Registre peças por categoria</div>\n      </div>\n    </div>\n\n    <div style=\"margin-bottom:8px\">\n      <div style=\"font-weight:700;margin-bottom:6px\">Partes removidas — Posse do cliente</div>\n\n      <div id=\"pecas_cliente\" class=\"repeat-list\"></div>\n\n      <div style=\"margin-top:8px\">\n        <button type=\"button\" class=\"btn-ghost\" onclick=\"addPeca('cliente')\">+ Adicionar</button>\n      </div>\n    </div>\n\n    <div style=\"margin-top:12px;margin-bottom:8px\">\n      <div style=\"font-weight:700;margin-bottom:6px\">Partes removidas — Posse da Medical Spin</div>\n\n      <div id=\"pecas_ms\" class=\"repeat-list\"></div>\n\n      <div style=\"margin-top:8px\">\n        <button type=\"button\" class=\"btn-ghost\" onclick=\"addPeca('ms')\">+ Adicionar</button>\n      </div>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">6 — Mão de Obra</div>\n    </div>\n\n    <div id=\"horas_list\" class=\"repeat-list\" required></div>\n\n    <div style=\"margin-top:8px\">\n      <button type=\"button\" class=\"btn-ghost\" onclick=\"addHoras()\">+ Adicionar dia</button>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">7 — Pendências</div>\n    </div>\n\n    <label>Pendências da Medical Spin</label>\n    <textarea id=\"pendencias_ms\" name=\"pendencias_ms\" class=\"field\"></textarea>\n\n    <div style=\"margin-top:10px\">\n      <label>Pendências do Cliente</label>\n      <textarea id=\"pendencias_cliente\" name=\"pendencias_cliente\" class=\"field\"></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">8 — Estado do Equipamento</div>\n    </div>\n\n    <div class=\"grid cols-2\">\n      <div>\n        <label>Estado Inicial</label>\n        <select id=\"estado_inicial\" name=\"estado_inicial\" class=\"field\">\n          <option>Funcional</option>\n          <option>Parcialmente Funcional</option>\n          <option>Inoperante</option>\n        </select>\n      </div>\n\n      <div>\n        <label>Estado Final</label>\n        <select id=\"estado_final\" name=\"estado_final\" class=\"field\" onchange=\"onEstadoFinalChange()\">\n          <option>Funcional</option>\n          <option>Parcialmente Funcional</option>\n          <option>Inoperante</option>\n        </select>\n      </div>\n    </div>\n\n    <div id=\"motivo_restricao\" style=\"display:none;margin-top:10px\">\n      <label>Motivo da Restrição</label>\n      <textarea id=\"motivo_restricao_text\" class=\"field\"></textarea>\n    </div>\n\n    <div id=\"motivo_inoperante\" style=\"display:none;margin-top:10px\">\n      <label>Motivo da Inoperância</label>\n      <textarea id=\"motivo_inoperante_text\" class=\"field\"></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">9 — Local e Assinaturas</div>\n    </div>\n\n    <div class=\"grid cols-2\">\n      <div>\n        <label class=\"label\">Cidade</label>\n        <input type=\"text\" id=\"cidade_assinatura\" name=\"cidade_assinatura\" readonly class=\"field-readonly\" />\n      </div>\n\n      <div>\n        <label class=\"label\">UF</label>\n        <input type=\"text\" id=\"uf_assinatura\" name=\"uf_assinatura\" readonly class=\"field-readonly\" />\n      </div>\n    </div>\n\n    <div style=\"margin-top:10px\" class=\"grid cols-2\">\n      <div>\n        <label>Nome do Engenheiro</label>\n        <input id=\"nome_tecnico\" name=\"nome_tecnico\" class=\"field\" type=\"text\"\n               value=\"JULIO CESAR RODRIGUES\" />\n      </div>\n\n      <div>\n        <label>CFT do Engenheiro</label>\n        <input id=\"cft_tecnico\" name=\"cft_tecnico\" class=\"field compact\" type=\"text\"\n               value=\"2000103820\" />\n      </div>\n    </div>\n\n    <div style=\"margin-top:10px\" class=\"grid cols-2\">\n      <div>\n        <label class=\"label\">Nome do Recebedor</label>\n        <input type=\"text\" id=\"responsavel_assinatura\" name=\"responsavel_assinatura\" readonly class=\"field-readonly\" />\n      </div>\n    </div>\n\n    <section class=\"section\">\n      <div class=\"section-header\">\n        <div class=\"section-title\">Envio de Mídias</div>\n      </div>\n\n      <input type=\"file\" id=\"midias\" name=\"midias\" multiple\n             accept=\"image/*,video/*,.pdf,.doc,.docx,.xlsx,.zip\" />\n    </section>\n\n    <!-- actions -->\n    <div class=\"actions\" style=\"margin-top:6px\">\n      <button type=\"button\" onclick=\"sendToWebhook(event)\">Gerar OS</button>\n      <button type=\"button\" class=\"btn-ghost\" onclick=\"resetForm()\">Limpar</button>\n    </div>\n\n  </div> <!-- /container -->\n\n</form> <!-- /osForm -->\n\n<!-- resultado (fora do form) -->\n<div id=\"result\" style=\"display:none\">\n  <div class=\"card\" style=\"margin-top:14px\">\n    <h3 style=\"margin:0 0 10px 0\">Saída (JSON)</h3>\n    <pre id=\"jsonOut\" style=\"white-space:pre-wrap;max-height:360px;overflow:auto\"></pre>\n  </div>\n</div>\n\n<!-- campos \"auxiliares\" necessários para compatibilidade com seus scripts -->\n<!-- não visíveis para o usuário \n<input type=\"hidden\" id=\"cidade\" />\n<input type=\"hidden\" id=\"uf\" />\n<input type=\"hidden\" id=\"responsavel\" />-->\n\n<script>\n  const input = document.getElementById(\"busca\");\n  const boxSugestoes = document.getElementById(\"sugestoes\");\n\n  const campos = {\n    razao_social: document.getElementById(\"razao_social\"),\n    nome_fantasia: document.getElementById(\"nome_fantasia\"),\n    cnpj: document.getElementById(\"cnpj\"),\n    cidade: document.getElementById(\"cidade\"),\n    uf: document.getElementById(\"uf\"),\n    telefone: document.getElementById(\"telefone\"),\n    email: document.getElementById(\"email\"),\n    responsavel: document.getElementById(\"responsavel\"),\n\n    // seção 9\n    cidade_assinatura: document.getElementById(\"cidade_assinatura\"),\n    uf_assinatura: document.getElementById(\"uf_assinatura\"),\n    responsavel_assinatura: document.getElementById(\"responsavel_assinatura\"),\n\n    tipo_equipamento: document.getElementById(\"tipo_equipamento\"),\n    fabricante: document.getElementById(\"fabricante\"),\n    modelo: document.getElementById(\"modelo\"),\n    serie: document.getElementById(\"serie\")\n  };\n\n  input.addEventListener(\"input\", async (e) => {\n    const termo = e.target.value.trim().toLowerCase();\n\n    if (termo.length < 2) {\n      boxSugestoes.innerHTML = \"\";\n      return;\n    }\n\n    try {\n      const res = await fetch(\n        \"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/autocomplete-busca\",\n        {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ termo })\n        }\n      );\n\n      const data = await res.json();\n      const listaBruta = data.resultados || [];\n\nconst lista = listaBruta\n  .map(cliente => {\n    const termoMatchCliente =\n      `${cliente.razao_social} ${cliente.nome_fantasia} ${cliente.cnpj}`\n        .toLowerCase()\n        .includes(termo);\n\n    const equipamentosFiltrados = (cliente.equipamentos || []).filter(eq =>\n      `${eq.tipo_equipamento} ${eq.fabricante} ${eq.modelo} ${eq.serie}`\n        .toLowerCase()\n        .includes(termo)\n    );\n\n    // só retorna cliente se ele ou algum equipamento casar\n    if (!termoMatchCliente && equipamentosFiltrados.length === 0) {\n      return null;\n    }\n\n    return {\n      ...cliente,\n      equipamentos: equipamentosFiltrados.length\n        ? equipamentosFiltrados\n        : cliente.equipamentos\n    };\n  })\n  .filter(Boolean);\n\n\n      if (!lista.length) {\n  boxSugestoes.innerHTML = `\n    <div class=\"item-sugestao\" style=\"cursor:default\">\n      <strong>Nenhum cliente encontrado</strong><br>\n      <small>\n        Não encontrou o cliente?\n        <a href=\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente\"\n           target=\"_blank\" rel=\"noopener noreferrer\"\n           style=\"color:#0b74ff;font-weight:700\">\n          Clique aqui para cadastrar\n        </a>\n      </small>\n    </div>\n  `;\n  return;\n}\n\n      let html = `<div class=\"categoria\">Clientes encontrados</div>`;\n\n      lista.forEach(cliente => {\n        html += `\n          <div class=\"item-cliente\">\n            <strong>${cliente.razao_social}</strong><br>\n            <small>${cliente.cnpj} — ${cliente.cidade}/${cliente.uf}</small>\n        `;\n\n        (cliente.equipamentos || []).forEach(eq => {\n          html += `\n            <div class=\"item-equipamento\"\n              data-cliente='${JSON.stringify(cliente)}'\n              data-equipamento='${JSON.stringify(eq)}'>\n              🔧 ${eq.tipo_equipamento} — ${eq.fabricante} ${eq.modelo} (${eq.serie})\n            </div>\n          `;\n        });\n\n        html += `</div>`;\n      });\n\n      boxSugestoes.innerHTML = html;\n\n      document.querySelectorAll(\".item-equipamento\").forEach(el => {\n        el.onclick = () => {\n          const cliente = JSON.parse(el.dataset.cliente);\n          const eq = JSON.parse(el.dataset.equipamento);\n\n          input.value = cliente.razao_social || \"\";\n\n          campos.razao_social.value = cliente.razao_social || \"\";\n          campos.nome_fantasia.value = cliente.nome_fantasia || \"\";\n          campos.cnpj.value = cliente.cnpj || \"\";\n          campos.cidade.value = cliente.cidade || \"\";\n          campos.uf.value = cliente.uf || \"\";\n          campos.telefone.value = cliente.telefone || \"\";\n          campos.email.value = cliente.email || \"\";\n          campos.responsavel.value = cliente.responsavel || \"\";\n\n          // seção 9\n          campos.cidade_assinatura.value = cliente.cidade || \"\";\n          campos.uf_assinatura.value = cliente.uf || \"\";\n          campos.responsavel_assinatura.value = cliente.responsavel || \"\";\n\n          campos.tipo_equipamento.value = eq.tipo_equipamento || \"\";\n          campos.fabricante.value = eq.fabricante || \"\";\n          campos.modelo.value = eq.modelo || \"\";\n          campos.serie.value = eq.serie || \"\";\n\n          // compatibilidade com outros scripts\n          ///const cidadeEmp = document.getElementById(\"cidade_empresa\");\n          //const ufEmp = document.getElementById(\"uf_empresa\");\n          //const recebedor = document.getElementById(\"recebedor\");\n\n          //if (cidadeEmp) cidadeEmp.value = cliente.cidade || \"\";\n         // if (ufEmp) ufEmp.value = cliente.uf || \"\";\n          //if (recebedor) recebedor.value = cliente.responsavel || \"\";\n\n          boxSugestoes.innerHTML = \"\";\n        };\n      });\n\n    } catch (err) {\n      console.error(\"Erro no autocomplete:\", err);\n    }\n  });\n</script>\n\n<script>\n  /* same JS logic from your original file, unchanged. Keep the dynamic pieces below */\n\n  function addPeca(tipo) {\n    const mapa = {\n      cliente: \"pecas_cliente\",\n      ms: \"pecas_ms\",\n      reparadas: \"pecas_reparadas\",\n      inseridas: \"pecas_inseridas\"\n    };\n\n    const container = document.getElementById(mapa[tipo]);\n    const item = document.createElement(\"div\");\n    item.className = \"repeat-item\";\n\n    item.innerHTML = `\n      <label>Nome da peça</label>\n      <input class=\"peca_nome\" type=\"text\">\n\n      <label>Modelo / Ref</label>\n      <input class=\"peca_modelo\" type=\"text\">\n\n      <label>Nº de Série</label>\n      <input class=\"peca_sn\" type=\"text\">\n\n      <label>Observações</label>\n      <input class=\"peca_destino\" type=\"text\">\n\n      <div style=\"display:flex;gap:8px;justify-content:flex-end\">\n        <button type=\"button\" class=\"btn-ghost\"\n          style=\"background:transparent;color:#ef4444;border:1px solid rgba(239,68,68,0.06);\">\n          Remover\n        </button>\n      </div>\n    `;\n\n    item.querySelector(\"button\").onclick = () => container.removeChild(item);\n    container.appendChild(item);\n  }\n\n  function addHoras() {\n    const c = document.getElementById(\"horas_list\");\n    const item = document.createElement(\"div\");\n    item.className = \"repeat-item\";\n\n    item.innerHTML = `\n      <div class=\"grid cols-3\">\n        <div>\n          <label>Data</label>\n          <input class=\"hh_data\" type=\"date\">\n        </div>\n\n        <div>\n          <label>HH efetivo</label>\n          <input class=\"hh_efetivo\" type=\"text\">\n        </div>\n\n        <div>\n          <label>HH contingencial</label>\n          <input class=\"hh_contingencial\" type=\"text\">\n        </div>\n      </div>\n\n      <div style=\"display:flex;justify-content:flex-end;margin-top:6px\">\n        <button type=\"button\" class=\"btn-ghost\"\n          style=\"background:transparent;color:#ef4444;border:1px solid rgba(239,68,68,0.06);\">\n          Remover\n        </button>\n      </div>\n    `;\n\n    item.querySelector(\"button\").onclick = () => c.removeChild(item);\n    c.appendChild(item);\n  }\n\n  function onEstadoFinalChange() {\n    const v = document.getElementById(\"estado_final\").value;\n\n    document.getElementById(\"motivo_restricao\").style.display =\n      v === \"Parcialmente Funcional\" ? \"block\" : \"none\";\n\n    document.getElementById(\"motivo_inoperante\").style.display =\n      v === \"Inoperante\" ? \"block\" : \"none\";\n  }\n\n  function gatherForm() {\n    const data = {};\n    const f = new FormData(document.getElementById(\"osForm\"));\n\n    for (const [k, v] of f.entries()) {\n      if (k !== \"midias\") data[k] = v;\n    }\n\n    data[\"pecas_cliente\"] = coletaPecas(\"pecas_cliente\");\n    data[\"pecas_ms\"] = coletaPecas(\"pecas_ms\");\n    data[\"mao_de_obra\"] = coletaHoras();\n\n    data[\"motivo_restricao\"] =\n      document.getElementById(\"motivo_restricao_text\").value || \"\";\n    data[\"motivo_inoperante\"] =\n      document.getElementById(\"motivo_inoperante_text\").value || \"\";\n\n    return data;\n  }\n\n  function coletaPecas(id) {\n    const out = [];\n\n    document.querySelectorAll(`#${id} .repeat-item`).forEach(it => {\n      out.push({\n        nome: it.querySelector(\".peca_nome\").value,\n        modelo: it.querySelector(\".peca_modelo\").value,\n        sn: it.querySelector(\".peca_sn\").value,\n        detalhes: it.querySelector(\".peca_destino\").value\n      });\n    });\n\n    return out;\n  }\n\n  function coletaHoras() {\n    const out = [];\n\n    document.querySelectorAll(\"#horas_list .repeat-item\").forEach(it => {\n      out.push({\n        data: it.querySelector(\".hh_data\").value,\n        hh_efetivo: it.querySelector(\".hh_efetivo\").value,\n        hh_contingencial: it.querySelector(\".hh_contingencial\").value\n      });\n    });\n\n    return out;\n  }\n\n  function filesToBase64(fileList) {\n    const promises = [];\n\n    for (let i = 0; i < fileList.length; i++) {\n      const file = fileList[i];\n\n      promises.push(\n        new Promise((resolve, reject) => {\n          const reader = new FileReader();\n\n          reader.onerror = () => reject(\"Erro ao ler arquivo\");\n\n          reader.onload = () => {\n            const base64 = reader.result.split(\",\")[1];\n\n            resolve({\n              nome: file.name,\n              tipo: file.type,\n              tamanho: file.size,\n              base64\n            });\n          };\n\n          reader.readAsDataURL(file);\n        })\n      );\n    }\n\n    return Promise.all(promises);\n  }\n\n  function generateJSON(formElement) {\n  const formData = new FormData(formElement);\n\n  // coleta campos normais\n  const payload = {};\n  for (const [key, value] of formData.entries()) {\n    payload[key] = value || \"N/A\";\n  }\n\n  // coleta peças\n  payload.pecas_cliente = coletaPecas(\"pecas_cliente\");\n  payload.pecas_ms = coletaPecas(\"pecas_ms\");\n\n  // coleta horas\n  payload.mao_de_obra = coletaHoras();\n\n  return payload;\n}\n\n\n  function resetForm() {\n    document.getElementById(\"osForm\").reset();\n\n    // remove dynamic repeat items\n    [\"pecas_cliente\", \"pecas_ms\", \"pecas_reparadas\", \"pecas_inseridas\", \"horas_list\"]\n      .forEach(id => {\n        const c = document.getElementById(id);\n        if (c) c.innerHTML = \"\";\n      });\n\n    document.getElementById(\"result\").style.display = \"none\";\n  }\n\n  async function sendToWebhook(event) {\n  event.preventDefault();\n\n  const form = document.getElementById(\"osForm\");\n\n  // coleta campos normais\n  const jsonPayload = generateJSON(form);\n\n  // coleta arquivos\n  const inputMidias = document.getElementById(\"midias\");\n  const arquivos = inputMidias.files;\n\n  let midiasBase64 = [];\n\n  if (arquivos && arquivos.length > 0) {\n    midiasBase64 = await filesToBase64(arquivos);\n  }\n\n  // adiciona ao JSON final\n  jsonPayload.midias = midiasBase64;\n\n  // envia tudo em um único JSON\n  await fetch(\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/recebe-dados-os\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(jsonPayload)\n  });\n\n  alert(\"Dados enviados com sucesso!\");\n}\n\n</script>\n\n<script>\n  // Adaptado para usar #razao ou, se não existir, #busca (compatibilidade).\n  const inputRazao = document.getElementById(\"razao\") || document.getElementById(\"busca\");\n  let timeout = null;\n\n  if (inputRazao) {\n    inputRazao.addEventListener(\"input\", function () {\n      const q = this.value.trim();\n      if (q.length < 2) return;\n\n      clearTimeout(timeout);\n\n      timeout = setTimeout(() => {\n        fetch(\n          `https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/auto-complete?q=${encodeURIComponent(\n            q\n          )}`\n        )\n          .then(r => r.json())\n          .then(data => showSuggestions(data.suggestions))\n          .catch(err => console.error(err));\n      }, 250);\n    });\n  }\n\n  function showSuggestions(list) {\n    removeSuggestionBox();\n\n    const box = document.createElement(\"div\");\n    box.id = \"suggestionBox\";\n    box.style.position = \"absolute\";\n    box.style.background = \"#fff\";\n    box.style.border = \"1px solid #ccc\";\n    box.style.width = (inputRazao && inputRazao.offsetWidth) ? inputRazao.offsetWidth + \"px\" : \"300px\";\n    box.style.zIndex = 1000;\n\n    list.forEach(item => {\n      const opt = document.createElement(\"div\");\n      opt.textContent = `${item.razao} (${item.cnpj || \"\"})`;\n      opt.style.padding = \"8px\";\n      opt.style.cursor = \"pointer\";\n\n      opt.onclick = () => {\n        // Preenchimento rápido baseado no payload dessa autocomplete (padrão)\n        //if (inputRazao) inputRazao.value = item.razao || \"\";\n        //const elCnpj = document.getElementById(\"cnpj\");\n        //if (elCnpj) elCnpj.value = item.cnpj || \"\";\n        //const elCidade = document.getElementById(\"cidade\");\n        //if (elCidade) elCidade.value = item.cidade || \"\";\n        //const elUf = document.getElementById(\"uf_empresa\");\n        //if (elUf) elUf.value = item.uf || \"\";\n        //const elSolic = document.getElementById(\"recebedor\");\n        //if (elSolic) elSolic.value = item.responsavel || \"\";\n\n        removeSuggestionBox();\n      };\n\n      box.appendChild(opt);\n    });\n\n    // append near the input if possible, otherwise to body\n    if (inputRazao && inputRazao.parentNode) {\n      inputRazao.parentNode.appendChild(box);\n    } else {\n      document.body.appendChild(box);\n    }\n  }\n\n  function removeSuggestionBox() {\n    const old = document.getElementById(\"suggestionBox\");\n    if (old) old.remove();\n  }\n\n  document.addEventListener(\"click\", e => {\n    if (e.target.id !== \"suggestionBox\") removeSuggestionBox();\n  });\n</script>\n\n\n</body>\n</html>"
      },
      "id": "2b0ebecb-0544-4c22-9f7e-207103cd3825",
      "name": "HTML6",
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        1744,
        -1472
      ]
    },
    {
      "parameters": {
        "jsCode": "// ===== Função de parse =====\nfunction parseSheet(rawData, origem) {\n  const jsonString = rawData\n    .replace('/*O_o*/\\ngoogle.visualization.Query.setResponse(', '')\n    .replace(/\\);$/, '');\n\n  const parsed = JSON.parse(jsonString);\n  const rows = parsed.table.rows || [];\n\n  return rows.map(r => {\n    const c = r.c;\n\n    if (origem === 'A') {\n      return {\n        id_cliente: c[0]?.v || \"\",\n        razao_social: c[1]?.v || \"\",\n        nome_fantasia: c[2]?.v || \"\",\n        cnpj: c[3]?.v || \"\",\n        cidade: c[4]?.v || \"\",\n        uf: c[5]?.v || \"\",\n        telefone: c[6]?.v || \"\",\n        email: c[7]?.v || \"\",\n        responsavel: c[8]?.v || \"\",\n        os_nome: c[9]?.v || \"\",\n        os_link: c[10]?.v || \"\"\n      };\n    }\n\n    return {\n      id_cliente: c[0]?.v || \"\",\n      tipo_equipamento: c[1]?.v || \"\",\n      fabricante: c[2]?.v || \"\",\n      modelo: c[3]?.v || \"\",\n      serie: c[4]?.v || \"\",\n      tipo_intervencao: c[5]?.v || \"\",\n      estado_inicial: c[6]?.v || \"\",\n      estado_final: c[7]?.v || \"\"\n    };\n  });\n}\n\n// ===== Dados =====\nconst dataA = $('HTTP Request3').first().json.data;\nconst dataB = $input.first().json.data;\n\n// ===== Parse =====\nconst clientes = parseSheet(dataA, 'A');\nconst equipamentos = parseSheet(dataB, 'B');\n\n// ===== Agrupa equipamentos por id_cliente =====\nconst equipamentosPorCliente = {};\n\nfor (const eq of equipamentos) {\n  if (!eq.id_cliente) continue;\n\n  if (!equipamentosPorCliente[eq.id_cliente]) {\n    equipamentosPorCliente[eq.id_cliente] = [];\n  }\n\n  equipamentosPorCliente[eq.id_cliente].push({\n    tipo_equipamento: eq.tipo_equipamento,\n    fabricante: eq.fabricante,\n    modelo: eq.modelo,\n    serie: eq.serie,\n    tipo_intervencao: eq.tipo_intervencao,\n    estado_inicial: eq.estado_inicial,\n    estado_final: eq.estado_final\n  });\n}\n\n// ===== Merge final =====\nconst resultados = clientes.map(cliente => ({\n  id_cliente: cliente.id_cliente,\n\n  razao_social: cliente.razao_social,\n  nome_fantasia: cliente.nome_fantasia,\n  cnpj: cliente.cnpj,\n  cidade: cliente.cidade,\n  uf: cliente.uf,\n  telefone: cliente.telefone,\n  email: cliente.email,\n  responsavel: cliente.responsavel,\n\n  os_nome: cliente.os_nome,\n  os_link: cliente.os_link,\n\n  equipamentos: equipamentosPorCliente[cliente.id_cliente] || []\n}));\n\n// ===== Retorno =====\nreturn [\n  {\n    json: {\n      resultados\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2576,
        -1472
      ],
      "id": "2372f0de-82ce-4cc1-a1e4-7dd661b20a0d",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "jsCode": "const equipamentos = $('Code in JavaScript').first().json.equipamentos || [];\nreturn equipamentos.map(equipamento => ({\n  json: {\n    tipo: equipamento.tipo,\n    fabricante: equipamento.fabricante,\n    modelo: equipamento.modelo,\n    serie: equipamento.serie\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        -896
      ],
      "id": "4f053f70-da26-4d31-b8f7-97e45a4aeb7e",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "autocomplete-edit-cliente",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*",
          "responseHeaders": {
            "entries": [
              {
                "name": "=Access-Control-Allow-Methods",
                "value": "*"
              },
              {
                "name": "=Access-Control-Allow-Methods",
                "value": "=GET, POST, OPTIONS"
              }
            ]
          }
        }
      },
      "id": "75212cd4-5467-4cad-8c12-972cc84d5b31",
      "name": "Busca no Sheets1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        3440,
        -576
      ],
      "webhookId": "autocomplete-busca-001"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "23ccf63b-da60-4c9d-a843-aa89016f80b7",
      "name": "Retorna sugestões1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        4128,
        -576
      ]
    },
    {
      "parameters": {
        "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1955323770&tqx=out:json&tq=SELECT%20*",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3600,
        -576
      ],
      "id": "424356a6-5f26-40bc-9f99-9e4aa1883c02",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1612720329&tqx=out:json&tq=SELECT%20*",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3776,
        -576
      ],
      "id": "9267691a-0cb9-4613-8c04-cfcd74f83484",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "jsCode": "// ===== Função de parse =====\nfunction parseSheet(rawData, origem) {\n  const jsonString = rawData\n    .replace('/*O_o*/\\ngoogle.visualization.Query.setResponse(', '')\n    .replace(/\\);$/, '');\n\n  const parsed = JSON.parse(jsonString);\n  const rows = parsed.table.rows || [];\n\n  return rows.map(r => {\n    const c = r.c;\n\n    if (origem === 'A') {\n      return {\n        id_cliente: c[0]?.v || \"\",\n        razao_social: c[1]?.v || \"\",\n        nome_fantasia: c[2]?.v || \"\",\n        cnpj: c[3]?.v || \"\",\n        cidade: c[4]?.v || \"\",\n        uf: c[5]?.v || \"\",\n        telefone: c[6]?.v || \"\",\n        email: c[7]?.v || \"\",\n        responsavel: c[8]?.v || \"\",\n        os_nome: c[9]?.v || \"\",\n        os_link: c[10]?.v || \"\"\n      };\n    }\n\n    return {\n      id_cliente: c[0]?.v || \"\",\n      tipo_equipamento: c[1]?.v || \"\",\n      fabricante: c[2]?.v || \"\",\n      modelo: c[3]?.v || \"\",\n      serie: c[4]?.v || \"\",\n      tipo_intervencao: c[5]?.v || \"\",\n      estado_inicial: c[6]?.v || \"\",\n      estado_final: c[7]?.v || \"\"\n    };\n  });\n}\n\n// ===== Dados =====\nconst dataA = $('HTTP Request4').first().json.data;\nconst dataB = $input.first().json.data;\n\n// ===== Parse =====\nconst clientes = parseSheet(dataA, 'A');\nconst equipamentos = parseSheet(dataB, 'B');\n\n// ===== Agrupa equipamentos por id_cliente =====\nconst equipamentosPorCliente = {};\n\nfor (const eq of equipamentos) {\n  if (!eq.id_cliente) continue;\n\n  if (!equipamentosPorCliente[eq.id_cliente]) {\n    equipamentosPorCliente[eq.id_cliente] = [];\n  }\n\n  equipamentosPorCliente[eq.id_cliente].push({\n    tipo_equipamento: eq.tipo_equipamento,\n    fabricante: eq.fabricante,\n    modelo: eq.modelo,\n    serie: eq.serie,\n    tipo_intervencao: eq.tipo_intervencao,\n    estado_inicial: eq.estado_inicial,\n    estado_final: eq.estado_final\n  });\n}\n\n// ===== Merge final =====\nconst resultados = clientes.map(cliente => ({\n  id_cliente: cliente.id_cliente,\n\n  razao_social: cliente.razao_social,\n  nome_fantasia: cliente.nome_fantasia,\n  cnpj: cliente.cnpj,\n  cidade: cliente.cidade,\n  uf: cliente.uf,\n  telefone: cliente.telefone,\n  email: cliente.email,\n  responsavel: cliente.responsavel,\n\n  os_nome: cliente.os_nome,\n  os_link: cliente.os_link,\n\n  equipamentos: equipamentosPorCliente[cliente.id_cliente] || []\n}));\n\n// ===== Retorno =====\nreturn [\n  {\n    json: {\n      resultados\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3952,
        -576
      ],
      "id": "662cfe8f-4aae-4708-ae83-d1a1b7f6928d",
      "name": "Code in JavaScript5"
    }
  ],
  "connections": {
    "Webhook2": {
      "main": [
        [
          {
            "node": "dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Opcao1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcao2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcao3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcao4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcao5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcao6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcao7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcao8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "InputOS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload file": {
      "main": [
        [
          {
            "node": "Id e link1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Upload file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Soma horas": {
      "main": [
        [
          {
            "node": "Pega o documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Junta itens": {
      "main": [
        [
          {
            "node": "Soma horas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Junta itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega o documento1": {
      "main": [
        [
          {
            "node": "Placeholder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nome da imagem": {
      "main": [
        [
          {
            "node": "Procura imagens",
            "type": "main",
            "index": 0
          },
          {
            "node": "Imagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Index": {
      "main": [
        [
          {
            "node": "Atualiza documento1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Unir tudo",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Cola imagem no documento": {
      "main": [
        [
          {
            "node": "Percorre os itens",
            "type": "main",
            "index": 0
          },
          {
            "node": "Deleta Imagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Id e Name?": {
      "main": [
        [
          {
            "node": "Cola imagem no documento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Percorre os itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Percorre os itens": {
      "main": [
        [
          {
            "node": "Remove duplicatas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Id e Name?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Separa itens": {
      "main": [
        [
          {
            "node": "Percorre os itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Unir tudo",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "Atualiza documento1": {
      "main": [
        [
          {
            "node": "Unir tudo",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Unir tudo": {
      "main": [
        [
          {
            "node": "Separa itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza documento": {
      "main": [
        [
          {
            "node": "Pega o documento1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Placeholder": {
      "main": [
        [
          {
            "node": "Unir tudo",
            "type": "main",
            "index": 0
          },
          {
            "node": "Index",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega o documento": {
      "main": [
        [
          {
            "node": "Atualiza documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Junta repeticoes": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procura imagens": {
      "main": [
        [
          {
            "node": "Junta repeticoes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Torna publico": {
      "main": [
        [
          {
            "node": "Unir tudo",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "midia": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Copia  o arquivo": {
      "main": [
        [
          {
            "node": "midia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cria pasta": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Copia  o arquivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Imagens": {
      "main": [
        [
          {
            "node": "Unir tudo",
            "type": "main",
            "index": 3
          },
          {
            "node": "Torna publico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Adiciona imagem": {
      "main": [
        [
          {
            "node": "Nome da imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados": {
      "main": [
        [
          {
            "node": "Cria pasta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Adiciona imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove duplicatas": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "dados1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega o documento2": {
      "main": [
        [
          {
            "node": "Atualiza documento2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados1": {
      "main": [
        [
          {
            "node": "Soma horas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Soma horas1": {
      "main": [
        [
          {
            "node": "Pega o documento2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza documento2": {
      "main": [
        [
          {
            "node": "Download file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file1": {
      "main": [
        [
          {
            "node": "Upload file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload file1": {
      "main": [
        [
          {
            "node": "Id e link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis": {
      "main": [
        [
          {
            "node": "RemoteId",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis6": {
      "main": [
        [
          {
            "node": "Delete RemoteId1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RemoteId1": {
      "main": [
        [
          {
            "node": "Envia OS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RemoteId2": {
      "main": [
        [
          {
            "node": "Envia OS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Opcao1": {
      "main": [
        []
      ]
    },
    "Envia OS": {
      "main": [
        [
          {
            "node": "DB10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia OS1": {
      "main": [
        [
          {
            "node": "DB7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deleta Imagens": {
      "main": [
        []
      ]
    },
    "Id e link": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Id e link1": {
      "main": [
        [
          {
            "node": "dados2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OS consult": {
      "main": [
        [
          {
            "node": "Busca Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "InputOS": {
      "main": [
        [
          {
            "node": "OS consult",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OS sem retorno": {
      "main": [
        []
      ]
    },
    "OS retorno": {
      "main": [
        []
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "OS sem retorno",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca Item": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook4": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DB2": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RemoteId3": {
      "main": [
        [
          {
            "node": "Confirma Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "@s.whatsapp.net",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "@s.whatsapp.net": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Carrega HTML": {
      "main": [
        [
          {
            "node": "HTML6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca no Sheets": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirma Cliente": {
      "main": [
        []
      ]
    },
    "Opcao6": {
      "main": [
        [
          {
            "node": "Redis6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook5": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "RemoteId3",
            "type": "main",
            "index": 0
          },
          {
            "node": "DB2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis7": {
      "main": [
        [
          {
            "node": "Delete RemoteId3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Opcao8": {
      "main": [
        [
          {
            "node": "Redis7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "OS retorno",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "RemoteId1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message1": {
      "main": [
        [
          {
            "node": "RemoteId2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados2": {
      "main": [
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        []
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DB7": {
      "main": [
        []
      ]
    },
    "DB10": {
      "main": [
        []
      ]
    },
    "HTML6": {
      "main": [
        [
          {
            "node": "Retorna HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Retorna sugestões",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca no Sheets1": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "Retorna sugestões1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Busca no Sheets": [
      {
        "json": {
          "headers": {
            "host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "user-agent": "Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Mobile Safari/537.36",
            "content-length": "17",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7",
            "content-type": "application/json",
            "origin": "null",
            "priority": "u=1, i",
            "sec-ch-ua": "\"Google Chrome\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\"",
            "sec-ch-ua-mobile": "?1",
            "sec-ch-ua-platform": "\"Android\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "x-forwarded-for": "45.233.97.72",
            "x-forwarded-host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "21ebda4186cf",
            "x-real-ip": "45.233.97.72"
          },
          "params": {},
          "query": {},
          "body": {
            "termo": "teste"
          },
          "webhookUrl": "https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/autocomplete-busca",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Webhook4": [
      {
        "json": {
          "headers": {
            "host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "user-agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Mobile Safari/537.36",
            "content-length": "520",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7",
            "content-type": "application/json",
            "origin": "null",
            "priority": "u=1, i",
            "sec-ch-ua": "\"Google Chrome\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\"",
            "sec-ch-ua-mobile": "?1",
            "sec-ch-ua-platform": "\"Android\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "x-forwarded-for": "45.233.97.72",
            "x-forwarded-host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "21ebda4186cf",
            "x-real-ip": "45.233.97.72"
          },
          "params": {},
          "query": {},
          "body": {
            "razao_social": "Teste",
            "fantasia": "WENDEL LUCAS NASCIMENTO",
            "cnpj": "59.085.732/0001-74",
            "cidade": "Nossa Senhora do Socorro",
            "uf": "SE",
            "telefone": "79999801810",
            "email": "lwendel003@gmail.com",
            "responsavel": "Teste",
            "equipamentos": [
              {
                "tipo": "Ressonância Magnética",
                "fabricante": "Philips",
                "modelo": "Hshsdhdh",
                "serie": "26363636"
              },
              {
                "tipo": "Ultrassom",
                "fabricante": "GE HealthCare",
                "modelo": "Bshdhdh",
                "serie": "636363"
              },
              {
                "tipo": "Bobinas de Exames",
                "fabricante": "Siemens Healthineers AG",
                "modelo": "Gsgsgdhs",
                "serie": "42525252"
              }
            ]
          },
          "webhookUrl": "https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "user-agent": "axios/1.12.2",
            "content-length": "772",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "10.0.1.1",
            "x-forwarded-host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "21ebda4186cf",
            "x-real-ip": "10.0.1.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "teste",
            "data": {
              "key": {
                "remoteJid": "7228732002361@lid",
                "remoteJidAlt": "557999801810@s.whatsapp.net",
                "fromMe": true,
                "id": "ACFA90AAE7DDBC6A105DB345BEF7C783",
                "participant": "",
                "addressingMode": "lid"
              },
              "pushName": "Wendel Lucas",
              "status": "SERVER_ACK",
              "message": {
                "conversation": "OS_teste"
              },
              "messageType": "conversation",
              "messageTimestamp": 1765891336,
              "instanceId": "a67cc44b-8277-4434-924c-42708131588f",
              "source": "android"
            },
            "destination": "https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/7a6699a8-890e-4b2b-8a03-167175154a31",
            "date_time": "2025-12-16T10:22:17.117Z",
            "sender": "557999801810@s.whatsapp.net",
            "server_url": "http://evo-j0o08ok8sgwc4cog04w0owok.95.217.164.173.sslip.io",
            "apikey": "70B682D69733-4725-9C71-961DCF9A99C0"
          },
          "webhookUrl": "https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/7a6699a8-890e-4b2b-8a03-167175154a31",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Webhook2": [
      {
        "json": {
          "headers": {
            "host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "user-agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Mobile Safari/537.36",
            "content-length": "765",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7",
            "content-type": "application/json",
            "origin": "null",
            "priority": "u=1, i",
            "sec-ch-ua": "\"Google Chrome\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\"",
            "sec-ch-ua-mobile": "?1",
            "sec-ch-ua-platform": "\"Android\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "x-forwarded-for": "45.233.97.72",
            "x-forwarded-host": "n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "21ebda4186cf",
            "x-real-ip": "45.233.97.72"
          },
          "params": {},
          "query": {},
          "body": {
            "razao_social": "Top Image Diagnosticos Medicos LTDA",
            "nome_fantasia": "Top Image",
            "cnpj": "03.261.384/0001-94",
            "cidade": "São josé",
            "uf": "SC",
            "telefone": "48991745588",
            "email": "contato@nedicalspin.com.br",
            "responsavel": "Fúlvio",
            "tipo_equipamento": "Ressonância Magnética",
            "fabricante": "Philips",
            "modelo": "Achieva 1.5T",
            "serie": "MR25467",
            "motivacao": "N/A",
            "eventos": "N/A",
            "tipo_intervencao": "Manutenção Corretiva",
            "descricao_servicos": "N/A",
            "pendencias_ms": "N/A",
            "pendencias_cliente": "N/A",
            "estado_inicial": "Funcional",
            "estado_final": "Funcional",
            "cidade_assinatura": "São josé",
            "uf_assinatura": "SC",
            "nome_tecnico": "JULIO CESAR RODRIGUES",
            "cft_tecnico": "2000103820",
            "responsavel_assinatura": "Fúlvio",
            "midias": [],
            "pecas_cliente": [],
            "pecas_ms": [],
            "mao_de_obra": []
          },
          "webhookUrl": "https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/recebe-dados-os",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "versionId": "faa9f70f-54a2-4132-9b12-4be7f6b366ec",
  "activeVersionId": "faa9f70f-54a2-4132-9b12-4be7f6b366ec",
  "triggerCount": 7,
  "shared": [
    {
      "updatedAt": "2025-12-08T14:30:14.797Z",
      "createdAt": "2025-12-08T14:30:14.797Z",
      "role": "workflow:owner",
      "workflowId": "Tw9iJBKtSFvACs8y",
      "projectId": "XZrA9Oiu8K5e6BgC"
    }
  ],
  "activeVersion": {
    "updatedAt": "2025-12-18T20:28:14.708Z",
    "createdAt": "2025-12-18T20:28:14.708Z",
    "versionId": "faa9f70f-54a2-4132-9b12-4be7f6b366ec",
    "workflowId": "Tw9iJBKtSFvACs8y",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "recebe-dados-os",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          1568,
          -1328
        ],
        "id": "19bb8d02-8654-4c1b-8215-f45ab80b503e",
        "name": "Webhook2",
        "webhookId": "28c50b66-8cde-4f8f-87de-babdee0c9f39"
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "=id:{{ $json.data.key.remoteJid }}"
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          1568,
          -608
        ],
        "id": "6605de90-0d7b-496f-820d-df2a20124d74",
        "name": "Redis6",
        "credentials": {
          "redis": {
            "id": "zxoKZ2hHG1VotLrg",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "b0bc1622-ccd0-489e-a51e-5eaa1c4bd334",
                "leftValue": "={{ $json.id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          864,
          -736
        ],
        "id": "34e88b10-75b1-48bf-9e76-c7ef4db9bfd2",
        "name": "If1"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "1",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "69886729-8e82-426c-802f-46705c3e2b3a"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "1"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "51b92b73-164e-4755-8038-d654ca87a9ea",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "2",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "2"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "18831c78-d752-417a-bd9f-c14e5d50c084",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "3",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "3"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "ea852e4c-22b1-44e0-807c-e07f299d8022",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "4",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "4"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "f49d14b1-0ca5-4ae9-a212-1aa50e2bada5",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "5",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "5"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "300116c1-76e1-4e14-beee-809f9b1fd295",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "6",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "6"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "3f00aac6-1438-466b-aa8e-bf4ea82e5ae9",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "7",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "7"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "d22d8a63-66cd-4e5e-b857-f50d04a4e0c1",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "8",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "8"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "3624ac4f-e7e0-4a0e-a559-cc9b11fd5f74",
                      "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                      "rightValue": "OS_",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "OS_"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          1088,
          -752
        ],
        "id": "25b93314-9223-4e15-8cf3-bfb40c7153b0",
        "name": "Switch"
      },
      {
        "parameters": {
          "operation": "get",
          "propertyName": "id",
          "key": "=id:{{ $('@s.whatsapp.net').item.json.remoteJid }}",
          "options": {}
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          656,
          -736
        ],
        "id": "8b1d732d-54ec-4cfa-9653-7e1d0417cbe5",
        "name": "Redis1",
        "credentials": {
          "redis": {
            "id": "zxoKZ2hHG1VotLrg",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "operation": "set",
          "key": "=id:{{ $json.data.key.remoteJid }}",
          "value": "menu_principal",
          "expire": true,
          "ttl": 600
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          864,
          -896
        ],
        "id": "c1431a86-6cb9-4a0f-bb2c-7ba94874c5f4",
        "name": "Redis",
        "credentials": {
          "redis": {
            "id": "zxoKZ2hHG1VotLrg",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "34998565-4754-4036-9919-919fba42692c",
                "leftValue": "={{ $('Edit Fields3').item.json.conversation }}",
                "rightValue": "Magnetto",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          368,
          -880
        ],
        "id": "8faba0b1-6177-4745-9eec-3671116a851c",
        "name": "If"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "7a6699a8-890e-4b2b-8a03-167175154a31",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -256,
          -880
        ],
        "id": "302220a3-613e-4ea6-9616-6049afaa7ac7",
        "name": "Webhook",
        "webhookId": "5b947b1f-b0f0-41cc-903c-9abdd1dc685c"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "91e7da4f-3369-4523-aa7e-5af7625e0fe6",
                "name": "driveId",
                "value": "={{ $json.driveId }}",
                "type": "string"
              },
              {
                "id": "dce65960-5811-465f-b3b3-76d038f27f2e",
                "name": "fileid",
                "value": "={{ $json.id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2288,
          -1136
        ],
        "id": "5cbd62f5-04b9-45af-89f3-4d4ad2877318",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "name": "={{ $('Remove duplicatas').item.json.folderName }}",
          "driveId": {
            "__rl": true,
            "value": "={{ $('Remove duplicatas').item.json.driveId }}",
            "mode": "id"
          },
          "folderId": {
            "__rl": true,
            "value": "={{ $('Remove duplicatas').item.json.fileId }}",
            "mode": "id"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          6336,
          -1344
        ],
        "id": "132a1836-07be-447c-831e-beb33e9e5a81",
        "name": "Upload file",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "operation": "download",
          "fileId": {
            "__rl": true,
            "value": "={{ $json.documentId }}",
            "mode": "id"
          },
          "options": {
            "googleFileConversion": {
              "conversion": {
                "docsToFormat": "application/pdf"
              }
            }
          }
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          6128,
          -1344
        ],
        "id": "9629aa2d-adef-4d87-b2ee-e3809e85526b",
        "name": "Download file",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Entrada\nconst data = items[0].json;\n\n// Função utilitária para aplicar \"N/A\"\nconst na = v => {\n  if (v === undefined || v === null) return \"N/A\";\n  if (typeof v === \"string\" && v.trim() === \"\") return \"N/A\";\n  if (Array.isArray(v)) {\n    // array vazio ou só com objetos vazios → \"N/A\"\n    if (v.length === 0) return \"N/A\";\n    if (v.every(item => typeof item === \"object\" && Object.keys(item).length === 0)) return \"N/A\";\n  }\n  if (typeof v === \"object\" && Object.keys(v).length === 0) return \"N/A\";\n  return v;\n};\n\n// Arrays de peças\nconst pecas_cliente = na(data.pecas_cliente);\nconst pecas_ms = na(data.pecas_ms);\n\n// Mão de Obra\nconst mao = data.mao_de_obra?.[0] || {};\n\nlet datas = [];\nlet totalEfetivo = 0;\nlet totalContingencial = 0;\n\n// Suporta até 50 registros\nfor (let i = 1; i <= 50; i++) {\n  const dataKey = `data${i}`;\n  const efKey = `hh_efetivo${i}`;\n  const ctKey = `hh_contingencial${i}`;\n\n  if (mao[dataKey]) {\n    datas.push(mao[dataKey]);\n    totalEfetivo += Number(mao[efKey] || 0);\n    totalContingencial += Number(mao[ctKey] || 0);\n  }\n}\n\ndatas.sort((a,b) => new Date(a) - new Date(b));\n\nconst primeiraData = na(datas[0]);\nconst ultimaData = na(datas[datas.length - 1]);\n\nconst totalEfetivoFinal = datas.length > 0 ? totalEfetivo : \"N/A\";\nconst totalContingencialFinal = datas.length > 0 ? totalContingencial : \"N/A\";\nconst totalGeralFinal = datas.length > 0 ? totalEfetivo + totalContingencial : \"N/A\";\n\n// ---- RETORNAR SOMENTE DADOS DIRETOS ----\nreturn [\n  {\n    json: {\n      pecas_cliente,\n      pecas_medical_spin: pecas_ms,\n    \n      mao_de_obra: {\n        primeiraData,\n        ultimaData,\n        totalEfetivo: totalEfetivoFinal,\n        totalContingencial: totalContingencialFinal,\n        totalGeral: totalGeralFinal\n      }\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          4080,
          -1344
        ],
        "id": "dd7956d4-dbca-4506-9bf8-c106af8b1993",
        "name": "Soma horas"
      },
      {
        "parameters": {
          "jsCode": "// Função para converter string JSON em array\nfunction parseArray(str) {\n  try {\n    const arr = typeof str === \"string\" ? JSON.parse(str) : str;\n    return Array.isArray(arr) ? arr : [];\n  } catch {\n    return [];\n  }\n}\n\n// Função para enumerar objetos e transformar tudo em 1 objeto dentro de um array\nfunction enumerateObjects(array, fields) {\n  const obj = {};\n\n  array.forEach((entry, index) => {\n    const i = index + 1;\n    fields.forEach(f => {\n      obj[`${f}${i}`] = entry[f] ?? \"\";\n    });\n  });\n\n  return [obj];\n}\n\n// Acumuladores\nlet pecas_cliente_all = [];\nlet pecas_ms_all = [];\nlet mao_de_obra_all = [];\n\n// Junta todos os itens recebidos do nó anterior\nfor (const item of items) {\n  const data = item.json;\n\n  pecas_cliente_all.push(...parseArray(data.pecas_cliente));\n  pecas_ms_all.push(...parseArray(data.pecas_ms));\n  mao_de_obra_all.push(...parseArray(data.mao_de_obra));\n}\n\n// Agora enumera TODOS os campos\nconst final = {\n  pecas_cliente: enumerateObjects(pecas_cliente_all, [\"nome\", \"modelo\", \"sn\", \"detalhes\"]),\n  pecas_ms: enumerateObjects(pecas_ms_all, [\"nome\", \"modelo\", \"sn\", \"detalhes\"]),\n  mao_de_obra: enumerateObjects(mao_de_obra_all, [\"data\", \"hh_efetivo\", \"hh_contingencial\"])\n};\n\n// Retorna tudo em UM ÚNICO ITEM\nreturn [\n  {\n    json: final\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3872,
          -1344
        ],
        "id": "2347b070-77ea-4d26-85b1-a9c7b8ae5aa2",
        "name": "Junta itens"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "19409568-d828-48fc-896d-2eb240efc327",
                "name": "pecas_cliente",
                "value": "={{ $('dados').item.json.pecas_cliente }}",
                "type": "string"
              },
              {
                "id": "bda07dd3-5584-4644-9f3c-c9cfc6fbd109",
                "name": "pecas_ms",
                "value": "={{ $('dados').item.json.pecas_ms }}",
                "type": "string"
              },
              {
                "id": "037c90b6-20f5-4105-b3e9-16c23926a36b",
                "name": "mao_de_obra",
                "value": "={{ $('dados').item.json.mao_de_obra }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3664,
          -1344
        ],
        "id": "ccad6f4c-0024-45af-937d-9942412a49c9",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "operation": "update",
          "documentURL": "={{ $('Pega o documento').item.json.documentId }}",
          "actionsUi": {
            "actionFields": [
              {
                "action": "replaceAll",
                "text": "={{ $('Placeholder').item.json.placeholder }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.googleDocs",
        "typeVersion": 2,
        "position": [
          5136,
          -1344
        ],
        "id": "05345ff1-f4aa-46ab-9bd5-dc42e264bc6c",
        "name": "Atualiza documento1",
        "credentials": {
          "googleDocsOAuth2Api": {
            "id": "7uUks2OM1WgLSPNJ",
            "name": "Google Docs account"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "documentURL": "={{ $('Copia  o arquivo').item.json.id }}",
          "simple": false
        },
        "type": "n8n-nodes-base.googleDocs",
        "typeVersion": 2,
        "position": [
          4608,
          -1344
        ],
        "id": "38009dd5-d989-471a-bf1e-a0f16c605941",
        "name": "Pega o documento1",
        "credentials": {
          "googleDocsOAuth2Api": {
            "id": "7uUks2OM1WgLSPNJ",
            "name": "Google Docs account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9ea726e0-f65f-40c9-8372-f35482aa393f",
                "name": "nome",
                "value": "={{ $('Split Out').item.json.nome }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3104,
          -1344
        ],
        "id": "3b40c283-3eb3-4257-a67a-a8f3adc76bc3",
        "name": "Nome da imagem"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "14010743-1e77-4a33-8d67-19d0a442d36f",
                "name": "Index",
                "value": "={{ $('Pega o documento1').item.json.body.content[25].paragraph.elements[0].startIndex }}",
                "type": "number"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4960,
          -1344
        ],
        "id": "684b044a-91b1-499c-8673-826fc5774ffd",
        "name": "Index"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://docs.googleapis.com/v1/documents/{{ $json.documentId }}:batchUpdate",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleDocsOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"requests\": [\n    {\n      \"insertInlineImage\": {\n        \"location\": {\n          \"index\": {{ $json.index }}\n        },\n        \"uri\": \"https://drive.google.com/uc?export=view&id={{ $json.id }}\",\n        \"objectSize\": {\n          \"height\": {\n            \"magnitude\": 200,\n            \"unit\": \"PT\"\n          },\n          \"width\": {\n            \"magnitude\": 200,\n            \"unit\": \"PT\"\n          }\n        }\n      }\n    }\n  ]\n}\n",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          6336,
          -1200
        ],
        "id": "25cb1eaf-2812-4d69-b8de-4af6e63a307f",
        "name": "Cola imagem no documento",
        "credentials": {
          "googleDocsOAuth2Api": {
            "id": "7uUks2OM1WgLSPNJ",
            "name": "Google Docs account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "c6827f38-85e7-4810-b143-a5dab53ee0d9",
                "leftValue": "={{ $json.id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              },
              {
                "id": "929c970b-837b-4fa0-ac3e-c62b8b1aa1a0",
                "leftValue": "={{ $json.name }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          6128,
          -1184
        ],
        "id": "9db96db8-63f2-429d-a684-286fc5692d74",
        "name": "Id e Name?"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          5712,
          -1200
        ],
        "id": "bc9e038e-b188-4df1-abd4-1856d0dcc0dd",
        "name": "Percorre os itens"
      },
      {
        "parameters": {
          "jsCode": "const data = items.map(i => i.json);\n\n// Extrai info fixa (uma vez só)\nconst placeholder = data.find(d => d.placeholder)?.placeholder || null;\nconst index = data.find(d => d.Index !== undefined)?.Index || null;\nconst documentId = data.find(d => d.documentId)?.documentId || null;\n\n// Extrai driveId e fileid (únicos)\nconst driveId = data.find(d => d.driveId)?.driveId || null;\nconst fileid = data.find(d => d.fileid)?.fileid || null;\n\n// Pega todos os blocos com id + name\nconst arquivos = data.filter(d => d.id && d.name);\n\n// Remove duplicados por id\nconst ids = new Set();\nconst unicos = arquivos.filter(a => {\n  if (ids.has(a.id)) return false;\n  ids.add(a.id);\n  return true;\n});\n\n// Cria novo array de items no formato pedido\nreturn unicos.map(a => ({\n  json: {\n    placeholder,\n    index,\n    documentId,\n    driveId,\n    fileid,\n    id: a.id,\n    name: a.name\n  }\n}));"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          5552,
          -1200
        ],
        "id": "64a28664-6ef4-4a3e-a253-4d260d875fe8",
        "name": "Separa itens"
      },
      {
        "parameters": {
          "numberInputs": 6
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          5376,
          -1264
        ],
        "id": "c3a93c6c-0f60-42ed-b415-c23f95061ccb",
        "name": "Unir tudo"
      },
      {
        "parameters": {
          "operation": "update",
          "documentURL": "={{ $('Pega o documento').item.json.documentId }}",
          "actionsUi": {
            "actionFields": [
              {
                "object": "=text",
                "action": "replaceAll",
                "text": "{razao_social}",
                "replaceText": "={{ $('dados').item.json.razao_social }}",
                "index": 0
              },
              {
                "action": "replaceAll",
                "text": "{cnpj}",
                "replaceText": "={{ $('dados').item.json.cnpj }}"
              },
              {
                "action": "replaceAll",
                "text": "{cidade}",
                "replaceText": "={{ $('dados').item.json.cidade }}"
              },
              {
                "action": "replaceAll",
                "text": "{uf}",
                "replaceText": "={{ $('dados').item.json.uf }}"
              },
              {
                "action": "replaceAll",
                "text": "{nome_do_solicitante}",
                "replaceText": "={{ $('dados').item.json.responsavel }}"
              },
              {
                "action": "replaceAll",
                "text": "{fabricante}",
                "replaceText": "={{ $('dados').item.json.fabricante }}"
              },
              {
                "action": "replaceAll",
                "text": "{modelo}",
                "replaceText": "={{ $('dados').item.json.modelo }}"
              },
              {
                "action": "replaceAll",
                "text": "{serie}",
                "replaceText": "={{ $('dados').item.json.serie }}"
              },
              {
                "action": "replaceAll",
                "text": "{motivacao_servico}",
                "replaceText": "={{ $('dados').item.json.motivacao }}"
              },
              {
                "action": "replaceAll",
                "text": "{eventos_r_relacionados}",
                "replaceText": "={{ $('dados').item.json.eventos }}"
              },
              {
                "action": "replaceAll",
                "text": "{partes_removidas_cliente}",
                "replaceText": "={{ \n  ($('dados').item.json.pecas_cliente || []).length === 0 || $('dados').item.json.pecas_cliente.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados').item.json.pecas_cliente.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
              },
              {
                "action": "replaceAll",
                "text": "{partes_removidas_medicalspin}",
                "replaceText": "={{ \n  ($('dados').item.json.pecas_ms || []).length === 0 || $('dados').item.json.pecas_ms.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados').item.json.pecas_ms.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
              },
              {
                "action": "replaceAll",
                "text": "{tipo_intervencao}",
                "replaceText": "={{ $('dados').item.json.tipo_intervencao }}"
              },
              {
                "action": "replaceAll",
                "text": "{descricao_servicos_realizados}",
                "replaceText": "={{ $('dados').item.json.descricao_servicos }}"
              },
              {
                "action": "replaceAll",
                "text": "{data0}",
                "replaceText": "={{ $now.format('dd/LL/yyyy') }}"
              },
              {
                "action": "replaceAll",
                "text": "{data}",
                "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.primeiraData \n    ? new Date($('Soma horas').item.json.mao_de_obra.primeiraData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' \n}} - {{ $('Soma horas').item.json.mao_de_obra.ultimaData \n    ? new Date($('Soma horas').item.json.mao_de_obra.ultimaData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' }}"
              },
              {
                "action": "replaceAll",
                "text": "{medicalspin}",
                "replaceText": "={{ $('dados').item.json.pendencias_ms }}"
              },
              {
                "action": "replaceAll",
                "text": "{cliente}",
                "replaceText": "={{ $('dados').item.json.pendencias_cliente }}"
              },
              {
                "action": "replaceAll",
                "text": "{antes_intervencao}",
                "replaceText": "={{ $('dados').item.json.estado_inicial }}"
              },
              {
                "action": "replaceAll",
                "text": "{apos_intervensao}",
                "replaceText": "={{ $('dados').item.json.estado_final }}"
              },
              {
                "action": "replaceAll",
                "text": "{cidade_realizacao}",
                "replaceText": "={{ $('dados').item.json.cidade_realizacao }}"
              },
              {
                "action": "replaceAll",
                "text": "{uf_realizacao}",
                "replaceText": "={{ $('dados').item.json.uf_realizacao }}"
              },
              {
                "action": "replaceAll",
                "text": "{tecnico_responsavel}",
                "replaceText": "={{ $('dados').item.json.nome_tecnico }}"
              },
              {
                "action": "replaceAll",
                "text": "{cft}",
                "replaceText": "={{ $('dados').item.json.cft_tecnico }}"
              },
              {
                "action": "replaceAll",
                "text": "{recebedor}",
                "replaceText": "={{ $('dados').item.json.recebedor }}"
              },
              {
                "action": "replaceAll",
                "text": "{efetivo}",
                "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.totalEfetivo.toString() }}"
              },
              {
                "action": "replaceAll",
                "text": "{contingencial}",
                "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.totalContingencial.toString() }}"
              },
              {
                "action": "replaceAll",
                "text": "{total}",
                "replaceText": "={{ $('Soma horas').item.json.mao_de_obra.totalGeral.toString() }}"
              },
              {
                "action": "replaceAll",
                "text": "{fantasia}",
                "replaceText": "={{ $('dados').item.json.nome_fantasia }}"
              },
              {
                "action": "replaceAll",
                "text": "{tipo_equipamento}",
                "replaceText": "={{ $('dados').item.json.tipo_equipamento }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.googleDocs",
        "typeVersion": 2,
        "position": [
          4448,
          -1344
        ],
        "id": "ddc10945-90e8-4401-a308-32756129f4d0",
        "name": "Atualiza documento",
        "credentials": {
          "googleDocsOAuth2Api": {
            "id": "7uUks2OM1WgLSPNJ",
            "name": "Google Docs account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6fdcebc1-c772-40a8-bfc1-22584c6c2f93",
                "name": "placeholder",
                "value": "{fotos}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4784,
          -1344
        ],
        "id": "226cc3dc-ee95-4eb6-afc7-bf9263d3b8db",
        "name": "Placeholder"
      },
      {
        "parameters": {
          "operation": "get",
          "documentURL": "={{ $('Copia  o arquivo').item.json.id }}",
          "simple": false
        },
        "type": "n8n-nodes-base.googleDocs",
        "typeVersion": 2,
        "position": [
          4272,
          -1344
        ],
        "id": "f03a098e-b937-4eab-beed-024809517b50",
        "name": "Pega o documento",
        "credentials": {
          "googleDocsOAuth2Api": {
            "id": "7uUks2OM1WgLSPNJ",
            "name": "Google Docs account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Remove duplicados pelo campo \"id\"\nconst seen = new Set();\n\nconst unique = items.filter(item => {\n  const id = item.json.id;\n  if (seen.has(id)) return false;\n  seen.add(id);\n  return true;\n});\n\n// Retorna apenas os itens únicos\nreturn unique;\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3456,
          -1344
        ],
        "id": "ebcb854a-991f-40dc-b453-b945b709f36f",
        "name": "Junta repeticoes"
      },
      {
        "parameters": {
          "resource": "fileFolder",
          "queryString": "={{ $('Cria pasta').item.json.name }}",
          "limit": "={{ $items().filter(i => i.json.nome).length }}",
          "filter": {
            "folderId": {
              "__rl": true,
              "value": "={{ $('Cria pasta').item.json.id }}",
              "mode": "id"
            }
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3280,
          -1344
        ],
        "id": "af9b0df3-aefe-4931-a8dd-28d62e8e3666",
        "name": "Procura imagens",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "operation": "share",
          "fileId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "permissionsUi": {
            "permissionsValues": {
              "role": "writer",
              "type": "anyone"
            }
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3456,
          -1136
        ],
        "id": "9c362a60-3abb-49a1-a5ae-417ea1ab8f43",
        "name": "Torna publico",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4e8de6be-f93a-4806-897e-9cd6a0e9886a",
                "name": "midias",
                "value": "={{ $('dados').item.json.midias }}",
                "type": "object"
              }
            ]
          },
          "options": {
            "ignoreConversionErrors": true
          }
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2224,
          -1328
        ],
        "id": "0f1092b0-be01-4357-a482-f5713a00b12f",
        "name": "midia"
      },
      {
        "parameters": {
          "operation": "copy",
          "fileId": {
            "__rl": true,
            "value": "1zyQzlhzDDsDONuzHqaT8Kql0riKMl2uPk79so4DXtYs",
            "mode": "list",
            "cachedResultName": "OS_modelo",
            "cachedResultUrl": "https://docs.google.com/document/d/1zyQzlhzDDsDONuzHqaT8Kql0riKMl2uPk79so4DXtYs/edit?usp=drivesdk"
          },
          "name": "=OS_{{ $('dados').item.json.razao_social }}_{{ $('dados').item.json.cnpj }}_{{ $now.format('dd-LL-yyyy T') }}",
          "sameFolder": false,
          "driveId": {
            "__rl": true,
            "value": "https://drive.google.com/drive/folders/1OQHRuBKVD3WypEIhvQmiq5B8rh7bvsoS",
            "mode": "url"
          },
          "folderId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.id }}"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          2064,
          -1328
        ],
        "id": "093bc552-7eab-4605-b9d5-0182a628ae38",
        "name": "Copia  o arquivo",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "resource": "folder",
          "name": "=OS_{{ $('dados').item.json.razao_social }}_{{ $('dados').item.json.cnpj }}_{{ $now.format('dd-LL-yyyy T') }}",
          "driveId": {
            "__rl": true,
            "value": "https://drive.google.com/drive/folders/1nAeEaoG6QNZq2fuonNJB7GluFIhOffL1",
            "mode": "url"
          },
          "folderId": {
            "__rl": true,
            "value": "https://drive.google.com/drive/folders/1nAeEaoG6QNZq2fuonNJB7GluFIhOffL1",
            "mode": "url"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          1904,
          -1328
        ],
        "id": "4e526a61-3d0d-40aa-8d81-1dac8b50343e",
        "name": "Cria pasta",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "resource": "fileFolder",
          "queryString": "={{ $json.nome }}",
          "limit": "={{ $items().filter(i => i.json.nome).length }}",
          "filter": {
            "folderId": {
              "__rl": true,
              "value": "={{ $('Cria pasta').item.json.id }}",
              "mode": "id"
            }
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3280,
          -1200
        ],
        "id": "87ebcc50-c689-4466-ba8a-42befa558729",
        "name": "Imagens",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "fieldToSplitOut": "midias",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          2576,
          -1344
        ],
        "id": "81b26e1a-8b30-4325-b339-3ed018480731",
        "name": "Split Out"
      },
      {
        "parameters": {
          "name": "={{ $('Split Out').item.json.nome }}",
          "driveId": {
            "__rl": true,
            "value": "={{ $('Cria pasta').item.json.driveId }}",
            "mode": "id"
          },
          "folderId": {
            "__rl": true,
            "value": "={{ $('Cria pasta').item.json.id }}",
            "mode": "id"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          2928,
          -1344
        ],
        "id": "c0e0aa27-682b-4537-ae8d-869c9eceba16",
        "name": "Adiciona imagem",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// pega o item do webhook\nconst wh = $('Webhook2').first().json;\n\n// tenta pegar body.json (se existir)\nlet data = wh?.body?.json;\n\n// caso não exista, tenta pegar body inteiro\nif (!data && wh?.body) {\n  data = wh.body;\n}\n\n// caso o webhook tenha mandado direto no json\nif (!data) {\n  data = wh;\n}\n\n// se for string, tenta converter pra JSON\nif (typeof data === 'string') {\n  try {\n    data = JSON.parse(data);\n  } catch (err) {\n    throw new Error('JSON inválido recebido');\n  }\n}\n\n// função recursiva para substituir valores vazios\nfunction normalize(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(item => normalize(item));\n  }\n\n  if (obj !== null && typeof obj === 'object') {\n    const out = {};\n    for (const key in obj) {\n      const value = obj[key];\n\n      if (\n        value === \"\" ||\n        value === null ||\n        value === undefined\n      ) {\n        out[key] = \"N/A\";\n      } else {\n        out[key] = normalize(value);\n      }\n    }\n    return out;\n  }\n\n  return obj;\n}\n\nconst normalized = normalize(data);\n\nreturn [{ json: normalized }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1744,
          -1328
        ],
        "id": "7cd26316-33b4-44bc-ab71-60ca5bcfe4ea",
        "name": "dados"
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "base64",
          "options": {}
        },
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          2752,
          -1344
        ],
        "id": "94c45f2f-3163-4391-9b2f-855630e10c0a",
        "name": "Convert to File"
      },
      {
        "parameters": {
          "jsCode": "const map = new Map();\n\n// Pega os valores externos\nconst driveId = $('Separa itens').first().json.driveId;\nconst fileId = $('Separa itens').first().json.fileid;\nconst folderName = $('Cria pasta').first().json.name;\n\nfor (const item of items) {\n  const docId = item.json.documentId;\n\n  if (!map.has(docId)) {\n    // adiciona o item + os novos campos\n    map.set(docId, {\n      ...item.json,\n      driveId,\n      fileId,\n      folderName,\n    });\n  }\n}\n\n// retorna 1 item por documentId\nreturn Array.from(map.values()).map(json => ({ json }));"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          5936,
          -1344
        ],
        "id": "df08c294-ba6d-4ff3-9971-dcc4fa70f6e7",
        "name": "Remove duplicatas"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "4d8af4ea-6429-462d-a924-1e2a634d8775",
                "leftValue": "={{ $json.midias[0].base64 }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          2400,
          -1328
        ],
        "id": "152a89ce-7b61-4e47-8a16-ea27a738dde0",
        "name": "If2"
      },
      {
        "parameters": {
          "operation": "update",
          "documentURL": "={{ $('Pega o documento2').item.json.documentId }}",
          "actionsUi": {
            "actionFields": [
              {
                "action": "replaceAll",
                "text": "{razao_social}",
                "replaceText": "={{ $('dados').item.json.razao_social }}"
              },
              {
                "action": "replaceAll",
                "text": "{cnpj}",
                "replaceText": "={{ $('dados').item.json.cnpj }}"
              },
              {
                "action": "replaceAll",
                "text": "{cidade}",
                "replaceText": "={{ $('dados').item.json.cidade }}"
              },
              {
                "action": "replaceAll",
                "text": "{uf}",
                "replaceText": "={{ $('dados').item.json.uf }}"
              },
              {
                "action": "replaceAll",
                "text": "{nome_do_solicitante}",
                "replaceText": "={{ $('dados').item.json.responsavel }}"
              },
              {
                "action": "replaceAll",
                "text": "{fabricante}",
                "replaceText": "={{ $('dados').item.json.fabricante }}"
              },
              {
                "action": "replaceAll",
                "text": "{modelo}",
                "replaceText": "={{ $('dados').item.json.modelo }}"
              },
              {
                "action": "replaceAll",
                "text": "{serie}",
                "replaceText": "={{ $('dados').item.json.serie }}"
              },
              {
                "action": "replaceAll",
                "text": "{motivacao_servico}",
                "replaceText": "={{ $('dados').item.json.motivacao }}"
              },
              {
                "action": "replaceAll",
                "text": "{eventos_r_relacionados}",
                "replaceText": "={{ $('dados').item.json.eventos }}"
              },
              {
                "action": "replaceAll",
                "text": "{partes_removidas_cliente}",
                "replaceText": "={{ \n  ($('dados1').item.json.pecas_cliente || []).length === 0 || $('dados1').item.json.pecas_cliente.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados1').item.json.pecas_cliente.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
              },
              {
                "action": "replaceAll",
                "text": "{partes_removidas_medicalspin}",
                "replaceText": "={{ \n  ($('dados1').item.json.pecas_ms || []).length === 0 || $('dados1').item.json.pecas_cliente.every(p => Object.keys(p).length === 0) \n    ? \"N/A\" \n    : $('dados1').item.json.pecas_cliente.map(p => \n        `${p.nome || \"N/A\"}|${p.modelo || \"N/A\"}|${p.sn || \"N/A\"}|${p.detalhes || \"N/A\"}`\n      ).join('\\n') \n}}"
              },
              {
                "action": "replaceAll",
                "text": "{tipo_intervencao}",
                "replaceText": "={{ $('dados').item.json.tipo_intervencao }}"
              },
              {
                "action": "replaceAll",
                "text": "{descricao_servicos_realizados}",
                "replaceText": "={{ $('dados').item.json.descricao_servicos }}"
              },
              {
                "action": "replaceAll",
                "text": "{data0}",
                "replaceText": "={{ $now.format('dd/LL/yyyy') }}"
              },
              {
                "action": "replaceAll",
                "text": "{data}",
                "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.primeiraData \n    ? new Date($('Soma horas1').item.json.mao_de_obra.primeiraData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' \n}} - {{ $('Soma horas1').item.json.mao_de_obra.ultimaData \n    ? new Date($('Soma horas1').item.json.mao_de_obra.ultimaData + 'T00:00:00').toLocaleDateString('pt-BR') \n    : '0' }}"
              },
              {
                "action": "replaceAll",
                "text": "{medicalspin}",
                "replaceText": "={{ $('dados').item.json.pendencias_ms }}"
              },
              {
                "action": "replaceAll",
                "text": "{cliente}",
                "replaceText": "={{ $('dados').item.json.pendencias_cliente }}"
              },
              {
                "action": "replaceAll",
                "text": "{antes_intervencao}",
                "replaceText": "={{ $('dados').item.json.estado_inicial }}"
              },
              {
                "action": "replaceAll",
                "text": "{apos_intervensao}",
                "replaceText": "={{ $('dados').item.json.estado_final }}"
              },
              {
                "action": "replaceAll",
                "text": "{cidade_realizacao}",
                "replaceText": "={{ $('dados').item.json.cidade_realizacao }}"
              },
              {
                "action": "replaceAll",
                "text": "{uf_realizacao}",
                "replaceText": "={{ $('dados').item.json.uf_realizacao }}"
              },
              {
                "action": "replaceAll",
                "text": "{tecnico_responsavel}",
                "replaceText": "={{ $('dados').item.json.nome_tecnico }}"
              },
              {
                "action": "replaceAll",
                "text": "{cft}",
                "replaceText": "={{ $('dados').item.json.cft_tecnico }}"
              },
              {
                "action": "replaceAll",
                "text": "{recebedor}",
                "replaceText": "={{ $('dados').item.json.recebedor }}"
              },
              {
                "action": "replaceAll",
                "text": "{efetivo}",
                "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.totalEfetivo.toString() }}"
              },
              {
                "action": "replaceAll",
                "text": "{contingencial}",
                "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.totalContingencial.toString() }}"
              },
              {
                "action": "replaceAll",
                "text": "{total}",
                "replaceText": "={{ $('Soma horas1').item.json.mao_de_obra.totalGeral.toString() }}"
              },
              {
                "action": "replaceAll",
                "text": "{fotos}",
                "replaceText": "N/A"
              },
              {
                "action": "replaceAll",
                "text": "{fantasia}",
                "replaceText": "={{ $('dados').item.json.nome_fantasia }}"
              },
              {
                "action": "replaceAll",
                "text": "{tipo_equipamento}",
                "replaceText": "={{ $('dados').item.json.tipo_equipamento }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.googleDocs",
        "typeVersion": 2,
        "position": [
          3104,
          -992
        ],
        "id": "259303c8-8ed1-4384-a947-40a10162bbd6",
        "name": "Atualiza documento2",
        "credentials": {
          "googleDocsOAuth2Api": {
            "id": "7uUks2OM1WgLSPNJ",
            "name": "Google Docs account"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "documentURL": "={{ $('Copia  o arquivo').item.json.id }}",
          "simple": false
        },
        "type": "n8n-nodes-base.googleDocs",
        "typeVersion": 2,
        "position": [
          2928,
          -992
        ],
        "id": "398a572e-d0fb-4653-9e39-295a0672c64f",
        "name": "Pega o documento2",
        "credentials": {
          "googleDocsOAuth2Api": {
            "id": "7uUks2OM1WgLSPNJ",
            "name": "Google Docs account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Pega todos os itens do nó \"dados\"\nconst dados = $('dados').all();\n\n// Retorna exatamente o que veio do nó \"dados\"\nreturn dados;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2576,
          -992
        ],
        "id": "3155a6e7-535f-4e80-a1e2-8fb200ae04e2",
        "name": "dados1"
      },
      {
        "parameters": {
          "jsCode": "const data = items[0].json; // Acesso ao dado no primeiro item\n\n// Utilitário para aplicar \"N/A\"\nconst na = v => (v === undefined || v === null || v === \"\" ? \"N/A\" : v);\n\n// Arrays de peças (se vierem vazios, devolve array vazio — correto)\nconst pecas_cliente = data.pecas_cliente || [];\nconst pecas_ms = data.pecas_ms || [];\n\n// Mão de Obra\nconst mao = data.mao_de_obra || [];\n\nlet datas = [];\nlet totalEfetivo = 0;\nlet totalContingencial = 0;\n\n// Suporta até 50 registros\nmao.forEach((registro) => {\n  datas.push(registro.data);\n  totalEfetivo += Number(registro.hh_efetivo || 0);\n  totalContingencial += Number(registro.hh_contingencial || 0);\n});\n\ndatas.sort((a, b) => new Date(a) - new Date(b));\n\n// Primeira e última data\nconst primeiraData = datas.length > 0 ? datas[0] : \"N/A\";\nconst ultimaData = datas.length > 0 ? datas[datas.length - 1] : \"N/A\";\n\n// Se não houverem registros, retorna \"N/A\"\nconst totalEfetivoFinal = totalEfetivo > 0 ? totalEfetivo : \"N/A\";\nconst totalContingencialFinal = totalContingencial > 0 ? totalContingencial : \"N/A\";\nconst totalGeralFinal = totalEfetivo + totalContingencial > 0 ? totalEfetivo + totalContingencial : \"N/A\";\n\n// Formatando as peças\nconst pecas_clienteFormatted = pecas_cliente.map(peca => `${peca.nome}|${peca.modelo}|${peca.sn}|${peca.detalhes}`).join(\"\\n\");\nconst pecas_msFormatted = pecas_ms.map(peca => `${peca.nome}|${peca.modelo}|${peca.sn}|${peca.detalhes}`).join(\"\\n\");\n\n// Retorno do objeto\nreturn [\n  {\n    json: {\n      pecas_cliente: pecas_clienteFormatted || \"N/A\",\n      pecas_ms: pecas_msFormatted || \"N/A\",\n      mao_de_obra: {\n        primeiraData,\n        ultimaData,\n        totalEfetivo: totalEfetivoFinal,\n        totalContingencial: totalContingencialFinal,\n        totalGeral: totalGeralFinal\n      }\n    }\n  }\n];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2752,
          -992
        ],
        "id": "0e61ed3c-f82d-43d1-8302-b906500cc9d2",
        "name": "Soma horas1"
      },
      {
        "parameters": {
          "name": "={{ $('Cria pasta').item.json.name }}",
          "driveId": {
            "__rl": true,
            "value": "={{ $('Cria pasta').item.json.driveId }}",
            "mode": "id"
          },
          "folderId": {
            "__rl": true,
            "value": "={{ $('Cria pasta').item.json.id }}",
            "mode": "id"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3456,
          -992
        ],
        "id": "e2274c1d-abd5-4470-973b-025299c328d9",
        "name": "Upload file1",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "operation": "download",
          "fileId": {
            "__rl": true,
            "value": "={{ $json.documentId }}",
            "mode": "id"
          },
          "options": {
            "googleFileConversion": {
              "conversion": {
                "docsToFormat": "application/pdf"
              }
            }
          }
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3280,
          -992
        ],
        "id": "352a74ab-c13a-4bcb-8088-b29c8e5e46b7",
        "name": "Download file1",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
            "mode": "list",
            "cachedResultName": "DBRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "dbRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "RemoteId": "={{ $json.data.key.remoteJid }}"
            },
            "matchingColumns": [
              "RemoteId"
            ],
            "schema": [
              {
                "id": "RemoteId",
                "displayName": "RemoteId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1088,
          -896
        ],
        "id": "4d979810-5bcf-4269-9c66-5260bdc87aa1",
        "name": "RemoteId",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
            "mode": "list",
            "cachedResultName": "DBRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "dbRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          4064,
          -992
        ],
        "id": "c6955e87-076a-43c9-b7b2-23e0f8776d5e",
        "name": "RemoteId1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
            "mode": "list",
            "cachedResultName": "DBRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "dbRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          7088,
          -1344
        ],
        "id": "46abee3d-cc0d-4f57-8594-836c4c93617e",
        "name": "RemoteId2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "operation": "delete",
          "documentId": {
            "__rl": true,
            "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
            "mode": "list",
            "cachedResultName": "DBRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "dbRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1744,
          -608
        ],
        "id": "a637477a-ce8e-4978-bd3f-677fd8e7a5e0",
        "name": "Delete RemoteId1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('@s.whatsapp.net').item.json.remoteJid }}",
          "messageText": "Olá! 👋 Eu sou o *Magnetto*, seu assistente virtual. Estou aqui para ajudar você com dúvidas, suporte e informações de forma rápida e simples. \n\nComo posso ajudar você hoje? \n\n1️⃣​-Criar OS\n2️⃣-Consultar Drive de OS\n3️⃣-Consultar OS por Cliente\n4️⃣-Cadastrar Cliente\n5️⃣-Consultar Lista de Clientes\n6️⃣-Sair",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          656,
          -896
        ],
        "id": "6a4bea40-67e6-491f-b90b-1140ba7b7344",
        "name": "Menu",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "*Por favor, preencha o formulário abaixo para gerar a ordem de serviço:*\n\nhttps://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/form-autocomplete",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -1328
        ],
        "id": "b7252041-d11a-4e7c-b600-dde467eb092c",
        "name": "Opcao1",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $json.RemoteId }}",
          "messageText": "=OS gerada com sucesso!\nAcesse através do link abaixo:\n\n{{ $('Id e link1').item.json.name }}\n\n{{ $('Id e link1').item.json.webViewLink }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          7264,
          -1344
        ],
        "id": "98866ba1-72a1-41a3-8358-3b6e40fc88e8",
        "name": "Envia OS",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $json.RemoteId }}",
          "messageText": "=OS gerada com sucesso!\nAcesse através do link abaixo:\n\n{{ $('Id e link').item.json.name }}\n\n{{ $('Id e link').item.json.webViewLink }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          4240,
          -992
        ],
        "id": "635dc49b-e05b-473b-a13b-837adfdc2abd",
        "name": "Envia OS1",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "operation": "deleteFile",
          "fileId": {
            "__rl": true,
            "value": "={{ $('Id e Name?').item.json.id }}",
            "mode": "id"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          6544,
          -1200
        ],
        "id": "3ee3f30a-50cf-42a4-a96a-7c5cd1d15250",
        "name": "Deleta Imagens",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "Yg0MqWhsgxFkLHnh",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "*Para consultar todas as OS, acesse o link abaixo:*\n\nhttps://drive.google.com/drive/folders/1nAeEaoG6QNZq2fuonNJB7GluFIhOffL1\n",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -1184
        ],
        "id": "90afdc15-1b6f-48e9-b0c4-edaf327d942a",
        "name": "Opcao2",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "cdd26832-a245-46f5-ae40-9c1c73ee68c5",
                "name": "id",
                "value": "={{ $json.id }}",
                "type": "string"
              },
              {
                "id": "9c1c92b4-c090-400c-952b-40aa56ee5824",
                "name": "name",
                "value": "={{ $json.name }}",
                "type": "string"
              },
              {
                "id": "a3722cd0-8dab-4ba5-9a6a-800a6e113562",
                "name": "webViewLink",
                "value": "={{ $json.webViewLink }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3648,
          -992
        ],
        "id": "b2f9cb26-be10-4610-8422-9dd044c8832f",
        "name": "Id e link"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "cdd26832-a245-46f5-ae40-9c1c73ee68c5",
                "name": "id",
                "value": "={{ $json.id }}",
                "type": "string"
              },
              {
                "id": "9c1c92b4-c090-400c-952b-40aa56ee5824",
                "name": "name",
                "value": "={{ $json.name }}",
                "type": "string"
              },
              {
                "id": "a3722cd0-8dab-4ba5-9a6a-800a6e113562",
                "name": "webViewLink",
                "value": "={{ $json.webViewLink }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          6544,
          -1344
        ],
        "id": "383ccba8-6faf-4736-aff4-f0166105b4ac",
        "name": "Id e link1"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "*Para consultar OS por cliente, digite o nome fantasia e/ou cnpj no seguinte formato:*\n\nEx: OS_{nome fantasia}\nEx: OS_{cnpj}\nEx: OS_{nome fantasia}_{cnpj}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -1040
        ],
        "id": "fbc45f04-31ed-457b-81eb-1941f60c4bd6",
        "name": "Opcao3",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
            "mode": "list",
            "cachedResultName": "OS_DB",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 824063472,
            "mode": "list",
            "cachedResultName": "DB_OS",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=824063472"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1568,
          -160
        ],
        "id": "63085b1e-0547-4eb2-9915-64caaf066c27",
        "name": "OS consult",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9ea726e0-f65f-40c9-8372-f35482aa393f",
                "name": "message.conversation",
                "value": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                "type": "string"
              },
              {
                "id": "403b707f-3230-4e09-bad7-3e22285eebe2",
                "name": "body.data.key.remoteJid",
                "value": "={{ $('@s.whatsapp.net').item.json.remoteJid }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1376,
          -160
        ],
        "id": "d6c1db92-e521-4339-9db5-4234a53d5ec3",
        "name": "InputOS"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $items(\"InputOS\").map(i => i.json.body.data.key.remoteJid).join(\", \") }}",
          "messageText": "={{ $json['OS NOME'] }}\n\n{{ $json['OS LINK'] }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          2336,
          -144
        ],
        "id": "fb586b30-61eb-47d5-9171-e614b3295f23",
        "name": "OS retorno",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $items(\"InputOS\").map(i => i.json.body.data.key.remoteJid).join(\", \") }}",
          "messageText": "Sinto muito😓. Não consegui encontrar a OS solicitada. *Tente outro parâmetro ou busque por todas as OS na opção* 2️⃣.",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          2176,
          -288
        ],
        "id": "81192117-4589-437a-86fb-1e45f35869f3",
        "name": "OS sem retorno",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "loose",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.aviso }}",
                      "rightValue": "={{ $json.encontrado }}",
                      "operator": {
                        "type": "boolean",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "id": "14cb2cae-9efa-4301-a85d-4b9f0a205f47"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Nao encontrado"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "loose",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "e84b75c3-aec4-4234-91de-0d9f1f51576c",
                      "leftValue": "={{ $json.row_number }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Encontrado"
              }
            ]
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          1904,
          -160
        ],
        "id": "dde7f321-c98f-4e5a-872c-f980bd6c4d44",
        "name": "Switch1"
      },
      {
        "parameters": {
          "jsCode": "// 1. Pega a conversa do nó InputOS\nconst conversa = $('InputOS').first().json.message.conversation;\n\n// 2. Regex para capturar todas as ocorrências de \"OS_xxx\"\n// Vai capturar qualquer texto depois de OS_ até espaço, ponto e vírgula ou fim\nconst regex = /OS_([\\wçãáéíóúâêîôû.\\- ]+)/gi;\nlet matches = [];\nlet match;\n\nwhile ((match = regex.exec(conversa)) !== null) {\n  matches.push(match[1].trim()); // pega somente o que vem depois de \"OS_\"\n}\n\n// 3. Array de saída\nconst output = [];\n\n// 4. Percorre cada linha do Sheets\nitems.forEach(item => {\n  const linha = item.json;\n\n  // Para cada OS capturado na conversa\n  const osEncontrados = matches.filter(osTexto => {\n    // Se o OS for composto, como \"NOME FANTASIA_CNPJ\", separa por \"_\"\n    const partes = osTexto.split(\"_\").map(p => p.trim().toLowerCase());\n\n    // Verifica se **todos os valores da linha correspondentes às partes** existem\n    return partes.every(p => \n      Object.values(linha).some(valor =>\n        valor && valor.toString().toLowerCase().includes(p)\n      )\n    );\n  });\n\n  if (osEncontrados.length > 0) {\n    // Adiciona toda a linha ao output\n    output.push({ json: linha });\n  }\n});\n\n// 5. Caso não encontre nada\nif (output.length === 0) {\n  output.push({\n    json: { aviso: \"Nenhum OS encontrado na conversa\" }\n  });\n}\n\nreturn output;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1744,
          -160
        ],
        "id": "0c47cbf9-2b9d-4cc8-9532-77b26b6cfd75",
        "name": "Busca Item"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "Para cadastrar um lead preencha o formulário abaixo:\n\nhttps://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -896
        ],
        "id": "26b6085e-62c0-4276-b07d-a154d183e07e",
        "name": "Opcao4",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "*Para consultar todos os clientes, acesse o link abaixo:*\n\nhttps://docs.google.com/spreadsheets/d/1UOKUJUAfGqgLoukUSzf38ceTzDY5b9KCfnB6nifpkF8/edit?gid=1955323770#gid=1955323770",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -752
        ],
        "id": "0ef74276-349c-4d81-b324-75480dfd0961",
        "name": "Opcao5",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "Até logo👋. Para me chamar novamente, basta digitar *Magnetto*",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -608
        ],
        "id": "89e87212-8d72-430d-8a09-174bdd85e2e0",
        "name": "Opcao6",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "cadastra-cliente",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          1568,
          -896
        ],
        "id": "2027fa3f-8f5e-4890-b9e5-bc22a2ea640d",
        "name": "Webhook4",
        "webhookId": "c9903894-999b-4b0a-ba88-396ca0c58503"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a6c8faeb-4778-4734-92d1-feb2fbf91bb5",
                "name": "razao_social",
                "value": "={{ $json.body.razao_social }}",
                "type": "string"
              },
              {
                "id": "43d95c98-b5cf-44b0-8b02-bd41b4e59cd1",
                "name": "fantasia",
                "value": "={{ $json.body.fantasia }}",
                "type": "string"
              },
              {
                "id": "72c28476-251c-49a7-a85e-2cfff36ce10b",
                "name": "cnpj",
                "value": "={{ $json.body.cnpj }}",
                "type": "string"
              },
              {
                "id": "0295e266-295c-4666-a18e-847986475fb1",
                "name": "cidade",
                "value": "={{ $json.body.cidade }}",
                "type": "string"
              },
              {
                "id": "ee2bf291-c0eb-45d7-92bf-3a985cc9fd91",
                "name": "uf",
                "value": "={{ $json.body.uf }}",
                "type": "string"
              },
              {
                "id": "948b3fac-f623-432c-b75b-8ccb1350b353",
                "name": "telefone",
                "value": "={{ $json.body.telefone }}",
                "type": "string"
              },
              {
                "id": "054546a9-a06d-4bf6-9f24-1ab2965185a8",
                "name": "email",
                "value": "={{ $json.body.email }}",
                "type": "string"
              },
              {
                "id": "3d5e47b0-3779-4772-8c7d-d0e31323087d",
                "name": "responsavel",
                "value": "={{ $json.body.responsavel }}",
                "type": "string"
              },
              {
                "id": "e8279561-82e9-4161-8ef8-d2c99a0b5c01",
                "name": "equipamentos",
                "value": "={{ $json.body.equipamentos }}",
                "type": "array"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1744,
          -896
        ],
        "id": "301ac7be-47bf-4898-b799-4c6c5fe2f820",
        "name": "Edit Fields2"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
            "mode": "list",
            "cachedResultName": "OS_DB",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1955323770,
            "mode": "list",
            "cachedResultName": "DB_cliente",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=1955323770"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "ID CLIENTE": "={{ $('Code in JavaScript').item.json.id }}",
              "RAZAO SOCIAL": "={{ $('Code in JavaScript').item.json.razao_social }}",
              "NOME FANTASIA": "={{ $('Code in JavaScript').item.json.fantasia }}",
              "CNPJ": "={{ $('Code in JavaScript').item.json.cnpj }}",
              "CIDADE": "={{ $('Code in JavaScript').item.json.cidade }}",
              "UF": "={{ $('Code in JavaScript').item.json.uf }}",
              "TELEFONE": "={{ $('Code in JavaScript').item.json.telefone }}",
              "EMAIL": "={{ $('Code in JavaScript').item.json.email }}",
              "RESPONSAVEL": "={{ $('Code in JavaScript').item.json.responsavel }}",
              "DATA CADASTRO CLIENTE": "={{ $now.format('dd/LL/yyyy T') }}"
            },
            "matchingColumns": [
              "ID CLIENTE"
            ],
            "schema": [
              {
                "id": "ID CLIENTE",
                "displayName": "ID CLIENTE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "RAZAO SOCIAL",
                "displayName": "RAZAO SOCIAL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "NOME FANTASIA",
                "displayName": "NOME FANTASIA",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "CNPJ",
                "displayName": "CNPJ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "CIDADE",
                "displayName": "CIDADE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "UF",
                "displayName": "UF",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "TELEFONE",
                "displayName": "TELEFONE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "EMAIL",
                "displayName": "EMAIL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "RESPONSAVEL",
                "displayName": "RESPONSAVEL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "DATA CADASTRO CLIENTE",
                "displayName": "DATA CADASTRO CLIENTE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2096,
          -896
        ],
        "id": "7e30560c-a9b8-432b-9683-b629186d361a",
        "name": "DB2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
            "mode": "list",
            "cachedResultName": "DBRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "dbRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2096,
          -752
        ],
        "id": "7c2e0cde-44d9-49e8-a042-4f296fa57b5b",
        "name": "RemoteId3",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "d781a289-6d68-40eb-96c7-ec1447d05d67",
                "name": "remoteJid",
                "value": "={{ $json.body.data.key.remoteJid }}",
                "type": "string"
              },
              {
                "id": "f4a7fedc-08c2-44af-a786-12dc2d32e1c2",
                "name": "remoteJidAlt",
                "value": "={{ $json.body.data.key.remoteJidAlt }}",
                "type": "string"
              },
              {
                "id": "ec3f6212-f64c-456f-b6e5-a14d7d2f70b9",
                "name": "conversation",
                "value": "={{ $json.body.data.message.conversation }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -48,
          -880
        ],
        "id": "967d3c7c-d934-4a41-b615-fa53991498be",
        "name": "Edit Fields3"
      },
      {
        "parameters": {
          "jsCode": "// Pega o primeiro item\nconst data = $input.first().json;\n\n// Lista de campos possíveis\nconst campos = [\n  data.remoteJid,\n  data.remoteJidAlt,\n  data.conversation\n];\n\n// Filtra e pega somente o que contém \"@s.whatsapp.net\"\nconst result = campos.find(v => typeof v === 'string' && v.includes('@s.whatsapp.net'));\n\n// Retorna o resultado\nreturn [\n  {\n    json: {\n      remoteJid: result || null\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          160,
          -880
        ],
        "id": "d36ddf59-b982-41e7-9c4b-4200d7930d97",
        "name": "@s.whatsapp.net"
      },
      {
        "parameters": {
          "path": "form-autocomplete",
          "responseMode": "responseNode",
          "options": {}
        },
        "id": "0170a4dc-be53-4045-9d33-4d6c09073a88",
        "name": "Carrega HTML",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          1568,
          -1472
        ],
        "webhookId": "form-autocomplete-001"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "={{ $json.html }}",
          "options": {}
        },
        "id": "0a164912-75a4-41a8-b7c0-0cca43b17169",
        "name": "Retorna HTML",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1904,
          -1472
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "autocomplete-busca",
          "responseMode": "responseNode",
          "options": {
            "allowedOrigins": "*",
            "responseHeaders": {
              "entries": [
                {
                  "name": "=Access-Control-Allow-Methods",
                  "value": "*"
                },
                {
                  "name": "=Access-Control-Allow-Methods",
                  "value": "=GET, POST, OPTIONS"
                }
              ]
            }
          }
        },
        "id": "d6b76b6d-534c-40ad-97a5-8857b73ca8c4",
        "name": "Busca no Sheets",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          2064,
          -1472
        ],
        "webhookId": "autocomplete-busca-001"
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "c00c1727-4757-41d4-9615-c6ecf0e3141a",
        "name": "Retorna sugestões",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          2752,
          -1472
        ]
      },
      {
        "parameters": {
          "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1955323770&tqx=out:json&tq=SELECT%20*",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2224,
          -1472
        ],
        "id": "f96f5d0e-475f-4fa8-9477-fd226d6634c9",
        "name": "HTTP Request3"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $json.RemoteId }}",
          "messageText": "=Cliente cadastrado com sucesso! Deseja criar uma OS?\n\n7️⃣-Sim\n8️⃣-Não",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          2272,
          -752
        ],
        "id": "14cab1a7-d46c-4b28-90ed-3444ed50505e",
        "name": "Confirma Cliente",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "path": "cadastra-cliente",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          2944,
          -576
        ],
        "id": "c12a9094-a099-4be3-8b61-f50f56141d23",
        "name": "Webhook5",
        "webhookId": "8afdcc7b-cb27-48e4-919c-38d8824e1cf1"
      },
      {
        "parameters": {
          "html": "<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n<title>Cadastro de Cliente</title>\n\n<style>\n:root{\n  --bg:#f3f6fb;\n  --surface:#ffffff;\n  --muted:#6b7280;\n  --accent:#0b74ff;\n  --danger:#dc2626;\n  --card-radius:12px;\n  --input-radius:8px;\n  --border:#e6e9ef;\n  --shadow-1:0 6px 20px rgba(16,24,40,0.06);\n  --font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial;\n  --max-width:420px;\n}\n\n*{box-sizing:border-box}\nbody{\n  margin:0;\n  font-family:var(--font-family);\n  background:linear-gradient(180deg,var(--bg),#eef4ff 120px);\n  padding:24px 12px;\n  display:flex;\n  justify-content:center;\n}\n\n.card{\n  width:100%;\n  max-width:var(--max-width);\n  background:#fff;\n  padding:25px;\n  border-radius:var(--card-radius);\n  box-shadow:var(--shadow-1);\n}\n\n.title{font-size:20px;font-weight:700;margin-bottom:4px}\n.subtitle{font-size:14px;color:var(--muted);margin-bottom:20px}\n\nlabel{display:block;font-size:13px;margin-bottom:6px;font-weight:600}\n.group{margin-bottom:16px}\n\n.field{\n  width:100%;\n  padding:11px 12px;\n  border-radius:var(--input-radius);\n  border:1px solid var(--border);\n  font-size:14px;\n}\n\nbutton{\n  padding:12px 16px;\n  border:0;\n  border-radius:var(--card-radius);\n  background:var(--accent);\n  color:#fff;\n  font-weight:700;\n  cursor:pointer;\n}\n\nbutton.btn-ghost{\n  background:transparent;\n  color:var(--accent);\n  border:1px solid rgba(11,116,255,0.2);\n}\n\n.equip-list{margin-top:12px}\n.equip-item{\n  display:flex;\n  justify-content:space-between;\n  align-items:center;\n  padding:8px 10px;\n  border:1px solid #eee;\n  border-radius:8px;\n  margin-bottom:6px;\n  font-size:14px;\n}\n\n.modal{\n  display:none;\n  position:fixed;\n  inset:0;\n  background:rgba(0,0,0,.5);\n  justify-content:center;\n  align-items:center;\n}\n.modal-content{\n  background:#fff;\n  padding:20px;\n  border-radius:12px;\n  width:90%;\n  max-width:400px;\n}\n.close{\n  float:right;\n  cursor:pointer;\n  font-size:20px;\n}\n\n/* input sentinela invisível mas válido */\n.validator{\n  position:absolute;\n  opacity:0;\n  height:0;\n  pointer-events:none;\n}\n</style>\n</head>\n<body>\n\n<form class=\"card\" id=\"equipForm\" novalidate>\n  <div class=\"title\">Cadastro de Cliente</div>\n  <div class=\"subtitle\">Preencha corretamente os dados abaixo.</div>\n\n  <div class=\"group\"><label>Razão Social</label><input class=\"field\" name=\"razao_social\" required></div>\n  <div class=\"group\"><label>Nome Fantasia</label><input class=\"field\" name=\"fantasia\" required></div>\n  <div class=\"group\"><label>CNPJ</label><input class=\"field\" name=\"cnpj\" required></div>\n  <div class=\"group\"><label>Cidade</label><input class=\"field\" name=\"cidade\" required></div>\n\n  <div class=\"group\">\n    <label>UF</label>\n    <select name=\"uf\" class=\"field\" required>\n      <option value=\"\">Selecione</option> <option value=\"AC\">AC</option> <option value=\"AL\">AL</option> <option value=\"AP\">AP</option> <option value=\"AM\">AM</option> <option value=\"BA\">BA</option> <option value=\"CE\">CE</option> <option value=\"DF\">DF</option> <option value=\"ES\">ES</option> <option value=\"GO\">GO</option> <option value=\"MA\">MA</option> <option value=\"MT\">MT</option> <option value=\"MS\">MS</option> <option value=\"MG\">MG</option> <option value=\"PA\">PA</option> <option value=\"PB\">PB</option> <option value=\"PR\">PR</option> <option value=\"PE\">PE</option> <option value=\"PI\">PI</option> <option value=\"RJ\">RJ</option> <option value=\"RN\">RN</option> <option value=\"RS\">RS</option> <option value=\"RO\">RO</option> <option value=\"RR\">RR</option> <option value=\"SC\">SC</option> <option value=\"SE\">SE</option> <option value=\"SP\">SP</option> <option value=\"TO\">TO</option>\n    </select>\n  </div>\n\n  <div class=\"group\"><label>Telefone</label><input class=\"field\" name=\"telefone\" required></div>\n  <div class=\"group\"><label>Email</label><input class=\"field\" name=\"email\" type=\"email\" required></div>\n  <div class=\"group\"><label>Responsável</label><input class=\"field\" name=\"responsavel\" required></div>\n\n  <button type=\"button\" onclick=\"openModal()\">Adicionar Equipamento</button>\n  <div id=\"equipamentosPreview\" class=\"equip-list\"></div>\n\n  <!-- INPUT SENTINELA (VALIDAÇÃO DE EQUIPAMENTOS) -->\n  <input id=\"equipValidator\" class=\"validator\">\n\n  <button type=\"submit\">Cadastrar Cliente</button>\n</form>\n\n<div class=\"modal\" id=\"modal\">\n  <div class=\"modal-content\">\n    <span class=\"close\" onclick=\"closeModal()\">×</span>\n    <h3>Adicionar Equipamento</h3>\n\n    <div class=\"group\"><label>Tipo</label><input id=\"equipTipo\" class=\"field\" value=\"Ressonância Magnética\"></div>\n    <div class=\"group\"><label>Fabricante</label> <select id=\"equipFabricante\" name=\"equipFabricante\" class=\"field compact\" required > <option value=\"\">Selecione</option> <option>Philips</option><option>GE HealthCare</option><option>Siemens Healthineers AG</option><option>Canon Medical Systems</option><option>Hitachi</option> </select></div>\n    <div class=\"group\"><label>Modelo</label> <select id=\"equipModelo\" name=\"equipModelo\" class=\"field compact\" required > <option value=\"\">Selecione</option> <option>Achieva 1.5T</option><option>Intera/Achieva 1.5T</option><option>NT/Intera 1.0T</option><option>NT/Intera 0.5T</option><option>ACS-NT 1.5T</option><option>Achieva 3.0T</option><option>Multiva 1.5T</option><option>Prodiva1.5T</option><option>Ingenia Ambition 1.5T</option><option>Ingenia Elition 1.5T</option> </select></div>\n    <div class=\"group\"><label>Nº Série</label><input id=\"equipSerie\" class=\"field\"></div>\n\n    <button type=\"button\" onclick=\"adicionarEquipamento()\">Adicionar</button>\n  </div>\n</div>\n\n<script>\nlet equipamentos = [];\nconst form = document.getElementById(\"equipForm\");\nconst validator = document.getElementById(\"equipValidator\");\n\nform.addEventListener(\"submit\", async e => {\n  e.preventDefault();\n\n  // valida equipamentos\n  if (equipamentos.length === 0) {\n    validator.setCustomValidity(\"Cadastre pelo menos 1 equipamento.\");\n  } else {\n    validator.setCustomValidity(\"\");\n  }\n\n  if (!form.checkValidity()) {\n    form.reportValidity();\n    return;\n  }\n\n  const data = Object.fromEntries(new FormData(form));\n  data.equipamentos = equipamentos;\n\n  await fetch(\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(data)\n  });\n\n  alert(\"Cliente cadastrado com sucesso!\");\n  form.reset();\n  equipamentos = [];\n  atualizarPreview();\n});\n\nfunction openModal(){ modal.style.display=\"flex\"; }\nfunction closeModal(){ modal.style.display=\"none\"; }\n\nfunction adicionarEquipamento(){\n  const tipo = equipTipo.value.trim();\n  const fabricante = equipFabricante.value.trim();\n  const modelo = equipModelo.value.trim();\n  const serie = equipSerie.value.trim();\n\n  if(!tipo || !fabricante || !modelo || !serie){\n    alert(\"Preencha todos os campos do equipamento.\");\n    return;\n  }\n\n  equipamentos.push({tipo,fabricante,modelo,serie});\n  atualizarPreview();\n  closeModal();\n}\n\nfunction atualizarPreview(){\n  const div = document.getElementById(\"equipamentosPreview\");\n  div.innerHTML = \"\";\n  equipamentos.forEach((e,i)=>{\n    div.innerHTML += `\n      <div class=\"equip-item\">\n        ${e.tipo} | ${e.fabricante} | ${e.modelo} | ${e.serie}\n        <button type=\"button\" class=\"btn-ghost\" onclick=\"removerEquipamento(${i})\">x</button>\n      </div>`;\n  });\n}\n\nfunction removerEquipamento(i){\n  equipamentos.splice(i,1);\n  atualizarPreview();\n}\n</script>\n\n</body>\n</html>\n"
        },
        "type": "n8n-nodes-base.html",
        "typeVersion": 1.2,
        "position": [
          3120,
          -576
        ],
        "id": "1671b721-534b-413b-9c83-bf81f05b5c6f",
        "name": "HTML"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "={{ $json.html }}",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.4,
        "position": [
          3280,
          -576
        ],
        "id": "4bb62877-6e6f-4a4d-958a-771e70d8e2ba",
        "name": "Respond to Webhook"
      },
      {
        "parameters": {
          "jsCode": "// Gera um ID aleatório de 6 dígitos (único para toda a execução)\nconst idUnico = Math.floor(100000 + Math.random() * 900000);\n\n// Função para capitalizar a primeira letra da cidade\nfunction formatarCidade(cidade) {\n  if (!cidade || typeof cidade !== 'string') return cidade;\n  const texto = cidade.toLowerCase().trim();\n  return texto.charAt(0).toUpperCase() + texto.slice(1);\n}\n\n// Função para formatar CNPJ\nfunction formatarCNPJ(cnpj) {\n  if (!cnpj) return cnpj;\n\n  const numeros = cnpj.replace(/\\D/g, '');\n  if (numeros.length !== 14) return cnpj;\n\n  return numeros.replace(\n    /^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})$/,\n    '$1.$2.$3/$4-$5'\n  );\n}\n\n// Array de saída\nconst output = [];\n\n// Itera sobre cada cliente\nitems.forEach(item => {\n  const cliente = item.json;\n\n  const equipamentos = (cliente.equipamentos || []).map(equip => ({\n    tipo: equip.tipo,\n    fabricante: equip.fabricante,\n    modelo: equip.modelo,\n    serie: equip.serie\n  }));\n\n  output.push({\n    json: {\n      id: idUnico,\n      razao_social: cliente.razao_social,\n      fantasia: cliente.fantasia,\n      cnpj: formatarCNPJ(cliente.cnpj),\n      cidade: formatarCidade(cliente.cidade),\n      uf: cliente.uf,\n      telefone: cliente.telefone,\n      email: cliente.email,\n      responsavel: cliente.responsavel,\n      equipamentos\n    }\n  });\n});\n\nreturn output;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1904,
          -896
        ],
        "id": "22fa8e9b-7285-4eb7-8913-e86ddbdf4bff",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "=id:{{ $json.data.key.remoteJid }}"
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          1568,
          -320
        ],
        "id": "a1e5c5db-df5a-4b81-a7eb-7b8a98c51d67",
        "name": "Redis7",
        "credentials": {
          "redis": {
            "id": "zxoKZ2hHG1VotLrg",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "operation": "delete",
          "documentId": {
            "__rl": true,
            "value": "14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko",
            "mode": "list",
            "cachedResultName": "DBRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "dbRedis",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14URynmifd0PjFBEnLaLth_xdTY7cCXS6ApZ7j-veYko/edit#gid=0"
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1744,
          -320
        ],
        "id": "2c599dc6-775e-4620-b0c4-0d636f692488",
        "name": "Delete RemoteId3",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "Até logo👋. Para me chamar novamente, basta digitar *Magnetto*",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -320
        ],
        "id": "60a70d7e-169e-4d46-b5f6-484ae1dd28ff",
        "name": "Opcao8",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "teste",
          "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
          "messageText": "*Por favor, preencha o formulário abaixo para gerar a ordem de serviço:*\n\nhttps://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/form-autocomplete",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1376,
          -464
        ],
        "id": "ed7362a0-32ff-4d83-a42e-43a588a39513",
        "name": "Opcao7",
        "credentials": {
          "evolutionApi": {
            "id": "79qcaif6AQLNsa1x",
            "name": "Evolution account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// items é o array de entrada do nó Sheets\nconst outputMap = {};\n\n// Percorre cada item\nitems.forEach(item => {\n  const linha = item.json;\n  const id = linha['ID CLIENTE'];\n\n  // Se ainda não adicionamos esse ID, adicionamos\n  if (!outputMap[id]) {\n    outputMap[id] = linha;\n  }\n});\n\n// Converte o mapa para array no formato n8n\nconst output = Object.values(outputMap).map(linha => ({ json: linha }));\n\nreturn output;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2176,
          -144
        ],
        "id": "a5138d1d-3ba8-4c0f-a831-d479318f08e6",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
            "mode": "list",
            "cachedResultName": "OS_DB",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 824063472,
            "mode": "list",
            "cachedResultName": "DB_OS",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=824063472"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "OS NOME": "={{ $('Id e link').item.json.name }}",
              "OS LINK": "={{ $('Id e link').item.json.webViewLink }}",
              "DATA CADASTRO OS": "={{ $now.format('dd/LL/yyyy T') }}"
            },
            "matchingColumns": [
              "CNPJ"
            ],
            "schema": [
              {
                "id": "OS NOME",
                "displayName": "OS NOME",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "OS LINK",
                "displayName": "OS LINK",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "DATA CADASTRO OS",
                "displayName": "DATA CADASTRO OS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          4432,
          -992
        ],
        "id": "71426b1c-1215-4007-ad80-a3cfc07520a4",
        "name": "DB7",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $('dados1').item.json.email }}",
          "subject": "OS GERADA MEDICALSPIN",
          "emailType": "text",
          "message": "={{ $('Id e link').item.json.name }}\n{{ $('Id e link').item.json.webViewLink }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          3856,
          -992
        ],
        "id": "ad054b87-4338-4614-8ce1-bcf5cbf550a9",
        "name": "Send a message",
        "webhookId": "f2423354-0a17-4996-b6c3-7512ca3b739f",
        "credentials": {
          "gmailOAuth2": {
            "id": "KvJgpEKJ3c13wnGv",
            "name": "Gmail account"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $('dados2').item.json.email }}",
          "subject": "OS GERADA MEDICALSPIN",
          "emailType": "text",
          "message": "={{ $('Id e link1').item.json.name }}\n{{ $('Id e link1').item.json.webViewLink }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          6912,
          -1344
        ],
        "id": "b2822ee2-6949-479f-b380-85311e6473bc",
        "name": "Send a message1",
        "webhookId": "f2423354-0a17-4996-b6c3-7512ca3b739f",
        "credentials": {
          "gmailOAuth2": {
            "id": "KvJgpEKJ3c13wnGv",
            "name": "Gmail account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Pega todos os itens do nó \"dados\"\nconst dados = $('dados').all();\n\n// Retorna exatamente o que veio do nó \"dados\"\nreturn dados;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          6736,
          -1344
        ],
        "id": "0b67aa39-5482-4c45-a985-567e2df4edeb",
        "name": "dados2"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
            "mode": "list",
            "cachedResultName": "OS_DB",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1612720329,
            "mode": "list",
            "cachedResultName": "DB_equipamento",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=1612720329"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "ID CLIENTE": "={{ $('DB2').item.json[\"ID CLIENTE\"] }}",
              "TIPO EQUIPAMENTO": "={{ $('Code in JavaScript2').item.json.tipo }}",
              "FABRICANTE": "={{ $('Code in JavaScript2').item.json.fabricante }}",
              "MODELO": "={{ $('Code in JavaScript2').item.json.modelo }}",
              "SERIE": "={{ $('Code in JavaScript2').item.json.serie }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "ID CLIENTE",
                "displayName": "ID CLIENTE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "TIPO EQUIPAMENTO",
                "displayName": "TIPO EQUIPAMENTO",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "FABRICANTE",
                "displayName": "FABRICANTE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "MODELO",
                "displayName": "MODELO",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "SERIE",
                "displayName": "SERIE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2432,
          -896
        ],
        "id": "e545a129-c85c-43f6-a6e2-e88acb8d6648",
        "name": "Append row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1612720329&tqx=out:json&tq=SELECT%20*",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2400,
          -1472
        ],
        "id": "752bd811-74fa-455c-ad24-38fb16891990",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0",
            "mode": "list",
            "cachedResultName": "OS_DB",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 824063472,
            "mode": "list",
            "cachedResultName": "DB_OS",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/edit#gid=824063472"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "OS NOME": "={{ $('Id e link1').item.json.name }}",
              "OS LINK": "={{ $('Id e link1').item.json.webViewLink }}",
              "DATA CADASTRO OS": "={{ $now.format('dd/LL/yyyy T') }}"
            },
            "matchingColumns": [
              "CNPJ"
            ],
            "schema": [
              {
                "id": "OS NOME",
                "displayName": "OS NOME",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "OS LINK",
                "displayName": "OS LINK",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "DATA CADASTRO OS",
                "displayName": "DATA CADASTRO OS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          7456,
          -1344
        ],
        "id": "bfcd9b76-1150-4f02-b4ca-a02c5fbd5a83",
        "name": "DB10",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "2DSmp4SarxDNx6pV",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "html": "<html lang=\"pt-br\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>Gerador de OS Medical Spin</title>\n\n  <!-- CSS NOVO APLICADO -->\n  <style>\n    :root{\n      --bg:#f3f6fb;\n      --surface:#ffffff;\n      --muted:#6b7280;\n      --accent:#0b74ff;\n      --accent-600:#095fcc;\n      --danger:#dc2626;\n      --card-radius:12px;\n      --input-radius:8px;\n      --border:#e6e9ef;\n      --glass:rgba(11,116,255,0.06);\n      --shadow-1:0 6px 20px rgba(16,24,40,0.06);\n      --shadow-2:0 2px 8px rgba(16,24,40,0.04);\n      --font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial;\n      --max-width:980px;\n    }\n\n    *{box-sizing:border-box}\n    html,body{height:100%}\n    body{\n      margin:0;\n      font-family:var(--font-family);\n      background:linear-gradient(180deg,var(--bg),#eef4ff 120px);\n      color:#0f172a;\n      -webkit-font-smoothing:antialiased;\n      -moz-osx-font-smoothing:grayscale;\n      line-height:1.45;\n      padding:24px 12px;\n    }\n\n    .container{max-width:var(--max-width);margin:0 auto;}\n\n    .field-readonly {\n      background: #f1f3f5 !important;\n      color: #6b7280 !important;\n      border-color: #d1d5db !important;\n      cursor: not-allowed;\n    }\n    \n    .field-readonly:focus {\n      box-shadow: none !important;\n    }\n\n    /* Títulos */\n    h2 { margin-top:0; }\n\n    /* caixas e estrutura */\n    .section-title{font-size:15px;font-weight:700;color:#0f172a;margin-top:22px}\n    .section-sub{font-size:13px;color:var(--muted);margin-bottom:12px}\n\n    label{display:block;font-size:13px;margin-bottom:6px;color:#334155;font-weight:600}\n\n    /* =========================\n   AUTOCOMPLETE – SUGESTÕES\n========================= */\n\n#sugestoes {\n  position: relative;\n  margin-top: 6px;\n  margin-bottom: 16px;\n  border-radius: 10px;\n  border: 1px solid var(--border);\n  background: #ffffff;\n  box-shadow: 0 12px 30px rgba(16,24,40,0.12);\n  max-height: 320px;\n  overflow-y: auto;\n}\n\n/* categoria */\n#sugestoes .categoria {\n  font-size: 12px;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: .04em;\n  color: #64748b;\n  padding: 10px 12px;\n  background: #f8fafc;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n/* cliente */\n.item-cliente {\n  padding: 10px 12px;\n  border-bottom: 1px solid #eef2f7;\n}\n\n.item-cliente:last-child {\n  border-bottom: none;\n}\n\n.item-cliente > strong {\n  font-size: 14px;\n  color: #0f172a;\n}\n\n/* equipamentos */\n.item-equipamento {\n  margin-top: 6px;\n  margin-left: 8px;\n  padding: 8px 10px;\n  border-radius: 8px;\n  background: #f8fafc;\n  border: 1px solid #e5e7eb;\n  font-size: 13px;\n  color: #334155;\n\n  /* UX */\n  cursor: pointer;\n  transition: background .15s ease, border-color .15s ease, transform .05s ease;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n/* hover claro */\n.item-equipamento:hover {\n  background: #eef4ff;\n  border-color: var(--accent);\n  transform: translateX(2px);\n}\n\n/* clique */\n.item-equipamento:active {\n  transform: translateX(0);\n  background: #e0ecff;\n}\n\n/* ícone */\n.item-equipamento::before {\n  content: \"🖱️\";\n  font-size: 14px;\n}\n\n/* scrollbar discreta */\n#sugestoes::-webkit-scrollbar {\n  width: 8px;\n}\n\n#sugestoes::-webkit-scrollbar-thumb {\n  background: #d1d5db;\n  border-radius: 4px;\n}\n\n#sugestoes::-webkit-scrollbar-thumb:hover {\n  background: #9ca3af;\n}\n\n    .item-sugestao {\n      padding: 10px 12px;\n      cursor: pointer;\n      border-bottom: 1px solid #eef2f7;\n      font-size: 14px;\n    }\n    .item-sugestao:hover { background-color: #f3f6fb; }\n\n    .categoria {\n      font-weight: 700;\n      background: #f7f9ff;\n      padding: 8px 10px;\n      border-bottom: 1px solid #e1e6ef;\n      font-size: 13px;\n      color: var(--muted);\n    }\n\n    /* inputs */\n    input[type=text], input[type=tel], input[type=date], select, textarea {\n      width: 100%;\n      padding: 11px 12px;\n      border-radius: var(--input-radius);\n      border: 1px solid var(--border);\n      background: linear-gradient(180deg,#ffffff,#fbfdff);\n      font-size: 14px;\n      color: #0f172a;\n      transition: box-shadow .16s ease,border-color .16s ease,transform .04s ease;\n      outline: none;\n    }\n    textarea{min-height:96px;resize:vertical}\n\n    input:focus, select:focus, textarea:focus {\n      border-color: var(--accent);\n      box-shadow: 0 8px 30px rgba(11,116,255,0.08), 0 0 0 4px var(--glass);\n    }\n\n    /* grid */\n    .grid{display:grid;gap:12px}\n    .cols-2{grid-template-columns:1fr 1fr}\n    .cols-3{grid-template-columns:repeat(3,1fr)}\n    @media (max-width:780px){.cols-3{grid-template-columns:1fr}}\n    @media (max-width:600px){.cols-2{grid-template-columns:1fr}}\n\n    /* repeat lists */\n    .repeat-list{\n      border-radius:10px;padding:10px;border:1px dashed var(--border);background:#fbfdff\n    }\n\n    .repeat-item{\n      padding:12px;\n      border-radius:10px;\n      background:linear-gradient(180deg,#fff,#fbfdff);\n      border:1px solid #eef2f7;\n      box-shadow:var(--shadow-2);\n      margin-bottom:10px;\n      display:grid;gap:8px\n    }\n\n    .required{color:var(--danger);font-weight:800;margin-left:6px}\n\n    /* ações */\n    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:20px}\n\n    button{\n      border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;\n      background:var(--accent);color:#fff;\n      box-shadow:0 6px 18px rgba(11,116,255,0.12);\n      transition:transform .12s ease, box-shadow .12s ease, background .12s;\n    }\n    button:hover{transform:translateY(-2px)}\n    button:active{transform:translateY(0)}\n\n    .btn-ghost{\n      background:transparent;color:var(--accent);\n      border:1px solid rgba(11,116,255,0.18);\n      box-shadow:none\n    }\n    .btn-ghost:hover{background:rgba(11,116,255,0.04)}\n\n    /* small tweaks for suggestion box appended to body */\n    #suggestionBox { position: absolute; background: #fff; border: 1px solid #ccc; border-radius:6px; box-shadow: var(--shadow-2); z-index: 10000; }\n  </style>\n</head>\n\n<body>\n\n<form id=\"osForm\"><!-- necessário para FormData funcionar -->\n  <div class=\"container\">\n    <h2>Gerador de OS V1.0.0</h2>\n    <p>Digite para buscar em todos os campos da base e receber sugestões detalhadas.</p>\n    <p>Não encontrou a sugestão do cliente?  \n    <a href=\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente\" target=\"_blank\" rel=\"noopener noreferrer\">\n        Cadastre o cliente clicando aqui\n    </a>\n    </p>\n\n    <label>Buscar cliente</label>\n    <input type=\"text\" id=\"busca\" placeholder=\"Digite algo...\" autocomplete=\"off\" />\n\n    <div id=\"sugestoes\"></div>\n\n    <div>\n      <div class=\"section-title\">1 — Dados da Empresa</div>\n      <div class=\"section-sub\">Informações básicas do cliente</div>\n    </div>\n\n    <!-- CAMPOS AUTOMÁTICOS (READONLY) -->\n    <label class=\"label\">Razão Social</label>\n    <input type=\"text\" id=\"razao_social\" name=\"razao_social\" readonly class=\"field-readonly\" class=\"field-readonly class=\"field-readonly\"\"/>\n\n    <label class=\"label\">Nome Fantasia</label>\n    <input type=\"text\" id=\"nome_fantasia\" name=\"nome_fantasia\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">CNPJ</label>\n    <input type=\"text\" id=\"cnpj\" name=\"cnpj\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Cidade</label>\n    <input type=\"text\" id=\"cidade\" name=\"cidade\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">UF</label>\n    <input type=\"text\" id=\"uf\" name=\"uf\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Telefone</label>\n    <input type=\"text\" id=\"telefone\" name=\"telefone\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Email</label>\n    <input type=\"text\" id=\"email\" name=\"email\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Responsável</label>\n    <input type=\"text\" id=\"responsavel\" name=\"responsavel\" readonly class=\"field-readonly\" />\n\n    <div>\n      <div class=\"section-title\">2 — Dados do Equipamento</div>\n      <div class=\"section-sub\">Identificação do equipamento</div>\n    </div>\n\n    <label class=\"label\">Tipo de Equipamento</label>\n    <input type=\"text\" id=\"tipo_equipamento\" name=\"tipo_equipamento\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Fabricante</label>\n    <input type=\"text\" id=\"fabricante\" name=\"fabricante\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Modelo</label>\n    <input type=\"text\" id=\"modelo\" name=\"modelo\" readonly class=\"field-readonly\" />\n\n    <label class=\"label\">Número de Série</label>\n    <input type=\"text\" id=\"serie\" name=\"serie\" readonly class=\"field-readonly\" />\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">3 — Motivo e Eventos</div>\n    </div>\n\n    <label>\n      Motivação do Serviço <span class=\"required\">*</span>\n    </label>\n    <textarea id=\"motivacao\" name=\"motivacao\" class=\"field\" required></textarea>\n\n    <div style=\"margin-top:10px\">\n      <label>Eventos Relevantes</label>\n      <textarea id=\"eventos\" name=\"eventos\" class=\"field\"></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">4 — Tipo de Intervenção</div>\n    </div>\n\n    <label>Tipo</label>\n    <select id=\"tipo_intervencao\" name=\"tipo_intervencao\" class=\"field\" required>\n      <option>Manutenção Corretiva</option>\n      <option>Manutenção Preventiva</option>\n      <option>Visita Técnica</option>\n      <option>Outro</option>\n    </select>\n\n    <div style=\"margin-top:10px\">\n      <label>Descrição dos Serviços Realizados</label>\n      <textarea id=\"descricao_servicos\" name=\"descricao_servicos\" class=\"field\" required></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div>\n        <div class=\"section-title\">5 — Peças</div>\n        <div class=\"section-sub\">Registre peças por categoria</div>\n      </div>\n    </div>\n\n    <div style=\"margin-bottom:8px\">\n      <div style=\"font-weight:700;margin-bottom:6px\">Partes removidas — Posse do cliente</div>\n\n      <div id=\"pecas_cliente\" class=\"repeat-list\"></div>\n\n      <div style=\"margin-top:8px\">\n        <button type=\"button\" class=\"btn-ghost\" onclick=\"addPeca('cliente')\">+ Adicionar</button>\n      </div>\n    </div>\n\n    <div style=\"margin-top:12px;margin-bottom:8px\">\n      <div style=\"font-weight:700;margin-bottom:6px\">Partes removidas — Posse da Medical Spin</div>\n\n      <div id=\"pecas_ms\" class=\"repeat-list\"></div>\n\n      <div style=\"margin-top:8px\">\n        <button type=\"button\" class=\"btn-ghost\" onclick=\"addPeca('ms')\">+ Adicionar</button>\n      </div>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">6 — Mão de Obra</div>\n    </div>\n\n    <div id=\"horas_list\" class=\"repeat-list\" required></div>\n\n    <div style=\"margin-top:8px\">\n      <button type=\"button\" class=\"btn-ghost\" onclick=\"addHoras()\">+ Adicionar dia</button>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">7 — Pendências</div>\n    </div>\n\n    <label>Pendências da Medical Spin</label>\n    <textarea id=\"pendencias_ms\" name=\"pendencias_ms\" class=\"field\"></textarea>\n\n    <div style=\"margin-top:10px\">\n      <label>Pendências do Cliente</label>\n      <textarea id=\"pendencias_cliente\" name=\"pendencias_cliente\" class=\"field\"></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">8 — Estado do Equipamento</div>\n    </div>\n\n    <div class=\"grid cols-2\">\n      <div>\n        <label>Estado Inicial</label>\n        <select id=\"estado_inicial\" name=\"estado_inicial\" class=\"field\">\n          <option>Funcional</option>\n          <option>Parcialmente Funcional</option>\n          <option>Inoperante</option>\n        </select>\n      </div>\n\n      <div>\n        <label>Estado Final</label>\n        <select id=\"estado_final\" name=\"estado_final\" class=\"field\" onchange=\"onEstadoFinalChange()\">\n          <option>Funcional</option>\n          <option>Parcialmente Funcional</option>\n          <option>Inoperante</option>\n        </select>\n      </div>\n    </div>\n\n    <div id=\"motivo_restricao\" style=\"display:none;margin-top:10px\">\n      <label>Motivo da Restrição</label>\n      <textarea id=\"motivo_restricao_text\" class=\"field\"></textarea>\n    </div>\n\n    <div id=\"motivo_inoperante\" style=\"display:none;margin-top:10px\">\n      <label>Motivo da Inoperância</label>\n      <textarea id=\"motivo_inoperante_text\" class=\"field\"></textarea>\n    </div>\n\n    <div class=\"section-header\">\n      <div class=\"section-title\">9 — Local e Assinaturas</div>\n    </div>\n\n    <div class=\"grid cols-2\">\n      <div>\n        <label class=\"label\">Cidade</label>\n        <input type=\"text\" id=\"cidade_assinatura\" name=\"cidade_assinatura\" readonly class=\"field-readonly\" />\n      </div>\n\n      <div>\n        <label class=\"label\">UF</label>\n        <input type=\"text\" id=\"uf_assinatura\" name=\"uf_assinatura\" readonly class=\"field-readonly\" />\n      </div>\n    </div>\n\n    <div style=\"margin-top:10px\" class=\"grid cols-2\">\n      <div>\n        <label>Nome do Engenheiro</label>\n        <input id=\"nome_tecnico\" name=\"nome_tecnico\" class=\"field\" type=\"text\"\n               value=\"JULIO CESAR RODRIGUES\" />\n      </div>\n\n      <div>\n        <label>CFT do Engenheiro</label>\n        <input id=\"cft_tecnico\" name=\"cft_tecnico\" class=\"field compact\" type=\"text\"\n               value=\"2000103820\" />\n      </div>\n    </div>\n\n    <div style=\"margin-top:10px\" class=\"grid cols-2\">\n      <div>\n        <label class=\"label\">Nome do Recebedor</label>\n        <input type=\"text\" id=\"responsavel_assinatura\" name=\"responsavel_assinatura\" readonly class=\"field-readonly\" />\n      </div>\n    </div>\n\n    <section class=\"section\">\n      <div class=\"section-header\">\n        <div class=\"section-title\">Envio de Mídias</div>\n      </div>\n\n      <input type=\"file\" id=\"midias\" name=\"midias\" multiple\n             accept=\"image/*,video/*,.pdf,.doc,.docx,.xlsx,.zip\" />\n    </section>\n\n    <!-- actions -->\n    <div class=\"actions\" style=\"margin-top:6px\">\n      <button type=\"button\" onclick=\"sendToWebhook(event)\">Gerar OS</button>\n      <button type=\"button\" class=\"btn-ghost\" onclick=\"resetForm()\">Limpar</button>\n    </div>\n\n  </div> <!-- /container -->\n\n</form> <!-- /osForm -->\n\n<!-- resultado (fora do form) -->\n<div id=\"result\" style=\"display:none\">\n  <div class=\"card\" style=\"margin-top:14px\">\n    <h3 style=\"margin:0 0 10px 0\">Saída (JSON)</h3>\n    <pre id=\"jsonOut\" style=\"white-space:pre-wrap;max-height:360px;overflow:auto\"></pre>\n  </div>\n</div>\n\n<!-- campos \"auxiliares\" necessários para compatibilidade com seus scripts -->\n<!-- não visíveis para o usuário \n<input type=\"hidden\" id=\"cidade\" />\n<input type=\"hidden\" id=\"uf\" />\n<input type=\"hidden\" id=\"responsavel\" />-->\n\n<script>\n  const input = document.getElementById(\"busca\");\n  const boxSugestoes = document.getElementById(\"sugestoes\");\n\n  const campos = {\n    razao_social: document.getElementById(\"razao_social\"),\n    nome_fantasia: document.getElementById(\"nome_fantasia\"),\n    cnpj: document.getElementById(\"cnpj\"),\n    cidade: document.getElementById(\"cidade\"),\n    uf: document.getElementById(\"uf\"),\n    telefone: document.getElementById(\"telefone\"),\n    email: document.getElementById(\"email\"),\n    responsavel: document.getElementById(\"responsavel\"),\n\n    // seção 9\n    cidade_assinatura: document.getElementById(\"cidade_assinatura\"),\n    uf_assinatura: document.getElementById(\"uf_assinatura\"),\n    responsavel_assinatura: document.getElementById(\"responsavel_assinatura\"),\n\n    tipo_equipamento: document.getElementById(\"tipo_equipamento\"),\n    fabricante: document.getElementById(\"fabricante\"),\n    modelo: document.getElementById(\"modelo\"),\n    serie: document.getElementById(\"serie\")\n  };\n\n  input.addEventListener(\"input\", async (e) => {\n    const termo = e.target.value.trim().toLowerCase();\n\n    if (termo.length < 2) {\n      boxSugestoes.innerHTML = \"\";\n      return;\n    }\n\n    try {\n      const res = await fetch(\n        \"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/autocomplete-busca\",\n        {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ termo })\n        }\n      );\n\n      const data = await res.json();\n      const listaBruta = data.resultados || [];\n\nconst lista = listaBruta\n  .map(cliente => {\n    const termoMatchCliente =\n      `${cliente.razao_social} ${cliente.nome_fantasia} ${cliente.cnpj}`\n        .toLowerCase()\n        .includes(termo);\n\n    const equipamentosFiltrados = (cliente.equipamentos || []).filter(eq =>\n      `${eq.tipo_equipamento} ${eq.fabricante} ${eq.modelo} ${eq.serie}`\n        .toLowerCase()\n        .includes(termo)\n    );\n\n    // só retorna cliente se ele ou algum equipamento casar\n    if (!termoMatchCliente && equipamentosFiltrados.length === 0) {\n      return null;\n    }\n\n    return {\n      ...cliente,\n      equipamentos: equipamentosFiltrados.length\n        ? equipamentosFiltrados\n        : cliente.equipamentos\n    };\n  })\n  .filter(Boolean);\n\n\n      if (!lista.length) {\n  boxSugestoes.innerHTML = `\n    <div class=\"item-sugestao\" style=\"cursor:default\">\n      <strong>Nenhum cliente encontrado</strong><br>\n      <small>\n        Não encontrou o cliente?\n        <a href=\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/cadastra-cliente\"\n           target=\"_blank\" rel=\"noopener noreferrer\"\n           style=\"color:#0b74ff;font-weight:700\">\n          Clique aqui para cadastrar\n        </a>\n      </small>\n    </div>\n  `;\n  return;\n}\n\n      let html = `<div class=\"categoria\">Clientes encontrados</div>`;\n\n      lista.forEach(cliente => {\n        html += `\n          <div class=\"item-cliente\">\n            <strong>${cliente.razao_social}</strong><br>\n            <small>${cliente.cnpj} — ${cliente.cidade}/${cliente.uf}</small>\n        `;\n\n        (cliente.equipamentos || []).forEach(eq => {\n          html += `\n            <div class=\"item-equipamento\"\n              data-cliente='${JSON.stringify(cliente)}'\n              data-equipamento='${JSON.stringify(eq)}'>\n              🔧 ${eq.tipo_equipamento} — ${eq.fabricante} ${eq.modelo} (${eq.serie})\n            </div>\n          `;\n        });\n\n        html += `</div>`;\n      });\n\n      boxSugestoes.innerHTML = html;\n\n      document.querySelectorAll(\".item-equipamento\").forEach(el => {\n        el.onclick = () => {\n          const cliente = JSON.parse(el.dataset.cliente);\n          const eq = JSON.parse(el.dataset.equipamento);\n\n          input.value = cliente.razao_social || \"\";\n\n          campos.razao_social.value = cliente.razao_social || \"\";\n          campos.nome_fantasia.value = cliente.nome_fantasia || \"\";\n          campos.cnpj.value = cliente.cnpj || \"\";\n          campos.cidade.value = cliente.cidade || \"\";\n          campos.uf.value = cliente.uf || \"\";\n          campos.telefone.value = cliente.telefone || \"\";\n          campos.email.value = cliente.email || \"\";\n          campos.responsavel.value = cliente.responsavel || \"\";\n\n          // seção 9\n          campos.cidade_assinatura.value = cliente.cidade || \"\";\n          campos.uf_assinatura.value = cliente.uf || \"\";\n          campos.responsavel_assinatura.value = cliente.responsavel || \"\";\n\n          campos.tipo_equipamento.value = eq.tipo_equipamento || \"\";\n          campos.fabricante.value = eq.fabricante || \"\";\n          campos.modelo.value = eq.modelo || \"\";\n          campos.serie.value = eq.serie || \"\";\n\n          // compatibilidade com outros scripts\n          ///const cidadeEmp = document.getElementById(\"cidade_empresa\");\n          //const ufEmp = document.getElementById(\"uf_empresa\");\n          //const recebedor = document.getElementById(\"recebedor\");\n\n          //if (cidadeEmp) cidadeEmp.value = cliente.cidade || \"\";\n         // if (ufEmp) ufEmp.value = cliente.uf || \"\";\n          //if (recebedor) recebedor.value = cliente.responsavel || \"\";\n\n          boxSugestoes.innerHTML = \"\";\n        };\n      });\n\n    } catch (err) {\n      console.error(\"Erro no autocomplete:\", err);\n    }\n  });\n</script>\n\n<script>\n  /* same JS logic from your original file, unchanged. Keep the dynamic pieces below */\n\n  function addPeca(tipo) {\n    const mapa = {\n      cliente: \"pecas_cliente\",\n      ms: \"pecas_ms\",\n      reparadas: \"pecas_reparadas\",\n      inseridas: \"pecas_inseridas\"\n    };\n\n    const container = document.getElementById(mapa[tipo]);\n    const item = document.createElement(\"div\");\n    item.className = \"repeat-item\";\n\n    item.innerHTML = `\n      <label>Nome da peça</label>\n      <input class=\"peca_nome\" type=\"text\">\n\n      <label>Modelo / Ref</label>\n      <input class=\"peca_modelo\" type=\"text\">\n\n      <label>Nº de Série</label>\n      <input class=\"peca_sn\" type=\"text\">\n\n      <label>Observações</label>\n      <input class=\"peca_destino\" type=\"text\">\n\n      <div style=\"display:flex;gap:8px;justify-content:flex-end\">\n        <button type=\"button\" class=\"btn-ghost\"\n          style=\"background:transparent;color:#ef4444;border:1px solid rgba(239,68,68,0.06);\">\n          Remover\n        </button>\n      </div>\n    `;\n\n    item.querySelector(\"button\").onclick = () => container.removeChild(item);\n    container.appendChild(item);\n  }\n\n  function addHoras() {\n    const c = document.getElementById(\"horas_list\");\n    const item = document.createElement(\"div\");\n    item.className = \"repeat-item\";\n\n    item.innerHTML = `\n      <div class=\"grid cols-3\">\n        <div>\n          <label>Data</label>\n          <input class=\"hh_data\" type=\"date\">\n        </div>\n\n        <div>\n          <label>HH efetivo</label>\n          <input class=\"hh_efetivo\" type=\"text\">\n        </div>\n\n        <div>\n          <label>HH contingencial</label>\n          <input class=\"hh_contingencial\" type=\"text\">\n        </div>\n      </div>\n\n      <div style=\"display:flex;justify-content:flex-end;margin-top:6px\">\n        <button type=\"button\" class=\"btn-ghost\"\n          style=\"background:transparent;color:#ef4444;border:1px solid rgba(239,68,68,0.06);\">\n          Remover\n        </button>\n      </div>\n    `;\n\n    item.querySelector(\"button\").onclick = () => c.removeChild(item);\n    c.appendChild(item);\n  }\n\n  function onEstadoFinalChange() {\n    const v = document.getElementById(\"estado_final\").value;\n\n    document.getElementById(\"motivo_restricao\").style.display =\n      v === \"Parcialmente Funcional\" ? \"block\" : \"none\";\n\n    document.getElementById(\"motivo_inoperante\").style.display =\n      v === \"Inoperante\" ? \"block\" : \"none\";\n  }\n\n  function gatherForm() {\n    const data = {};\n    const f = new FormData(document.getElementById(\"osForm\"));\n\n    for (const [k, v] of f.entries()) {\n      if (k !== \"midias\") data[k] = v;\n    }\n\n    data[\"pecas_cliente\"] = coletaPecas(\"pecas_cliente\");\n    data[\"pecas_ms\"] = coletaPecas(\"pecas_ms\");\n    data[\"mao_de_obra\"] = coletaHoras();\n\n    data[\"motivo_restricao\"] =\n      document.getElementById(\"motivo_restricao_text\").value || \"\";\n    data[\"motivo_inoperante\"] =\n      document.getElementById(\"motivo_inoperante_text\").value || \"\";\n\n    return data;\n  }\n\n  function coletaPecas(id) {\n    const out = [];\n\n    document.querySelectorAll(`#${id} .repeat-item`).forEach(it => {\n      out.push({\n        nome: it.querySelector(\".peca_nome\").value,\n        modelo: it.querySelector(\".peca_modelo\").value,\n        sn: it.querySelector(\".peca_sn\").value,\n        detalhes: it.querySelector(\".peca_destino\").value\n      });\n    });\n\n    return out;\n  }\n\n  function coletaHoras() {\n    const out = [];\n\n    document.querySelectorAll(\"#horas_list .repeat-item\").forEach(it => {\n      out.push({\n        data: it.querySelector(\".hh_data\").value,\n        hh_efetivo: it.querySelector(\".hh_efetivo\").value,\n        hh_contingencial: it.querySelector(\".hh_contingencial\").value\n      });\n    });\n\n    return out;\n  }\n\n  function filesToBase64(fileList) {\n    const promises = [];\n\n    for (let i = 0; i < fileList.length; i++) {\n      const file = fileList[i];\n\n      promises.push(\n        new Promise((resolve, reject) => {\n          const reader = new FileReader();\n\n          reader.onerror = () => reject(\"Erro ao ler arquivo\");\n\n          reader.onload = () => {\n            const base64 = reader.result.split(\",\")[1];\n\n            resolve({\n              nome: file.name,\n              tipo: file.type,\n              tamanho: file.size,\n              base64\n            });\n          };\n\n          reader.readAsDataURL(file);\n        })\n      );\n    }\n\n    return Promise.all(promises);\n  }\n\n  function generateJSON(formElement) {\n  const formData = new FormData(formElement);\n\n  // coleta campos normais\n  const payload = {};\n  for (const [key, value] of formData.entries()) {\n    payload[key] = value || \"N/A\";\n  }\n\n  // coleta peças\n  payload.pecas_cliente = coletaPecas(\"pecas_cliente\");\n  payload.pecas_ms = coletaPecas(\"pecas_ms\");\n\n  // coleta horas\n  payload.mao_de_obra = coletaHoras();\n\n  return payload;\n}\n\n\n  function resetForm() {\n    document.getElementById(\"osForm\").reset();\n\n    // remove dynamic repeat items\n    [\"pecas_cliente\", \"pecas_ms\", \"pecas_reparadas\", \"pecas_inseridas\", \"horas_list\"]\n      .forEach(id => {\n        const c = document.getElementById(id);\n        if (c) c.innerHTML = \"\";\n      });\n\n    document.getElementById(\"result\").style.display = \"none\";\n  }\n\n  async function sendToWebhook(event) {\n  event.preventDefault();\n\n  const form = document.getElementById(\"osForm\");\n\n  // coleta campos normais\n  const jsonPayload = generateJSON(form);\n\n  // coleta arquivos\n  const inputMidias = document.getElementById(\"midias\");\n  const arquivos = inputMidias.files;\n\n  let midiasBase64 = [];\n\n  if (arquivos && arquivos.length > 0) {\n    midiasBase64 = await filesToBase64(arquivos);\n  }\n\n  // adiciona ao JSON final\n  jsonPayload.midias = midiasBase64;\n\n  // envia tudo em um único JSON\n  await fetch(\"https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/recebe-dados-os\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(jsonPayload)\n  });\n\n  alert(\"Dados enviados com sucesso!\");\n}\n\n</script>\n\n<script>\n  // Adaptado para usar #razao ou, se não existir, #busca (compatibilidade).\n  const inputRazao = document.getElementById(\"razao\") || document.getElementById(\"busca\");\n  let timeout = null;\n\n  if (inputRazao) {\n    inputRazao.addEventListener(\"input\", function () {\n      const q = this.value.trim();\n      if (q.length < 2) return;\n\n      clearTimeout(timeout);\n\n      timeout = setTimeout(() => {\n        fetch(\n          `https://n8n-www4kggggc4c8k8ow4w8g4g0.95.217.164.173.sslip.io/webhook/auto-complete?q=${encodeURIComponent(\n            q\n          )}`\n        )\n          .then(r => r.json())\n          .then(data => showSuggestions(data.suggestions))\n          .catch(err => console.error(err));\n      }, 250);\n    });\n  }\n\n  function showSuggestions(list) {\n    removeSuggestionBox();\n\n    const box = document.createElement(\"div\");\n    box.id = \"suggestionBox\";\n    box.style.position = \"absolute\";\n    box.style.background = \"#fff\";\n    box.style.border = \"1px solid #ccc\";\n    box.style.width = (inputRazao && inputRazao.offsetWidth) ? inputRazao.offsetWidth + \"px\" : \"300px\";\n    box.style.zIndex = 1000;\n\n    list.forEach(item => {\n      const opt = document.createElement(\"div\");\n      opt.textContent = `${item.razao} (${item.cnpj || \"\"})`;\n      opt.style.padding = \"8px\";\n      opt.style.cursor = \"pointer\";\n\n      opt.onclick = () => {\n        // Preenchimento rápido baseado no payload dessa autocomplete (padrão)\n        //if (inputRazao) inputRazao.value = item.razao || \"\";\n        //const elCnpj = document.getElementById(\"cnpj\");\n        //if (elCnpj) elCnpj.value = item.cnpj || \"\";\n        //const elCidade = document.getElementById(\"cidade\");\n        //if (elCidade) elCidade.value = item.cidade || \"\";\n        //const elUf = document.getElementById(\"uf_empresa\");\n        //if (elUf) elUf.value = item.uf || \"\";\n        //const elSolic = document.getElementById(\"recebedor\");\n        //if (elSolic) elSolic.value = item.responsavel || \"\";\n\n        removeSuggestionBox();\n      };\n\n      box.appendChild(opt);\n    });\n\n    // append near the input if possible, otherwise to body\n    if (inputRazao && inputRazao.parentNode) {\n      inputRazao.parentNode.appendChild(box);\n    } else {\n      document.body.appendChild(box);\n    }\n  }\n\n  function removeSuggestionBox() {\n    const old = document.getElementById(\"suggestionBox\");\n    if (old) old.remove();\n  }\n\n  document.addEventListener(\"click\", e => {\n    if (e.target.id !== \"suggestionBox\") removeSuggestionBox();\n  });\n</script>\n\n\n</body>\n</html>"
        },
        "id": "2b0ebecb-0544-4c22-9f7e-207103cd3825",
        "name": "HTML6",
        "type": "n8n-nodes-base.html",
        "typeVersion": 1.2,
        "position": [
          1744,
          -1472
        ]
      },
      {
        "parameters": {
          "jsCode": "// ===== Função de parse =====\nfunction parseSheet(rawData, origem) {\n  const jsonString = rawData\n    .replace('/*O_o*/\\ngoogle.visualization.Query.setResponse(', '')\n    .replace(/\\);$/, '');\n\n  const parsed = JSON.parse(jsonString);\n  const rows = parsed.table.rows || [];\n\n  return rows.map(r => {\n    const c = r.c;\n\n    if (origem === 'A') {\n      return {\n        id_cliente: c[0]?.v || \"\",\n        razao_social: c[1]?.v || \"\",\n        nome_fantasia: c[2]?.v || \"\",\n        cnpj: c[3]?.v || \"\",\n        cidade: c[4]?.v || \"\",\n        uf: c[5]?.v || \"\",\n        telefone: c[6]?.v || \"\",\n        email: c[7]?.v || \"\",\n        responsavel: c[8]?.v || \"\",\n        os_nome: c[9]?.v || \"\",\n        os_link: c[10]?.v || \"\"\n      };\n    }\n\n    return {\n      id_cliente: c[0]?.v || \"\",\n      tipo_equipamento: c[1]?.v || \"\",\n      fabricante: c[2]?.v || \"\",\n      modelo: c[3]?.v || \"\",\n      serie: c[4]?.v || \"\",\n      tipo_intervencao: c[5]?.v || \"\",\n      estado_inicial: c[6]?.v || \"\",\n      estado_final: c[7]?.v || \"\"\n    };\n  });\n}\n\n// ===== Dados =====\nconst dataA = $('HTTP Request3').first().json.data;\nconst dataB = $input.first().json.data;\n\n// ===== Parse =====\nconst clientes = parseSheet(dataA, 'A');\nconst equipamentos = parseSheet(dataB, 'B');\n\n// ===== Agrupa equipamentos por id_cliente =====\nconst equipamentosPorCliente = {};\n\nfor (const eq of equipamentos) {\n  if (!eq.id_cliente) continue;\n\n  if (!equipamentosPorCliente[eq.id_cliente]) {\n    equipamentosPorCliente[eq.id_cliente] = [];\n  }\n\n  equipamentosPorCliente[eq.id_cliente].push({\n    tipo_equipamento: eq.tipo_equipamento,\n    fabricante: eq.fabricante,\n    modelo: eq.modelo,\n    serie: eq.serie,\n    tipo_intervencao: eq.tipo_intervencao,\n    estado_inicial: eq.estado_inicial,\n    estado_final: eq.estado_final\n  });\n}\n\n// ===== Merge final =====\nconst resultados = clientes.map(cliente => ({\n  id_cliente: cliente.id_cliente,\n\n  razao_social: cliente.razao_social,\n  nome_fantasia: cliente.nome_fantasia,\n  cnpj: cliente.cnpj,\n  cidade: cliente.cidade,\n  uf: cliente.uf,\n  telefone: cliente.telefone,\n  email: cliente.email,\n  responsavel: cliente.responsavel,\n\n  os_nome: cliente.os_nome,\n  os_link: cliente.os_link,\n\n  equipamentos: equipamentosPorCliente[cliente.id_cliente] || []\n}));\n\n// ===== Retorno =====\nreturn [\n  {\n    json: {\n      resultados\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2576,
          -1472
        ],
        "id": "2372f0de-82ce-4cc1-a1e4-7dd661b20a0d",
        "name": "Code in JavaScript4"
      },
      {
        "parameters": {
          "jsCode": "const equipamentos = $('Code in JavaScript').first().json.equipamentos || [];\nreturn equipamentos.map(equipamento => ({\n  json: {\n    tipo: equipamento.tipo,\n    fabricante: equipamento.fabricante,\n    modelo: equipamento.modelo,\n    serie: equipamento.serie\n  }\n}));"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          -896
        ],
        "id": "4f053f70-da26-4d31-b8f7-97e45a4aeb7e",
        "name": "Code in JavaScript2"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "autocomplete-edit-cliente",
          "responseMode": "responseNode",
          "options": {
            "allowedOrigins": "*",
            "responseHeaders": {
              "entries": [
                {
                  "name": "=Access-Control-Allow-Methods",
                  "value": "*"
                },
                {
                  "name": "=Access-Control-Allow-Methods",
                  "value": "=GET, POST, OPTIONS"
                }
              ]
            }
          }
        },
        "id": "75212cd4-5467-4cad-8c12-972cc84d5b31",
        "name": "Busca no Sheets1",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          3440,
          -576
        ],
        "webhookId": "autocomplete-busca-001"
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "23ccf63b-da60-4c9d-a843-aa89016f80b7",
        "name": "Retorna sugestões1",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          4128,
          -576
        ]
      },
      {
        "parameters": {
          "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1955323770&tqx=out:json&tq=SELECT%20*",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3600,
          -576
        ],
        "id": "424356a6-5f26-40bc-9f99-9e4aa1883c02",
        "name": "HTTP Request4"
      },
      {
        "parameters": {
          "url": "https://docs.google.com/spreadsheets/d/1mZ4GlKIZieM_yz-CBjwNk4_8K62w45ez4BDTe-4e1e0/gviz/tq?gid=1612720329&tqx=out:json&tq=SELECT%20*",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3776,
          -576
        ],
        "id": "9267691a-0cb9-4613-8c04-cfcd74f83484",
        "name": "HTTP Request1"
      },
      {
        "parameters": {
          "jsCode": "// ===== Função de parse =====\nfunction parseSheet(rawData, origem) {\n  const jsonString = rawData\n    .replace('/*O_o*/\\ngoogle.visualization.Query.setResponse(', '')\n    .replace(/\\);$/, '');\n\n  const parsed = JSON.parse(jsonString);\n  const rows = parsed.table.rows || [];\n\n  return rows.map(r => {\n    const c = r.c;\n\n    if (origem === 'A') {\n      return {\n        id_cliente: c[0]?.v || \"\",\n        razao_social: c[1]?.v || \"\",\n        nome_fantasia: c[2]?.v || \"\",\n        cnpj: c[3]?.v || \"\",\n        cidade: c[4]?.v || \"\",\n        uf: c[5]?.v || \"\",\n        telefone: c[6]?.v || \"\",\n        email: c[7]?.v || \"\",\n        responsavel: c[8]?.v || \"\",\n        os_nome: c[9]?.v || \"\",\n        os_link: c[10]?.v || \"\"\n      };\n    }\n\n    return {\n      id_cliente: c[0]?.v || \"\",\n      tipo_equipamento: c[1]?.v || \"\",\n      fabricante: c[2]?.v || \"\",\n      modelo: c[3]?.v || \"\",\n      serie: c[4]?.v || \"\",\n      tipo_intervencao: c[5]?.v || \"\",\n      estado_inicial: c[6]?.v || \"\",\n      estado_final: c[7]?.v || \"\"\n    };\n  });\n}\n\n// ===== Dados =====\nconst dataA = $('HTTP Request4').first().json.data;\nconst dataB = $input.first().json.data;\n\n// ===== Parse =====\nconst clientes = parseSheet(dataA, 'A');\nconst equipamentos = parseSheet(dataB, 'B');\n\n// ===== Agrupa equipamentos por id_cliente =====\nconst equipamentosPorCliente = {};\n\nfor (const eq of equipamentos) {\n  if (!eq.id_cliente) continue;\n\n  if (!equipamentosPorCliente[eq.id_cliente]) {\n    equipamentosPorCliente[eq.id_cliente] = [];\n  }\n\n  equipamentosPorCliente[eq.id_cliente].push({\n    tipo_equipamento: eq.tipo_equipamento,\n    fabricante: eq.fabricante,\n    modelo: eq.modelo,\n    serie: eq.serie,\n    tipo_intervencao: eq.tipo_intervencao,\n    estado_inicial: eq.estado_inicial,\n    estado_final: eq.estado_final\n  });\n}\n\n// ===== Merge final =====\nconst resultados = clientes.map(cliente => ({\n  id_cliente: cliente.id_cliente,\n\n  razao_social: cliente.razao_social,\n  nome_fantasia: cliente.nome_fantasia,\n  cnpj: cliente.cnpj,\n  cidade: cliente.cidade,\n  uf: cliente.uf,\n  telefone: cliente.telefone,\n  email: cliente.email,\n  responsavel: cliente.responsavel,\n\n  os_nome: cliente.os_nome,\n  os_link: cliente.os_link,\n\n  equipamentos: equipamentosPorCliente[cliente.id_cliente] || []\n}));\n\n// ===== Retorno =====\nreturn [\n  {\n    json: {\n      resultados\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3952,
          -576
        ],
        "id": "662cfe8f-4aae-4708-ae83-d1a1b7f6928d",
        "name": "Code in JavaScript5"
      }
    ],
    "connections": {
      "Webhook2": {
        "main": [
          [
            {
              "node": "dados",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Opcao1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Opcao2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Opcao3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Opcao4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Opcao5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Opcao6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Opcao7",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Opcao8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "InputOS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis1": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Menu",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Redis1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload file": {
        "main": [
          [
            {
              "node": "Id e link1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download file": {
        "main": [
          [
            {
              "node": "Upload file",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Soma horas": {
        "main": [
          [
            {
              "node": "Pega o documento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Junta itens": {
        "main": [
          [
            {
              "node": "Soma horas",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Junta itens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pega o documento1": {
        "main": [
          [
            {
              "node": "Placeholder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Nome da imagem": {
        "main": [
          [
            {
              "node": "Procura imagens",
              "type": "main",
              "index": 0
            },
            {
              "node": "Imagens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Index": {
        "main": [
          [
            {
              "node": "Atualiza documento1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Unir tudo",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Cola imagem no documento": {
        "main": [
          [
            {
              "node": "Percorre os itens",
              "type": "main",
              "index": 0
            },
            {
              "node": "Deleta Imagens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Id e Name?": {
        "main": [
          [
            {
              "node": "Cola imagem no documento",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Percorre os itens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Percorre os itens": {
        "main": [
          [
            {
              "node": "Remove duplicatas",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Id e Name?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Separa itens": {
        "main": [
          [
            {
              "node": "Percorre os itens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "Unir tudo",
              "type": "main",
              "index": 5
            }
          ]
        ]
      },
      "Atualiza documento1": {
        "main": [
          [
            {
              "node": "Unir tudo",
              "type": "main",
              "index": 2
            }
          ]
        ]
      },
      "Unir tudo": {
        "main": [
          [
            {
              "node": "Separa itens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atualiza documento": {
        "main": [
          [
            {
              "node": "Pega o documento1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Placeholder": {
        "main": [
          [
            {
              "node": "Unir tudo",
              "type": "main",
              "index": 0
            },
            {
              "node": "Index",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pega o documento": {
        "main": [
          [
            {
              "node": "Atualiza documento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Junta repeticoes": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Procura imagens": {
        "main": [
          [
            {
              "node": "Junta repeticoes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Torna publico": {
        "main": [
          [
            {
              "node": "Unir tudo",
              "type": "main",
              "index": 4
            }
          ]
        ]
      },
      "midia": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Copia  o arquivo": {
        "main": [
          [
            {
              "node": "midia",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cria pasta": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Copia  o arquivo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Imagens": {
        "main": [
          [
            {
              "node": "Unir tudo",
              "type": "main",
              "index": 3
            },
            {
              "node": "Torna publico",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Convert to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Adiciona imagem": {
        "main": [
          [
            {
              "node": "Nome da imagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "dados": {
        "main": [
          [
            {
              "node": "Cria pasta",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File": {
        "main": [
          [
            {
              "node": "Adiciona imagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Remove duplicatas": {
        "main": [
          [
            {
              "node": "Download file",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "dados1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pega o documento2": {
        "main": [
          [
            {
              "node": "Atualiza documento2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "dados1": {
        "main": [
          [
            {
              "node": "Soma horas1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Soma horas1": {
        "main": [
          [
            {
              "node": "Pega o documento2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atualiza documento2": {
        "main": [
          [
            {
              "node": "Download file1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download file1": {
        "main": [
          [
            {
              "node": "Upload file1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload file1": {
        "main": [
          [
            {
              "node": "Id e link",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis": {
        "main": [
          [
            {
              "node": "RemoteId",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis6": {
        "main": [
          [
            {
              "node": "Delete RemoteId1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "RemoteId1": {
        "main": [
          [
            {
              "node": "Envia OS1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "RemoteId2": {
        "main": [
          [
            {
              "node": "Envia OS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Menu": {
        "main": [
          [
            {
              "node": "Redis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Opcao1": {
        "main": [
          []
        ]
      },
      "Envia OS": {
        "main": [
          [
            {
              "node": "DB10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Envia OS1": {
        "main": [
          [
            {
              "node": "DB7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Deleta Imagens": {
        "main": [
          []
        ]
      },
      "Id e link": {
        "main": [
          [
            {
              "node": "Send a message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Id e link1": {
        "main": [
          [
            {
              "node": "dados2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OS consult": {
        "main": [
          [
            {
              "node": "Busca Item",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "InputOS": {
        "main": [
          [
            {
              "node": "OS consult",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OS sem retorno": {
        "main": [
          []
        ]
      },
      "OS retorno": {
        "main": [
          []
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "OS sem retorno",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca Item": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook4": {
        "main": [
          [
            {
              "node": "Edit Fields2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields2": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "DB2": {
        "main": [
          [
            {
              "node": "Code in JavaScript2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "RemoteId3": {
        "main": [
          [
            {
              "node": "Confirma Cliente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields3": {
        "main": [
          [
            {
              "node": "@s.whatsapp.net",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "@s.whatsapp.net": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Carrega HTML": {
        "main": [
          [
            {
              "node": "HTML6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca no Sheets": {
        "main": [
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request3": {
        "main": [
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Confirma Cliente": {
        "main": [
          []
        ]
      },
      "Opcao6": {
        "main": [
          [
            {
              "node": "Redis6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook5": {
        "main": [
          [
            {
              "node": "HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTML": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "RemoteId3",
              "type": "main",
              "index": 0
            },
            {
              "node": "DB2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis7": {
        "main": [
          [
            {
              "node": "Delete RemoteId3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Opcao8": {
        "main": [
          [
            {
              "node": "Redis7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "OS retorno",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send a message": {
        "main": [
          [
            {
              "node": "RemoteId1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send a message1": {
        "main": [
          [
            {
              "node": "RemoteId2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "dados2": {
        "main": [
          [
            {
              "node": "Send a message1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Append row in sheet": {
        "main": [
          []
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "Code in JavaScript4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "DB7": {
        "main": [
          []
        ]
      },
      "DB10": {
        "main": [
          []
        ]
      },
      "HTML6": {
        "main": [
          [
            {
              "node": "Retorna HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript4": {
        "main": [
          [
            {
              "node": "Retorna sugestões",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript2": {
        "main": [
          [
            {
              "node": "Append row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca no Sheets1": {
        "main": [
          [
            {
              "node": "HTTP Request4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request4": {
        "main": [
          [
            {
              "node": "HTTP Request1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request1": {
        "main": [
          [
            {
              "node": "Code in JavaScript5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript5": {
        "main": [
          [
            {
              "node": "Retorna sugestões1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Automações  Medical Spin",
    "name": null,
    "description": null
  },
  "tags": [
    {
      "updatedAt": "2025-11-17T14:00:11.395Z",
      "createdAt": "2025-11-17T14:00:11.395Z",
      "id": "BiXlsIc9sGawCxiS",
      "name": "EvolutionAPI"
    },
    {
      "updatedAt": "2025-11-17T14:09:04.153Z",
      "createdAt": "2025-11-17T14:09:04.153Z",
      "id": "32ehNS7DwOBedRQc",
      "name": "Sheets"
    },
    {
      "updatedAt": "2025-11-17T14:30:41.341Z",
      "createdAt": "2025-11-17T14:30:41.341Z",
      "id": "a1SiyDS4bAShAsoW",
      "name": "html"
    },
    {
      "updatedAt": "2025-11-17T14:32:35.191Z",
      "createdAt": "2025-11-17T14:32:35.191Z",
      "id": "Llfmd66GWbMUHQMr",
      "name": "Http"
    },
    {
      "updatedAt": "2025-11-17T14:46:49.579Z",
      "createdAt": "2025-11-17T14:46:49.579Z",
      "id": "9yuumwfUmri83S1w",
      "name": "Javascript"
    },
    {
      "updatedAt": "2025-11-27T17:41:23.357Z",
      "createdAt": "2025-11-27T17:41:23.357Z",
      "id": "qlhMLSlMQRcl50k1",
      "name": "Drive"
    },
    {
      "updatedAt": "2025-11-27T17:41:52.963Z",
      "createdAt": "2025-11-27T17:41:52.963Z",
      "id": "6elHMTsvW5UeAGVv",
      "name": "Docs"
    },
    {
      "updatedAt": "2025-12-01T11:29:55.381Z",
      "createdAt": "2025-12-01T11:29:55.381Z",
      "id": "N9rn00900k2JE58V",
      "name": "css"
    },
    {
      "updatedAt": "2025-12-05T19:19:48.809Z",
      "createdAt": "2025-12-05T19:19:48.809Z",
      "id": "p4l8XjzFeaIlUTS2",
      "name": "Redis"
    }
  ]
}